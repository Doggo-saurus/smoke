var Dr=Object.defineProperty;var kr=(n,t,e)=>t in n?Dr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _t=(n,t,e)=>(kr(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();var Ct=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class xr{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return Ct(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECt",{items:t})})}getName(){return Ct(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return Ct(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return Ct(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return Ct(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return Ct(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return Ct(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return Ct(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return Ct(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:i}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return i.indexOf(t)===-1})}getConnectionId(){return Ct(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=i=>{t(i.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var Ft=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class Mr{constructor(t){this.messageBus=t}reset(){return Ft(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return Ft(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return Ft(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return Ft(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return Ft(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return Ft(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return Ft(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function Lr(n){return typeof n.id=="string"}var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ur(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}),e}var Kn={exports:{}},ye=typeof Reflect=="object"?Reflect:null,Ii=ye&&typeof ye.apply=="function"?ye.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},Ke;ye&&typeof ye.ownKeys=="function"?Ke=ye.ownKeys:Object.getOwnPropertySymbols?Ke=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Ke=function(t){return Object.getOwnPropertyNames(t)};function $r(n){console&&console.warn&&console.warn(n)}var Yi=Number.isNaN||function(t){return t!==t};function dt(){dt.init.call(this)}Kn.exports=dt;Kn.exports.once=Gr;dt.EventEmitter=dt;dt.prototype._events=void 0;dt.prototype._eventsCount=0;dt.prototype._maxListeners=void 0;var Ai=10;function un(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(dt,"defaultMaxListeners",{enumerable:!0,get:function(){return Ai},set:function(n){if(typeof n!="number"||n<0||Yi(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ai=n}});dt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};dt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Yi(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Ki(n){return n._maxListeners===void 0?dt.defaultMaxListeners:n._maxListeners}dt.prototype.getMaxListeners=function(){return Ki(this)};dt.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var a=t==="error",s=this._events;if(s!==void 0)a=a&&s.error===void 0;else if(!a)return!1;if(a){var l;if(e.length>0&&(l=e[0]),l instanceof Error)throw l;var E=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw E.context=l,E}var I=s[t];if(I===void 0)return!1;if(typeof I=="function")Ii(I,this,e);else for(var v=I.length,y=Qi(I,v),i=0;i<v;++i)Ii(y[i],this,e);return!0};function zi(n,t,e,i){var a,s,l;if(un(e),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),s=n._events),l=s[t]),l===void 0)l=s[t]=e,++n._eventsCount;else if(typeof l=="function"?l=s[t]=i?[e,l]:[l,e]:i?l.unshift(e):l.push(e),a=Ki(n),a>0&&l.length>a&&!l.warned){l.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=n,E.type=t,E.count=l.length,$r(E)}return n}dt.prototype.addListener=function(t,e){return zi(this,t,e,!1)};dt.prototype.on=dt.prototype.addListener;dt.prototype.prependListener=function(t,e){return zi(this,t,e,!0)};function Vr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zi(n,t,e){var i={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},a=Vr.bind(i);return a.listener=e,i.wrapFn=a,a}dt.prototype.once=function(t,e){return un(e),this.on(t,Zi(this,t,e)),this};dt.prototype.prependOnceListener=function(t,e){return un(e),this.prependListener(t,Zi(this,t,e)),this};dt.prototype.removeListener=function(t,e){var i,a,s,l,E;if(un(e),a=this._events,a===void 0)return this;if(i=a[t],i===void 0)return this;if(i===e||i.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete a[t],a.removeListener&&this.emit("removeListener",t,i.listener||e));else if(typeof i!="function"){for(s=-1,l=i.length-1;l>=0;l--)if(i[l]===e||i[l].listener===e){E=i[l].listener,s=l;break}if(s<0)return this;s===0?i.shift():jr(i,s),i.length===1&&(a[t]=i[0]),a.removeListener!==void 0&&this.emit("removeListener",t,E||e)}return this};dt.prototype.off=dt.prototype.removeListener;dt.prototype.removeAllListeners=function(t){var e,i,a;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[t]),this;if(arguments.length===0){var s=Object.keys(i),l;for(a=0;a<s.length;++a)l=s[a],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=i[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(a=e.length-1;a>=0;a--)this.removeListener(t,e[a]);return this};function qi(n,t,e){var i=n._events;if(i===void 0)return[];var a=i[t];return a===void 0?[]:typeof a=="function"?e?[a.listener||a]:[a]:e?Fr(a):Qi(a,a.length)}dt.prototype.listeners=function(t){return qi(this,t,!0)};dt.prototype.rawListeners=function(t){return qi(this,t,!1)};dt.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Ji.call(n,t)};dt.prototype.listenerCount=Ji;function Ji(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}dt.prototype.eventNames=function(){return this._eventsCount>0?Ke(this._events):[]};function Qi(n,t){for(var e=new Array(t),i=0;i<t;++i)e[i]=n[i];return e}function jr(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Fr(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Gr(n,t){return new Promise(function(e,i){function a(l){n.removeListener(t,s),i(l)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",a),e([].slice.call(arguments))}tr(n,t,s,{once:!0}),t!=="error"&&Wr(n,a,{once:!0})})}function Wr(n,t,e){typeof n.on=="function"&&tr(n,"error",t,e)}function tr(n,t,e,i){if(typeof n.on=="function")i.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function a(s){i.once&&n.removeEventListener(t,a),e(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Hr=Kn.exports;let je;const Xr=new Uint8Array(16);function Yr(){if(!je&&(je=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!je))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return je(Xr)}const wt=[];for(let n=0;n<256;++n)wt.push((n+256).toString(16).slice(1));function Kr(n,t=0){return(wt[n[t+0]]+wt[n[t+1]]+wt[n[t+2]]+wt[n[t+3]]+"-"+wt[n[t+4]]+wt[n[t+5]]+"-"+wt[n[t+6]]+wt[n[t+7]]+"-"+wt[n[t+8]]+wt[n[t+9]]+"-"+wt[n[t+10]]+wt[n[t+11]]+wt[n[t+12]]+wt[n[t+13]]+wt[n[t+14]]+wt[n[t+15]]).toLowerCase()}const zr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),bi={randomUUID:zr};function er(n,t,e){if(bi.randomUUID&&!t&&!n)return bi.randomUUID();n=n||{};const i=n.random||(n.rng||Yr)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){e=e||0;for(let a=0;a<16;++a)t[e+a]=i[a];return t}return Kr(i)}class Zr extends Hr.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=i=>{const a=i.data;if(i.origin===this.targetOrigin&&Lr(a)){if(a.id==="OBR_READY"){this.ready=!0;const s=a.data;this.ref=s.ref,this.userId=s.userId}this.emit(a.id,a.data)}},this.send=(i,a,s)=>{var l;if(!this.ref)throw Error("Unable to send message: not ready");(l=window.parent)===null||l===void 0||l.postMessage({id:i,data:a,ref:this.ref,nonce:s},this.targetOrigin)},this.sendAsync=(i,a,s=5e3)=>{const l=`_${er()}`;return this.send(i,a,l),Promise.race([new Promise((E,I)=>{const v=this;function y(K){v.off(`${i}_RESPONSE${l}`,y),v.off(`${i}_ERROR${l}`,A),E(K)}function A(K){v.off(`${i}_RESPONSE${l}`,y),v.off(`${i}_ERROR${l}`,A),I(K)}this.on(`${i}_RESPONSE${l}`,y),this.on(`${i}_ERROR${l}`,A)}),new Promise((E,I)=>window.setTimeout(()=>I(new Error(`Message ${i} took longer than ${s}ms to get a result`)),s))])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Bi=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class qr{constructor(t){this.messageBus=t}show(t,e){return Bi(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return i})}close(t){return Bi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var le=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class Jr{constructor(t){this.messageBus=t}getColor(){return le(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return le(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return le(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return le(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=i=>{t(i.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var Nt=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class Qr{constructor(t){this.messageBus=t}getDpi(){return Nt(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return Nt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return Nt(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return Nt(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return Nt(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return Nt(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return Nt(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return Nt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,i){return Nt(this,void 0,void 0,function*(){const{position:a}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:i});return a})}getDistance(t,e){return Nt(this,void 0,void 0,function*(){const{distance:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return i})}onChange(t){const e=i=>{t(i.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var Fe=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class to{constructor(t){this.messageBus=t}undo(){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Fe(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return Fe(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}function At(n){for(var t=arguments.length,e=Array(t>1?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ae(n){return!!n&&!!n[Mt]}function te(n){var t;return!!n&&(function(e){if(!e||typeof e!="object")return!1;var i=Object.getPrototypeOf(e);if(i===null)return!0;var a=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return a===Object||typeof a=="function"&&Function.toString.call(a)===uo}(n)||Array.isArray(n)||!!n[Ae]||!!(!((t=n.constructor)===null||t===void 0)&&t[Ae])||cn(n)||ln(n))}function me(n,t,e){e===void 0&&(e=!1),ee(n)===0?(e?Object.keys:ei)(n).forEach(function(i){e&&typeof i=="symbol"||t(i,n[i],n)}):n.forEach(function(i,a){return t(a,i,n)})}function ee(n){var t=n[Mt];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:cn(n)?2:ln(n)?3:0}function Re(n,t){return ee(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function ze(n,t){return ee(n)===2?n.get(t):n[t]}function nr(n,t,e){var i=ee(n);i===2?n.set(t,e):i===3?n.add(e):n[t]=e}function eo(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function cn(n){return so&&n instanceof Map}function ln(n){return ao&&n instanceof Set}function re(n){return n.o||n.t}function zn(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=co(n);delete t[Mt];for(var e=ei(t),i=0;i<e.length;i++){var a=e[i],s=t[a];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[a]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[a]})}return Object.create(Object.getPrototypeOf(n),t)}function Zn(n,t){return t===void 0&&(t=!1),qn(n)||ae(n)||!te(n)||(ee(n)>1&&(n.set=n.add=n.clear=n.delete=no),Object.freeze(n),t&&me(n,function(e,i){return Zn(i,!0)},!0)),n}function no(){At(2)}function qn(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function Yt(n){var t=Wn[n];return t||At(18,n),t}function io(n,t){Wn[n]||(Wn[n]=t)}function Si(){return Ce}function Rn(n,t){t&&(Yt("Patches"),n.u=[],n.s=[],n.v=t)}function qe(n){jn(n),n.p.forEach(ro),n.p=null}function jn(n){n===Ce&&(Ce=n.l)}function Ri(n){return Ce={p:[],l:Ce,h:n,m:!0,_:0}}function ro(n){var t=n[Mt];t.i===0||t.i===1?t.j():t.g=!0}function Cn(n,t){t._=t.p.length;var e=t.p[0],i=n!==void 0&&n!==e;return t.h.O||Yt("ES5").S(t,n,i),i?(e[Mt].P&&(qe(t),At(4)),te(n)&&(n=Je(t,n),t.l||Qe(t,n)),t.u&&Yt("Patches").M(e[Mt].t,n,t.u,t.s)):n=Je(t,e,[]),qe(t),t.u&&t.v(t.u,t.s),n!==ti?n:void 0}function Je(n,t,e){if(qn(t))return t;var i=t[Mt];if(!i)return me(t,function(E,I){return Ci(n,i,t,E,I,e)},!0),t;if(i.A!==n)return t;if(!i.P)return Qe(n,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var a=i.i===4||i.i===5?i.o=zn(i.k):i.o,s=a,l=!1;i.i===3&&(s=new Set(a),a.clear(),l=!0),me(s,function(E,I){return Ci(n,i,a,E,I,e,l)}),Qe(n,a,!1),e&&n.u&&Yt("Patches").N(i,e,n.u,n.s)}return i.o}function Ci(n,t,e,i,a,s,l){if(ae(a)){var E=Je(n,a,s&&t&&t.i!==3&&!Re(t.R,i)?s.concat(i):void 0);if(nr(e,i,E),!ae(E))return;n.m=!1}else l&&e.add(a);if(te(a)&&!qn(a)){if(!n.h.D&&n._<1)return;Je(n,a),t&&t.A.l||Qe(n,a)}}function Qe(n,t,e){e===void 0&&(e=!1),!n.l&&n.h.D&&n.m&&Zn(t,e)}function Nn(n,t){var e=n[Mt];return(e?re(e):n)[t]}function Ni(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var i=Object.getOwnPropertyDescriptor(e,t);if(i)return i;e=Object.getPrototypeOf(e)}}function Fn(n){n.P||(n.P=!0,n.l&&Fn(n.l))}function Pn(n){n.o||(n.o=zn(n.t))}function Gn(n,t,e){var i=cn(t)?Yt("MapSet").F(t,e):ln(t)?Yt("MapSet").T(t,e):n.O?function(a,s){var l=Array.isArray(a),E={i:l?1:0,A:s?s.A:Si(),P:!1,I:!1,R:{},l:s,t:a,k:null,o:null,j:null,C:!1},I=E,v=Hn;l&&(I=[E],v=Ie);var y=Proxy.revocable(I,v),A=y.revoke,K=y.proxy;return E.k=K,E.j=A,K}(t,e):Yt("ES5").J(t,e);return(e?e.A:Si()).p.push(i),i}function oo(n){return ae(n)||At(22,n),function t(e){if(!te(e))return e;var i,a=e[Mt],s=ee(e);if(a){if(!a.P&&(a.i<4||!Yt("ES5").K(a)))return a.t;a.I=!0,i=Pi(e,s),a.I=!1}else i=Pi(e,s);return me(i,function(l,E){a&&ze(a.t,l)===E||nr(i,l,t(E))}),s===3?new Set(i):i}(n)}function Pi(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return zn(n)}function Jn(){function n(i){if(!te(i))return i;if(Array.isArray(i))return i.map(n);if(cn(i))return new Map(Array.from(i.entries()).map(function(l){return[l[0],n(l[1])]}));if(ln(i))return new Set(Array.from(i).map(n));var a=Object.create(Object.getPrototypeOf(i));for(var s in i)a[s]=n(i[s]);return Re(i,Ae)&&(a[Ae]=i[Ae]),a}function t(i){return ae(i)?n(i):i}var e="add";io("Patches",{$:function(i,a){return a.forEach(function(s){for(var l=s.path,E=s.op,I=i,v=0;v<l.length-1;v++){var y=ee(I),A=l[v];typeof A!="string"&&typeof A!="number"&&(A=""+A),y!==0&&y!==1||A!=="__proto__"&&A!=="constructor"||At(24),typeof I=="function"&&A==="prototype"&&At(24),typeof(I=ze(I,A))!="object"&&At(15,l.join("/"))}var K=ee(I),J=n(s.value),C=l[l.length-1];switch(E){case"replace":switch(K){case 2:return I.set(C,J);case 3:At(16);default:return I[C]=J}case e:switch(K){case 1:return C==="-"?I.push(J):I.splice(C,0,J);case 2:return I.set(C,J);case 3:return I.add(J);default:return I[C]=J}case"remove":switch(K){case 1:return I.splice(C,1);case 2:return I.delete(C);case 3:return I.delete(s.value);default:return delete I[C]}default:At(17,E)}}),i},N:function(i,a,s,l){switch(i.i){case 0:case 4:case 2:return function(E,I,v,y){var A=E.t,K=E.o;me(E.R,function(J,C){var G=ze(A,J),b=ze(K,J),N=C?Re(A,J)?"replace":e:"remove";if(G!==b||N!=="replace"){var U=I.concat(J);v.push(N==="remove"?{op:N,path:U}:{op:N,path:U,value:b}),y.push(N===e?{op:"remove",path:U}:N==="remove"?{op:e,path:U,value:t(G)}:{op:"replace",path:U,value:t(G)})}})}(i,a,s,l);case 5:case 1:return function(E,I,v,y){var A=E.t,K=E.R,J=E.o;if(J.length<A.length){var C=[J,A];A=C[0],J=C[1];var G=[y,v];v=G[0],y=G[1]}for(var b=0;b<A.length;b++)if(K[b]&&J[b]!==A[b]){var N=I.concat([b]);v.push({op:"replace",path:N,value:t(J[b])}),y.push({op:"replace",path:N,value:t(A[b])})}for(var U=A.length;U<J.length;U++){var V=I.concat([U]);v.push({op:e,path:V,value:t(J[U])})}A.length<J.length&&y.push({op:"replace",path:I.concat(["length"]),value:A.length})}(i,a,s,l);case 3:return function(E,I,v,y){var A=E.t,K=E.o,J=0;A.forEach(function(C){if(!K.has(C)){var G=I.concat([J]);v.push({op:"remove",path:G,value:C}),y.unshift({op:e,path:G,value:C})}J++}),J=0,K.forEach(function(C){if(!A.has(C)){var G=I.concat([J]);v.push({op:e,path:G,value:C}),y.unshift({op:"remove",path:G,value:C})}J++})}(i,a,s,l)}},M:function(i,a,s,l){s.push({op:"replace",path:[],value:a===ti?void 0:a}),l.push({op:"replace",path:[],value:i})}})}var Di,Ce,Qn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",so=typeof Map<"u",ao=typeof Set<"u",ki=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",ti=Qn?Symbol.for("immer-nothing"):((Di={})["immer-nothing"]=!0,Di),Ae=Qn?Symbol.for("immer-draftable"):"__$immer_draftable",Mt=Qn?Symbol.for("immer-state"):"__$immer_state",uo=""+Object.prototype.constructor,ei=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,co=Object.getOwnPropertyDescriptors||function(n){var t={};return ei(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},Wn={},Hn={get:function(n,t){if(t===Mt)return n;var e=re(n);if(!Re(e,t))return function(a,s,l){var E,I=Ni(s,l);return I?"value"in I?I.value:(E=I.get)===null||E===void 0?void 0:E.call(a.k):void 0}(n,e,t);var i=e[t];return n.I||!te(i)?i:i===Nn(n.t,t)?(Pn(n),n.o[t]=Gn(n.A.h,i,n)):i},has:function(n,t){return t in re(n)},ownKeys:function(n){return Reflect.ownKeys(re(n))},set:function(n,t,e){var i=Ni(re(n),t);if(i!=null&&i.set)return i.set.call(n.k,e),!0;if(!n.P){var a=Nn(re(n),t),s=a==null?void 0:a[Mt];if(s&&s.t===e)return n.o[t]=e,n.R[t]=!1,!0;if(eo(e,a)&&(e!==void 0||Re(n.t,t)))return!0;Pn(n),Fn(n)}return n.o[t]===e&&(e!==void 0||t in n.o)||Number.isNaN(e)&&Number.isNaN(n.o[t])||(n.o[t]=e,n.R[t]=!0),!0},deleteProperty:function(n,t){return Nn(n.t,t)!==void 0||t in n.t?(n.R[t]=!1,Pn(n),Fn(n)):delete n.R[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=re(n),i=Reflect.getOwnPropertyDescriptor(e,t);return i&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:i.enumerable,value:e[t]}},defineProperty:function(){At(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){At(12)}},Ie={};me(Hn,function(n,t){Ie[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Ie.deleteProperty=function(n,t){return Ie.set.call(this,n,t,void 0)},Ie.set=function(n,t,e){return Hn.set.call(this,n[0],t,e,n[0])};var lo=function(){function n(e){var i=this;this.O=ki,this.D=!0,this.produce=function(a,s,l){if(typeof a=="function"&&typeof s!="function"){var E=s;s=a;var I=i;return function(G){var b=this;G===void 0&&(G=E);for(var N=arguments.length,U=Array(N>1?N-1:0),V=1;V<N;V++)U[V-1]=arguments[V];return I.produce(G,function(L){var q;return(q=s).call.apply(q,[b,L].concat(U))})}}var v;if(typeof s!="function"&&At(6),l!==void 0&&typeof l!="function"&&At(7),te(a)){var y=Ri(i),A=Gn(i,a,void 0),K=!0;try{v=s(A),K=!1}finally{K?qe(y):jn(y)}return typeof Promise<"u"&&v instanceof Promise?v.then(function(G){return Rn(y,l),Cn(G,y)},function(G){throw qe(y),G}):(Rn(y,l),Cn(v,y))}if(!a||typeof a!="object"){if((v=s(a))===void 0&&(v=a),v===ti&&(v=void 0),i.D&&Zn(v,!0),l){var J=[],C=[];Yt("Patches").M(a,v,J,C),l(J,C)}return v}At(21,a)},this.produceWithPatches=function(a,s){if(typeof a=="function")return function(v){for(var y=arguments.length,A=Array(y>1?y-1:0),K=1;K<y;K++)A[K-1]=arguments[K];return i.produceWithPatches(v,function(J){return a.apply(void 0,[J].concat(A))})};var l,E,I=i.produce(a,s,function(v,y){l=v,E=y});return typeof Promise<"u"&&I instanceof Promise?I.then(function(v){return[v,l,E]}):[I,l,E]},typeof(e==null?void 0:e.useProxies)=="boolean"&&this.setUseProxies(e.useProxies),typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){te(e)||At(8),ae(e)&&(e=oo(e));var i=Ri(this),a=Gn(this,e,void 0);return a[Mt].C=!0,jn(i),a},t.finishDraft=function(e,i){var a=e&&e[Mt],s=a.A;return Rn(s,i),Cn(void 0,s)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!ki&&At(20),this.O=e},t.applyPatches=function(e,i){var a;for(a=i.length-1;a>=0;a--){var s=i[a];if(s.path.length===0&&s.op==="replace"){e=s.value;break}}a>-1&&(i=i.slice(a+1));var l=Yt("Patches").$;return ae(e)?l(e,i):this.produce(e,function(E){return l(E,i)})},n}(),Lt=new lo;Lt.produce;var ni=Lt.produceWithPatches.bind(Lt);Lt.setAutoFreeze.bind(Lt);Lt.setUseProxies.bind(Lt);Lt.applyPatches.bind(Lt);Lt.createDraft.bind(Lt);Lt.finishDraft.bind(Lt);var fe=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};Jn();class fo{constructor(t){this.messageBus=t}getItems(t){return fe(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e){return fe(this,void 0,void 0,function*(){let i;this.isItemArray(t)?i=t:i=yield this.getItems(t);const[a,s]=ni(i,e),l=a.map(E=>({id:E.id,type:E.type}));for(const E of s){const[I,v]=E.path;typeof I=="number"&&typeof v=="string"&&(l[I][v]=a[I][v])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:l})})}addItems(t){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return fe(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return fe(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=i=>{t(i.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var de=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};Jn();class ho{constructor(t){this.messageBus=t}getItems(t){return de(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}updateItems(t,e,i){return de(this,void 0,void 0,function*(){const a=yield this.getItems(t),[s,l]=ni(a,e),E=s.map(I=>({id:I.id,type:I.type}));for(const I of l){const[v,y]=I.path;typeof v=="number"&&typeof y=="string"&&(E[v][y]=s[v][y])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:E,fastUpdate:i})})}addItems(t){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return de(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return de(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return de(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=i=>{t(i.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var Dn=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class po{constructor(t){this.messageBus=t,this.grid=new Qr(t),this.fog=new Jr(t),this.history=new to(t),this.items=new fo(t),this.local=new ho(t)}isReady(){return Dn(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=i=>{t(i.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return Dn(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return Dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=i=>{t(i.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function be(n){return n.map(t=>Object.assign(Object.assign({},t),{icon:t.icon.startsWith("http")?t.icon:`${window.location.origin}${t.icon}`}))}function ir(n){return Object.assign(Object.assign({},n),{url:n.url.startsWith("http")?n.url:`${window.location.origin}${n.url}`})}var xi=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class yo{constructor(t){this.contextMenus={},this.handleClick=e=>{const i=this.contextMenus[e.id];i&&i.onClick(e.context,e.elementId)},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return xi(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:be(t.icons)}),this.contextMenus[t.id]=t})}remove(t){return xi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var Xt=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class mo{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const i=this.tools[e.id];if(i)if(i.onClick){const a=i.onClick(e.context,e.elementId);Promise.resolve(a).then(s=>{s&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var i;const a=this.toolActions[e.id];a&&((i=a.onClick)===null||i===void 0||i.call(a,e.context,e.elementId))},this.handleToolModeClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onClick){const a=i.onClick(e.context,e.elementId);Promise.resolve(a).then(s=>{s&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onToolClick){const a=i.onToolClick(e.context,e.event);Promise.resolve(a).then(s=>{s&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const i=this.toolModes[e.id];if(i)if(i.onToolDoubleClick){const a=i.onToolDoubleClick(e.context,e.event);Promise.resolve(a).then(s=>{s&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolDown)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolMove=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolMove)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolUp=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolUp)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolDragStart)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolDragMove)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolDragEnd)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onToolDragCancel)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeKeyDown=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onKeyDown)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeKeyUp=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onKeyUp)===null||i===void 0||i.call(a,e.context,e.event))},this.handleToolModeActivate=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onActivate)===null||i===void 0||i.call(a,e.context))},this.handleToolModeDeactivate=e=>{var i;const a=this.toolModes[e.id];a&&((i=a.onDeactivate)===null||i===void 0||i.call(a,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:be(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return Xt(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:be(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:be(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return Xt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}}var he=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class go{constructor(t){this.messageBus=t}open(t){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ir(t)))})}close(t){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return he(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return he(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return he(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var Mi=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class _o{constructor(t){this.messageBus=t}open(t){return Mi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ir(t)))})}close(t){return Mi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var Pt=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class vo{constructor(t){this.messageBus=t}getWidth(){return Pt(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return Pt(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return Pt(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return Pt(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return Pt(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return Pt(this,void 0,void 0,function*(){const e=be([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return Pt(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return Pt(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=i=>{t(i.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var Eo=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};Jn();class To{constructor(t){this.messageBus=t}startItemInteraction(t){return Eo(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t});let i=t;return[l=>{const[E,I]=ni(i,l);return i=E,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:e,patches:I}),E},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:e})}]})}}var Oo=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class wo{constructor(t){this.messageBus=t}getPlayers(){return Oo(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=i=>{t(i.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var kn=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class Io{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return kn(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return kn(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=i=>{t(i.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=i=>{t(i.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var Ao=globalThis&&globalThis.__awaiter||function(n,t,e,i){function a(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function E(y){try{v(i.next(y))}catch(A){l(A)}}function I(y){try{v(i.throw(y))}catch(A){l(A)}}function v(y){y.done?s(y.value):a(y.value).then(E,I)}v((i=i.apply(n,t||[])).next())})};class bo{constructor(t){this.messageBus=t}getTheme(){return Ao(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=i=>{t(i.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}class fn{constructor(t){this._item={createdUserId:t.id,id:er(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class Bo extends fn{constructor(t){super(t),this._points=[],this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[],tension:.5},this._item.name="Curve",this._item.layer="DRAWING"}points(t){return this._points=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}tension(t){return this._style.tension=t,this.self()}closed(t){return this._style.closed=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"CURVE",points:this._points,style:this._style})}}class So extends fn{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}style(t){return this._style=t,this.self()}backgroundColor(t){return this._style.backgroundColor=t,this.self()}backgroundOpacity(t){return this._style.backgroundOpacity=t,this.self()}cornerRadius(t){return this._style.cornerRadius=t,this.self()}pointerWidth(t){return this._style.pointerWidth=t,this.self()}pointerHeight(t){return this._style.pointerHeight=t,this.self()}pointerDirection(t){return this._style.pointerDirection=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class Ro extends fn{constructor(t){super(t),this._width=0,this._height=0,this._shapeType="RECTANGLE",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.layer="DRAWING",this._item.name="Shape"}width(t){return this._width=t,this.self()}height(t){return this._height=t,this.self()}shapeType(t){return this._shapeType=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"SHAPE",width:this._width,height:this._height,shapeType:this._shapeType,style:this._style})}}class Co extends fn{constructor(t){super(t),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(t){return this._commands=t,this.self()}fillRule(t){return this._fillRule=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const No=typeof atob=="function",ii=typeof Buffer=="function",Li=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Po="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Do=Array.prototype.slice.call(Po),Ge=(n=>{let t={};return n.forEach((e,i)=>t[e]=i),t})(Do),ko=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,se=String.fromCharCode.bind(String),Ui=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),rr=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),xo=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Mo=n=>{switch(n.length){case 4:var t=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),e=t-65536;return se((e>>>10)+55296)+se((e&1023)+56320);case 3:return se((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return se((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Lo=n=>n.replace(xo,Mo),Uo=n=>{if(n=n.replace(/\s+/g,""),!ko.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let t,e="",i,a;for(let s=0;s<n.length;)t=Ge[n.charAt(s++)]<<18|Ge[n.charAt(s++)]<<12|(i=Ge[n.charAt(s++)])<<6|(a=Ge[n.charAt(s++)]),e+=i===64?se(t>>16&255):a===64?se(t>>16&255,t>>8&255):se(t>>16&255,t>>8&255,t&255);return e},or=No?n=>atob(rr(n)):ii?n=>Buffer.from(n,"base64").toString("binary"):Uo,$o=ii?n=>Ui(Buffer.from(n,"base64")):n=>Ui(or(n).split("").map(t=>t.charCodeAt(0))),Vo=ii?n=>Buffer.from(n,"base64").toString("utf8"):Li?n=>Li.decode($o(n)):n=>Lo(or(n)),jo=n=>rr(n.replace(/[-_]/g,t=>t=="-"?"+":"/")),Fo=n=>Vo(jo(n));function Go(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",i="";if(t){const s=Fo(t).split(" ");s.length===2&&(e=s[0],i=s[1])}return{origin:e,roomId:i}}var $i;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})($i||($i={}));const Xn=Go(),bt=new Zr(Xn.origin,Xn.roomId),Wo=new Mr(bt),Ne=new xr(bt),Ho=new wo(bt),Xo=new qr(bt),Yo=new po(bt),Ko=new yo(bt),zo=new mo(bt),Zo=new go(bt),qo=new _o(bt),Jo=new vo(bt),Qo=new To(bt),ts=new Io(bt),es=new bo(bt),tt={onReady:n=>{bt.ready?n():bt.once("OBR_READY",()=>n())},get isReady(){return bt.ready},viewport:Wo,player:Ne,party:Ho,notification:Xo,scene:Yo,contextMenu:Ko,tool:zo,popover:Zo,modal:qo,action:Jo,interaction:Qo,room:ts,theme:es,isAvailable:!!Xn.origin};function sr(){return new Bo(Ne)}function tn(){return new So(Ne)}function ge(){return new Ro(Ne)}function ns(){return new Co(Ne)}class is{constructor(){_t(this,"userId");_t(this,"role");_t(this,"items");_t(this,"players");_t(this,"metadata");_t(this,"gridDpi");_t(this,"gridScale");_t(this,"gridSnap");_t(this,"fog");_t(this,"ready");this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1}}const z=new is;class j{}_t(j,"EXTENSIONID","com.battle-system.smoke"),_t(j,"ARMINDOID","com.armindoflores.fogofwar"),_t(j,"VISIONDEFAULT","30"),_t(j,"LABELSID","com.battle-system.labels"),_t(j,"DICENOTATION",/(\d+)[dD](\d+)(.*)$/i),_t(j,"DICEMODIFIER",/([+-])(\d+)/),_t(j,"PARENTHESESMATCH",/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g),_t(j,"PLUSMATCH",/\s(\+\d+)\s/g),_t(j,"GRIDID","d9953ba1-f417-431c-8a39-3c3376e3caf0");function rs(n){return n.layer=="MAP"&&(n.metadata[`${j.EXTENSIONID}/isBackgroundImage`]||n.metadata[`${j.ARMINDOID}/isBackgroundImage`])}function Yn(n){return n.metadata[`${j.EXTENSIONID}/isVisionFog`]||n.metadata[`${j.ARMINDOID}/isVisionFog`]}function os(n){return n.metadata[`${j.EXTENSIONID}/isIndicatorRing`]||n.metadata[`${j.ARMINDOID}/isIndicatorRing`]}function ss(n){return n.metadata[`${j.EXTENSIONID}/isVisionLine`]&&!n.metadata[`${j.EXTENSIONID}/disabled`]||n.metadata[`${j.ARMINDOID}/isVisionLine`]&&!n.metadata[`${j.ARMINDOID}/disabled`]}function ar(n){return n.layer=="CHARACTER"&&(n.metadata[`${j.EXTENSIONID}/hasVision`]||n.metadata[`${j.ARMINDOID}/hasVision`])}function as(n){return n.layer=="CHARACTER"&&n.createdUserId==z.userId&&(n.metadata[`${j.EXTENSIONID}/hasVision`]||n.metadata[`${j.ARMINDOID}/hasVision`])}function ur(n){return n.layer=="DRAWING"&&(n.metadata[`${j.EXTENSIONID}/isBackgroundImage`]||n.metadata[`${j.ARMINDOID}/isBackgroundImage`])}var cr={exports:{}};const us={},cs=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"})),xn=Ur(cs);(function(n,t){var e=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(a){a=a||{};var s;s||(s=typeof a<"u"?a:{});var l=Object.assign,E,I;s.ready=new Promise(function(o,r){E=o,I=r}),function(o){var r={};o.loadCmdsTypedArray=function(R){for(var M=0,W=0;W<R.length;W++)M+=R[W].length;if(r[M])var X=r[M];else X=new Float32Array(M),r[M]=X;var Z=0;for(W=0;W<R.length;W++)for(var ct=0;ct<R[W].length;ct++){var yt=R[W][ct];typeof yt=="string"&&(yt=o.SkBits2FloatUnsigned(parseInt(yt))),X[Z]=yt,Z++}return R=o._malloc(X.length*X.BYTES_PER_ELEMENT),o.HEAPF32.set(X,R/X.BYTES_PER_ELEMENT),[R,M]},o.FromCmds=function(R){R=o.loadCmdsTypedArray(R);var M=o._FromCmds(R[0],R[1]);return o._free(R[0]),M};var u,f,_,w,x;o.cubicYFromX=function(R,M,W,X,Z){return u&&f===R&&_===M&&w===W&&x===X||(u&&u.delete(),u=new o._SkCubicMap([R,M],[W,X]),f=R,_=M,w=W,x=X),u.computeYFromX(Z)},o.cubicPtFromT=function(R,M,W,X,Z){return u&&f===R&&_===M&&w===W&&x===X||(u&&u.delete(),u=new o._SkCubicMap([R,M],[W,X]),f=R,_=M,w=W,x=X),u.computePtFromT(Z)}}(s),function(o){o.onRuntimeInitialized=function(){o.SkPath.prototype.addPath=function(){var r=arguments[0];if(arguments.length===1)this._addPath(r,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var u=arguments[1];this._addPath(r,u.a,u.c,u.e,u.b,u.d,u.f,0,0,1)}else if(arguments.length===7)u=arguments,this._addPath(r,u[1],u[3],u[5],u[2],u[4],u[6],0,0,1);else if(arguments.length===10)u=arguments,this._addPath(r,u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},o.SkPath.prototype.arc=function(r,u,f,_,w,x){return this._arc(r,u,f,_,w,!!x),this},o.SkPath.prototype.arcTo=function(r,u,f,_,w){return this._arcTo(r,u,f,_,w),this},o.SkPath.prototype.bezierCurveTo=function(r,u,f,_,w,x){return this._cubicTo(r,u,f,_,w,x),this},o.SkPath.prototype.close=function(){return this._close(),this},o.SkPath.prototype.closePath=function(){return this._close(),this},o.SkPath.prototype.conicTo=function(r,u,f,_,w){return this._conicTo(r,u,f,_,w),this},o.SkPath.prototype.cubicTo=function(r,u,f,_,w,x){return this._cubicTo(r,u,f,_,w,x),this},o.SkPath.prototype.dash=function(r,u,f){return this._dash(r,u,f)?this:null},o.SkPath.prototype.ellipse=function(r,u,f,_,w,x,R,M){return this._ellipse(r,u,f,_,w,x,R,!!M),this},o.SkPath.prototype.lineTo=function(r,u){return this._lineTo(r,u),this},o.SkPath.prototype.moveTo=function(r,u){return this._moveTo(r,u),this},o.SkPath.prototype.op=function(r,u){return this._op(r,u)?this:null},o.SkPath.prototype.quadraticCurveTo=function(r,u,f,_){return this._quadTo(r,u,f,_),this},o.SkPath.prototype.quadTo=function(r,u,f,_){return this._quadTo(r,u,f,_),this},o.SkPath.prototype.rect=function(r,u,f,_){return this._rect(r,u,f,_),this},o.SkPath.prototype.simplify=function(){return this._simplify()?this:null},o.SkPath.prototype.stroke=function(r){return r=r||{},r.width=r.width||1,r.miter_limit=r.miter_limit||4,r.cap=r.cap||o.StrokeCap.BUTT,r.join=r.join||o.StrokeJoin.MITER,this._stroke(r)?this:null},o.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var r=arguments;this._transform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},o.SkPath.prototype.trim=function(r,u,f){return this._trim(r,u,!!f)?this:null}}}(s);var v=l({},s),y=typeof window=="object",A=typeof importScripts=="function",K="",J,C,G,b,N,U;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(K=A?xn.dirname(K)+"/":__dirname+"/",U=()=>{N||(b=xn,N=xn)},J=function(o,r){return U(),o=N.normalize(o),b.readFileSync(o,r?null:"utf8")},G=o=>(o=J(o,!0),o.buffer||(o=new Uint8Array(o)),o),C=(o,r,u)=>{U(),o=N.normalize(o),b.readFile(o,function(f,_){f?u(f):r(_.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(o){throw o}),process.on("unhandledRejection",function(o){throw o}),s.inspect=function(){return"[Emscripten Module object]"}):(y||A)&&(A?K=self.location.href:typeof document<"u"&&document.currentScript&&(K=document.currentScript.src),i&&(K=i),K.indexOf("blob:")!==0?K=K.substr(0,K.replace(/[?#].*/,"").lastIndexOf("/")+1):K="",J=o=>{var r=new XMLHttpRequest;return r.open("GET",o,!1),r.send(null),r.responseText},A&&(G=o=>{var r=new XMLHttpRequest;return r.open("GET",o,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),C=(o,r,u)=>{var f=new XMLHttpRequest;f.open("GET",o,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?r(f.response):u()},f.onerror=u,f.send(null)});var V=s.print||console.log.bind(console),L=s.printErr||console.warn.bind(console);l(s,v),v=null;var q;s.wasmBinary&&(q=s.wasmBinary),s.noExitRuntime,typeof WebAssembly!="object"&&rt("no native wasm support detected");var T,S=!1,h=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function m(o,r,u){var f=r+u;for(u=r;o[u]&&!(u>=f);)++u;if(16<u-r&&o.subarray&&h)return h.decode(o.subarray(r,u));for(f="";r<u;){var _=o[r++];if(_&128){var w=o[r++]&63;if((_&224)==192)f+=String.fromCharCode((_&31)<<6|w);else{var x=o[r++]&63;_=(_&240)==224?(_&15)<<12|w<<6|x:(_&7)<<18|w<<12|x<<6|o[r++]&63,65536>_?f+=String.fromCharCode(_):(_-=65536,f+=String.fromCharCode(55296|_>>10,56320|_&1023))}}else f+=String.fromCharCode(_)}return f}function d(o,r,u){var f=Q;if(0<u){u=r+u-1;for(var _=0;_<o.length;++_){var w=o.charCodeAt(_);if(55296<=w&&57343>=w){var x=o.charCodeAt(++_);w=65536+((w&1023)<<10)|x&1023}if(127>=w){if(r>=u)break;f[r++]=w}else{if(2047>=w){if(r+1>=u)break;f[r++]=192|w>>6}else{if(65535>=w){if(r+2>=u)break;f[r++]=224|w>>12}else{if(r+3>=u)break;f[r++]=240|w>>18,f[r++]=128|w>>12&63}f[r++]=128|w>>6&63}f[r++]=128|w&63}}f[r]=0}}var O=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function B(o,r){for(var u=o>>1,f=u+r/2;!(u>=f)&&ft[u];)++u;if(u<<=1,32<u-o&&O)return O.decode(Q.subarray(o,u));for(u="",f=0;!(f>=r/2);++f){var _=st[o+2*f>>1];if(_==0)break;u+=String.fromCharCode(_)}return u}function nt(o,r,u){if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var f=r;u=u<2*o.length?u/2:o.length;for(var _=0;_<u;++_)st[r>>1]=o.charCodeAt(_),r+=2;return st[r>>1]=0,r-f}function et(o){return 2*o.length}function P(o,r){for(var u=0,f="";!(u>=r/4);){var _=it[o+4*u>>2];if(_==0)break;++u,65536<=_?(_-=65536,f+=String.fromCharCode(55296|_>>10,56320|_&1023)):f+=String.fromCharCode(_)}return f}function $(o,r,u){if(u===void 0&&(u=2147483647),4>u)return 0;var f=r;u=f+u-4;for(var _=0;_<o.length;++_){var w=o.charCodeAt(_);if(55296<=w&&57343>=w){var x=o.charCodeAt(++_);w=65536+((w&1023)<<10)|x&1023}if(it[r>>2]=w,r+=4,r+4>u)break}return it[r>>2]=0,r-f}function ot(o){for(var r=0,u=0;u<o.length;++u){var f=o.charCodeAt(u);55296<=f&&57343>=f&&++u,r+=4}return r}var ht,Y,Q,st,ft,it,pt,Et,kt;function xt(){var o=T.buffer;ht=o,s.HEAP8=Y=new Int8Array(o),s.HEAP16=st=new Int16Array(o),s.HEAP32=it=new Int32Array(o),s.HEAPU8=Q=new Uint8Array(o),s.HEAPU16=ft=new Uint16Array(o),s.HEAPU32=pt=new Uint32Array(o),s.HEAPF32=Et=new Float32Array(o),s.HEAPF64=kt=new Float64Array(o)}var F,c=[],p=[],g=[];function D(){var o=s.preRun.shift();c.unshift(o)}var k=0,H=null;s.preloadedImages={},s.preloadedAudios={};function rt(o){throw s.onAbort&&s.onAbort(o),o="Aborted("+o+")",L(o),S=!0,o=new WebAssembly.RuntimeError(o+". Build with -s ASSERTIONS=1 for more info."),I(o),o}function mt(){return ut.startsWith("data:application/octet-stream;base64,")}var ut;if(ut="pathkit.wasm",!mt()){var Dt=ut;ut=s.locateFile?s.locateFile(Dt,K):K+Dt}function Ot(){var o=ut;try{if(o==ut&&q)return new Uint8Array(q);if(G)return G(o);throw"both async and sync fetching of the wasm failed"}catch(r){rt(r)}}function It(){if(!q&&(y||A)){if(typeof fetch=="function"&&!ut.startsWith("file://"))return fetch(ut,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+ut+"'";return o.arrayBuffer()}).catch(function(){return Ot()});if(C)return new Promise(function(o,r){C(ut,function(u){o(new Uint8Array(u))},r)})}return Promise.resolve().then(function(){return Ot()})}function vt(o){for(;0<o.length;){var r=o.shift();if(typeof r=="function")r(s);else{var u=r.Wa;typeof u=="number"?r.xa===void 0?F.get(u)():F.get(u)(r.xa):u(r.xa===void 0?null:r.xa)}}}var gt={};function Wt(o){for(;o.length;){var r=o.pop();o.pop()(r)}}function Kt(o){return this.fromWireType(pt[o>>2])}var ue={},ne={},Pe={};function oi(o){if(o===void 0)return"_unknown";o=o.replace(/[^a-zA-Z0-9_]/g,"$");var r=o.charCodeAt(0);return 48<=r&&57>=r?"_"+o:o}function dn(o,r){return o=oi(o),function(){return r.apply(this,arguments)}}function hn(o){var r=Error,u=dn(o,function(f){this.name=o,this.message=f,f=Error(f).stack,f!==void 0&&(this.stack=this.toString()+`
`+f.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(r.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},u}var si=void 0;function De(o){throw new si(o)}function zt(o,r,u){function f(R){R=u(R),R.length!==o.length&&De("Mismatched type converter count");for(var M=0;M<o.length;++M)Ht(o[M],R[M])}o.forEach(function(R){Pe[R]=r});var _=Array(r.length),w=[],x=0;r.forEach(function(R,M){ne.hasOwnProperty(R)?_[M]=ne[R]:(w.push(R),ue.hasOwnProperty(R)||(ue[R]=[]),ue[R].push(function(){_[M]=ne[R],++x,x===w.length&&f(_)}))}),w.length===0&&f(_)}var ke={};function xe(o){switch(o){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+o)}}var ai=void 0;function Tt(o){for(var r="";Q[o];)r+=ai[Q[o++]];return r}var ce=void 0;function at(o){throw new ce(o)}function Ht(o,r,u={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var f=r.name;if(o||at('type "'+f+'" must have a positive integer typeid pointer'),ne.hasOwnProperty(o)){if(u.Qa)return;at("Cannot register type '"+f+"' twice")}ne[o]=r,delete Pe[o],ue.hasOwnProperty(o)&&(r=ue[o],delete ue[o],r.forEach(function(_){_()}))}function pn(o){at(o.ea.ha.fa.name+" instance already deleted")}var yn=!1;function ui(){}function ci(o){--o.count.value,o.count.value===0&&(o.ka?o.ma.la(o.ka):o.ha.fa.la(o.ga))}function _e(o){return typeof FinalizationGroup>"u"?(_e=r=>r,o):(yn=new FinalizationGroup(function(r){for(var u=r.next();!u.done;u=r.next())u=u.value,u.ga?ci(u):console.warn("object already deleted: "+u.ga)}),_e=r=>(yn.register(r,r.ea,r.ea),r),ui=r=>{yn.unregister(r.ea)},_e(o))}var ve=void 0,Ee=[];function mn(){for(;Ee.length;){var o=Ee.pop();o.ea.pa=!1,o.delete()}}function Jt(){}var li={};function fi(o,r,u){if(o[r].ia===void 0){var f=o[r];o[r]=function(){return o[r].ia.hasOwnProperty(arguments.length)||at("Function '"+u+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+o[r].ia+")!"),o[r].ia[arguments.length].apply(this,arguments)},o[r].ia=[],o[r].ia[f.ua]=f}}function gn(o,r,u){s.hasOwnProperty(o)?((u===void 0||s[o].ia!==void 0&&s[o].ia[u]!==void 0)&&at("Cannot register public name '"+o+"' twice"),fi(s,o,o),s.hasOwnProperty(u)&&at("Cannot register multiple overloads of a function with the same number of arguments ("+u+")!"),s[o].ia[u]=r):(s[o]=r,u!==void 0&&(s[o].Xa=u))}function _r(o,r,u,f,_,w,x,R){this.name=o,this.constructor=r,this.qa=u,this.la=f,this.na=_,this.Oa=w,this.ta=x,this.La=R,this.Ta=[]}function _n(o,r,u){for(;r!==u;)r.ta||at("Expected null or instance of "+u.name+", got an instance of "+r.name),o=r.ta(o),r=r.na;return o}function vr(o,r){return r===null?(this.Ba&&at("null is not a valid "+this.name),0):(r.ea||at('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||at("Cannot pass deleted object as a pointer of type "+this.name),_n(r.ea.ga,r.ea.ha.fa,this.fa))}function Er(o,r){if(r===null){if(this.Ba&&at("null is not a valid "+this.name),this.wa){var u=this.sa();return o!==null&&o.push(this.la,u),u}return 0}if(r.ea||at('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||at("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&r.ea.ha.va&&at("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name),u=_n(r.ea.ga,r.ea.ha.fa,this.fa),this.wa)switch(r.ea.ka===void 0&&at("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:r.ea.ma===this?u=r.ea.ka:at("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name);break;case 1:u=r.ea.ka;break;case 2:if(r.ea.ma===this)u=r.ea.ka;else{var f=r.clone();u=this.Ua(u,Qt(function(){f.delete()})),o!==null&&o.push(this.la,u)}break;default:at("Unsupporting sharing policy")}return u}function Tr(o,r){return r===null?(this.Ba&&at("null is not a valid "+this.name),0):(r.ea||at('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||at("Cannot pass deleted object as a pointer of type "+this.name),r.ea.ha.va&&at("Cannot convert argument of type "+r.ea.ha.name+" to parameter type "+this.name),_n(r.ea.ga,r.ea.ha.fa,this.fa))}function di(o,r,u){return r===u?o:u.na===void 0?null:(o=di(o,r,u.na),o===null?null:u.La(o))}var Te={};function Or(o,r){for(r===void 0&&at("ptr should not be undefined");o.na;)r=o.ta(r),o=o.na;return Te[r]}function Me(o,r){return r.ha&&r.ga||De("makeClassHandle requires ptr and ptrType"),!!r.ma!=!!r.ka&&De("Both smartPtrType and smartPtr must be specified"),r.count={value:1},_e(Object.create(o,{ea:{value:r}}))}function Zt(o,r,u,f){this.name=o,this.fa=r,this.Ba=u,this.va=f,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,r.na!==void 0?this.toWireType=Er:(this.toWireType=f?vr:Tr,this.ja=null)}function hi(o,r,u){s.hasOwnProperty(o)||De("Replacing nonexistant public symbol"),s[o].ia!==void 0&&u!==void 0?s[o].ia[u]=r:(s[o]=r,s[o].ua=u)}function wr(o,r){var u=[];return function(){u.length=arguments.length;for(var f=0;f<arguments.length;f++)u[f]=arguments[f];return o.includes("j")?(f=s["dynCall_"+o],f=u&&u.length?f.apply(null,[r].concat(u)):f.call(null,r)):f=F.get(r).apply(null,u),f}}function Bt(o,r){o=Tt(o);var u=o.includes("j")?wr(o,r):F.get(r);return typeof u!="function"&&at("unknown function pointer with signature "+o+": "+r),u}var pi=void 0;function yi(o){o=Ti(o);var r=Tt(o);return qt(o),r}function Le(o,r){function u(w){_[w]||ne[w]||(Pe[w]?Pe[w].forEach(u):(f.push(w),_[w]=!0))}var f=[],_={};throw r.forEach(u),new pi(o+": "+f.map(yi).join([", "]))}function vn(o,r){for(var u=[],f=0;f<o;f++)u.push(it[(r>>2)+f]);return u}function En(o,r,u,f,_){var w=r.length;2>w&&at("argTypes array size mismatch! Must at least get return value and 'this' types!");var x=r[1]!==null&&u!==null,R=!1;for(u=1;u<r.length;++u)if(r[u]!==null&&r[u].ja===void 0){R=!0;break}var M=r[0].name!=="void",W=w-2,X=Array(W),Z=[],ct=[];return function(){if(arguments.length!==W&&at("function "+o+" called with "+arguments.length+" arguments, expected "+W+" args!"),ct.length=0,Z.length=x?2:1,Z[0]=_,x){var yt=r[1].toWireType(ct,this);Z[1]=yt}for(var lt=0;lt<W;++lt)X[lt]=r[lt+2].toWireType(ct,arguments[lt]),Z.push(X[lt]);if(lt=f.apply(null,Z),R)Wt(ct);else for(var St=x?1:2;St<r.length;St++){var Rt=St===1?yt:X[St-2];r[St].ja!==null&&r[St].ja(Rt)}return yt=M?r[0].fromWireType(lt):void 0,yt}}var Tn=[],jt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function mi(o){4<o&&--jt[o].Ca===0&&(jt[o]=void 0,Tn.push(o))}function On(o){return o||at("Cannot use deleted val. handle = "+o),jt[o].value}function Qt(o){switch(o){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var r=Tn.length?Tn.pop():jt.length;return jt[r]={Ca:1,value:o},r}}function Ir(o,r,u){switch(r){case 0:return function(f){return this.fromWireType((u?Y:Q)[f])};case 1:return function(f){return this.fromWireType((u?st:ft)[f>>1])};case 2:return function(f){return this.fromWireType((u?it:pt)[f>>2])};default:throw new TypeError("Unknown integer type: "+o)}}function Ue(o,r){var u=ne[o];return u===void 0&&at(r+" has unknown type "+yi(o)),u}function wn(o){if(o===null)return"null";var r=typeof o;return r==="object"||r==="array"||r==="function"?o.toString():""+o}function Ar(o,r){switch(r){case 2:return function(u){return this.fromWireType(Et[u>>2])};case 3:return function(u){return this.fromWireType(kt[u>>3])};default:throw new TypeError("Unknown float type: "+o)}}function br(o,r,u){switch(r){case 0:return u?function(f){return Y[f]}:function(f){return Q[f]};case 1:return u?function(f){return st[f>>1]}:function(f){return ft[f>>1]};case 2:return u?function(f){return it[f>>2]}:function(f){return pt[f>>2]};default:throw new TypeError("Unknown integer type: "+o)}}var Br={};function In(o){var r=Br[o];return r===void 0?Tt(o):r}var An=[];function gi(){function o(r){r.$$$embind_global$$$=r;var u=typeof $$$embind_global$$$=="object"&&r.$$$embind_global$$$===r;return u||delete r.$$$embind_global$$$,u}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof Sn=="object"&&o(Sn)?$$$embind_global$$$=Sn:typeof self=="object"&&o(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Sr(o){var r=An.length;return An.push(o),r}function Rr(o,r){for(var u=Array(o),f=0;f<o;++f)u[f]=Ue(it[(r>>2)+f],"parameter "+f);return u}var _i=[];function Cr(o){var r=Array(o+1);return function(u,f,_){r[0]=u;for(var w=0;w<o;++w){var x=Ue(it[(f>>2)+w],"parameter "+w);r[w+1]=x.readValueFromPointer(_),_+=x.argPackAdvance}return u=new(u.bind.apply(u,r)),Qt(u)}}var vi={},Nr=[null,[],[]];si=s.InternalError=hn("InternalError");for(var Ei=Array(256),$e=0;256>$e;++$e)Ei[$e]=String.fromCharCode($e);ai=Ei,ce=s.BindingError=hn("BindingError"),Jt.prototype.isAliasOf=function(o){if(!(this instanceof Jt&&o instanceof Jt))return!1;var r=this.ea.ha.fa,u=this.ea.ga,f=o.ea.ha.fa;for(o=o.ea.ga;r.na;)u=r.ta(u),r=r.na;for(;f.na;)o=f.ta(o),f=f.na;return r===f&&u===o},Jt.prototype.clone=function(){if(this.ea.ga||pn(this),this.ea.ra)return this.ea.count.value+=1,this;var o=_e,r=Object,u=r.create,f=Object.getPrototypeOf(this),_=this.ea;return o=o(u.call(r,f,{ea:{value:{count:_.count,pa:_.pa,ra:_.ra,ga:_.ga,ha:_.ha,ka:_.ka,ma:_.ma}}})),o.ea.count.value+=1,o.ea.pa=!1,o},Jt.prototype.delete=function(){this.ea.ga||pn(this),this.ea.pa&&!this.ea.ra&&at("Object already scheduled for deletion"),ui(this),ci(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},Jt.prototype.isDeleted=function(){return!this.ea.ga},Jt.prototype.deleteLater=function(){return this.ea.ga||pn(this),this.ea.pa&&!this.ea.ra&&at("Object already scheduled for deletion"),Ee.push(this),Ee.length===1&&ve&&ve(mn),this.ea.pa=!0,this},Zt.prototype.Pa=function(o){return this.Ia&&(o=this.Ia(o)),o},Zt.prototype.Ga=function(o){this.la&&this.la(o)},Zt.prototype.argPackAdvance=8,Zt.prototype.readValueFromPointer=Kt,Zt.prototype.deleteObject=function(o){o!==null&&o.delete()},Zt.prototype.fromWireType=function(o){function r(){return this.wa?Me(this.fa.qa,{ha:this.Sa,ga:u,ma:this,ka:o}):Me(this.fa.qa,{ha:this,ga:o})}var u=this.Pa(o);if(!u)return this.Ga(o),null;var f=Or(this.fa,u);if(f!==void 0)return f.ea.count.value===0?(f.ea.ga=u,f.ea.ka=o,f.clone()):(f=f.clone(),this.Ga(o),f);if(f=this.fa.Oa(u),f=li[f],!f)return r.call(this);f=this.va?f.Ja:f.pointerType;var _=di(u,this.fa,f.fa);return _===null?r.call(this):this.wa?Me(f.fa.qa,{ha:f,ga:_,ma:this,ka:o}):Me(f.fa.qa,{ha:f,ga:_})},s.getInheritedInstanceCount=function(){return Object.keys(Te).length},s.getLiveInheritedInstances=function(){var o=[],r;for(r in Te)Te.hasOwnProperty(r)&&o.push(Te[r]);return o},s.flushPendingDeletes=mn,s.setDelayFunction=function(o){ve=o,Ee.length&&ve&&ve(mn)},pi=s.UnboundTypeError=hn("UnboundTypeError"),s.count_emval_handles=function(){for(var o=0,r=5;r<jt.length;++r)jt[r]!==void 0&&++o;return o},s.get_first_emval=function(){for(var o=5;o<jt.length;++o)if(jt[o]!==void 0)return jt[o];return null};var Pr={r:function(o){var r=gt[o];delete gt[o];var u=r.elements,f=u.length,_=u.map(function(R){return R.Aa}).concat(u.map(function(R){return R.Ea})),w=r.sa,x=r.la;zt([o],_,function(R){return u.forEach(function(M,W){var X=R[W],Z=M.ya,ct=M.za,yt=R[W+f],lt=M.Da,St=M.Fa;M.read=Rt=>X.fromWireType(Z(ct,Rt)),M.write=(Rt,ie)=>{var Ut=[];lt(St,Rt,yt.toWireType(Ut,ie)),Wt(Ut)}}),[{name:r.name,fromWireType:function(M){for(var W=Array(f),X=0;X<f;++X)W[X]=u[X].read(M);return x(M),W},toWireType:function(M,W){if(f!==W.length)throw new TypeError("Incorrect number of tuple elements for "+r.name+": expected="+f+", actual="+W.length);for(var X=w(),Z=0;Z<f;++Z)u[Z].write(X,W[Z]);return M!==null&&M.push(x,X),X},argPackAdvance:8,readValueFromPointer:Kt,ja:x}]})},u:function(o){var r=ke[o];delete ke[o];var u=r.sa,f=r.la,_=r.Ha,w=_.map(function(x){return x.Aa}).concat(_.map(function(x){return x.Ea}));zt([o],w,function(x){var R={};return _.forEach(function(M,W){var X=x[W],Z=M.ya,ct=M.za,yt=x[W+_.length],lt=M.Da,St=M.Fa;R[M.Na]={read:function(Rt){return X.fromWireType(Z(ct,Rt))},write:function(Rt,ie){var Ut=[];lt(St,Rt,yt.toWireType(Ut,ie)),Wt(Ut)}}}),[{name:r.name,fromWireType:function(M){var W={},X;for(X in R)W[X]=R[X].read(M);return f(M),W},toWireType:function(M,W){for(var X in R)if(!(X in W))throw new TypeError('Missing field:  "'+X+'"');var Z=u();for(X in R)R[X].write(Z,W[X]);return M!==null&&M.push(f,Z),Z},argPackAdvance:8,readValueFromPointer:Kt,ja:f}]})},z:function(){},F:function(o,r,u,f,_){var w=xe(u);r=Tt(r),Ht(o,{name:r,fromWireType:function(x){return!!x},toWireType:function(x,R){return R?f:_},argPackAdvance:8,readValueFromPointer:function(x){if(u===1)var R=Y;else if(u===2)R=st;else if(u===4)R=it;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(R[x>>w])},ja:null})},l:function(o,r,u,f,_,w,x,R,M,W,X,Z,ct){X=Tt(X),w=Bt(_,w),R&&(R=Bt(x,R)),W&&(W=Bt(M,W)),ct=Bt(Z,ct);var yt=oi(X);gn(yt,function(){Le("Cannot construct "+X+" due to unbound types",[f])}),zt([o,r,u],f?[f]:[],function(lt){if(lt=lt[0],f)var St=lt.fa,Rt=St.qa;else Rt=Jt.prototype;lt=dn(yt,function(){if(Object.getPrototypeOf(this)!==ie)throw new ce("Use 'new' to construct "+X);if(Ut.oa===void 0)throw new ce(X+" has no accessible constructor");var wi=Ut.oa[arguments.length];if(wi===void 0)throw new ce("Tried to invoke ctor of "+X+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ut.oa).toString()+") parameters instead!");return wi.apply(this,arguments)});var ie=Object.create(Rt,{constructor:{value:lt}});lt.prototype=ie;var Ut=new _r(X,lt,ie,ct,St,w,R,W);St=new Zt(X,Ut,!0,!1),Rt=new Zt(X+"*",Ut,!1,!1);var Oi=new Zt(X+" const*",Ut,!1,!0);return li[o]={pointerType:Rt,Ja:Oi},hi(yt,lt),[St,Rt,Oi]})},i:function(o,r,u,f,_,w){0<r||rt(void 0);var x=vn(r,u);_=Bt(f,_),zt([],[o],function(R){R=R[0];var M="constructor "+R.name;if(R.fa.oa===void 0&&(R.fa.oa=[]),R.fa.oa[r-1]!==void 0)throw new ce("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+R.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return R.fa.oa[r-1]=()=>{Le("Cannot construct "+R.name+" due to unbound types",x)},zt([],x,function(W){return W.splice(1,0,null),R.fa.oa[r-1]=En(M,W,null,_,w),[]}),[]})},a:function(o,r,u,f,_,w,x,R){var M=vn(u,f);r=Tt(r),w=Bt(_,w),zt([],[o],function(W){function X(){Le("Cannot call "+Z+" due to unbound types",M)}W=W[0];var Z=W.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),R&&W.fa.Ta.push(r);var ct=W.fa.qa,yt=ct[r];return yt===void 0||yt.ia===void 0&&yt.className!==W.name&&yt.ua===u-2?(X.ua=u-2,X.className=W.name,ct[r]=X):(fi(ct,r,Z),ct[r].ia[u-2]=X),zt([],M,function(lt){return lt=En(Z,lt,W,w,x),ct[r].ia===void 0?(lt.ua=u-2,ct[r]=lt):ct[r].ia[u-2]=lt,[]}),[]})},I:function(o,r,u){o=Tt(o),zt([],[r],function(f){return f=f[0],s[o]=f.fromWireType(u),[]})},E:function(o,r){r=Tt(r),Ht(o,{name:r,fromWireType:function(u){var f=On(u);return mi(u),f},toWireType:function(u,f){return Qt(f)},argPackAdvance:8,readValueFromPointer:Kt,ja:null})},h:function(o,r,u,f){function _(){}u=xe(u),r=Tt(r),_.values={},Ht(o,{name:r,constructor:_,fromWireType:function(w){return this.constructor.values[w]},toWireType:function(w,x){return x.value},argPackAdvance:8,readValueFromPointer:Ir(r,u,f),ja:null}),gn(r,_)},k:function(o,r,u){var f=Ue(o,"enum");r=Tt(r),o=f.constructor,f=Object.create(f.constructor.prototype,{value:{value:u},constructor:{value:dn(f.name+"_"+r,function(){})}}),o.values[u]=f,o[r]=f},q:function(o,r,u){u=xe(u),r=Tt(r),Ht(o,{name:r,fromWireType:function(f){return f},toWireType:function(f,_){return _},argPackAdvance:8,readValueFromPointer:Ar(r,u),ja:null})},f:function(o,r,u,f,_,w){var x=vn(r,u);o=Tt(o),_=Bt(f,_),gn(o,function(){Le("Cannot call "+o+" due to unbound types",x)},r-1),zt([],x,function(R){return R=[R[0],null].concat(R.slice(1)),hi(o,En(o,R,null,_,w),r-1),[]})},e:function(o,r,u,f,_){r=Tt(r),_===-1&&(_=4294967295),_=xe(u);var w=R=>R;if(f===0){var x=32-8*u;w=R=>R<<x>>>x}u=r.includes("unsigned")?function(R,M){return M>>>0}:function(R,M){return M},Ht(o,{name:r,fromWireType:w,toWireType:u,argPackAdvance:8,readValueFromPointer:br(r,_,f!==0),ja:null})},b:function(o,r,u){function f(w){w>>=2;var x=pt;return new _(ht,x[w+1],x[w])}var _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][r];u=Tt(u),Ht(o,{name:u,fromWireType:f,argPackAdvance:8,readValueFromPointer:f},{Qa:!0})},p:function(o,r){r=Tt(r);var u=r==="std::string";Ht(o,{name:r,fromWireType:function(f){var _=pt[f>>2];if(u)for(var w=f+4,x=0;x<=_;++x){var R=f+4+x;if(x==_||Q[R]==0){if(w=w?m(Q,w,R-w):"",M===void 0)var M=w;else M+=String.fromCharCode(0),M+=w;w=R+1}}else{for(M=Array(_),x=0;x<_;++x)M[x]=String.fromCharCode(Q[f+4+x]);M=M.join("")}return qt(f),M},toWireType:function(f,_){_ instanceof ArrayBuffer&&(_=new Uint8Array(_));var w=typeof _=="string";w||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int8Array||at("Cannot pass non-string to std::string");var x=(u&&w?()=>{for(var W=0,X=0;X<_.length;++X){var Z=_.charCodeAt(X);55296<=Z&&57343>=Z&&(Z=65536+((Z&1023)<<10)|_.charCodeAt(++X)&1023),127>=Z?++W:W=2047>=Z?W+2:65535>=Z?W+3:W+4}return W}:()=>_.length)(),R=bn(4+x+1);if(pt[R>>2]=x,u&&w)d(_,R+4,x+1);else if(w)for(w=0;w<x;++w){var M=_.charCodeAt(w);255<M&&(qt(R),at("String has UTF-16 code units that do not fit in 8 bits")),Q[R+4+w]=M}else for(w=0;w<x;++w)Q[R+4+w]=_[w];return f!==null&&f.push(qt,R),R},argPackAdvance:8,readValueFromPointer:Kt,ja:function(f){qt(f)}})},m:function(o,r,u){if(u=Tt(u),r===2)var f=B,_=nt,w=et,x=()=>ft,R=1;else r===4&&(f=P,_=$,w=ot,x=()=>pt,R=2);Ht(o,{name:u,fromWireType:function(M){for(var W=pt[M>>2],X=x(),Z,ct=M+4,yt=0;yt<=W;++yt){var lt=M+4+yt*r;(yt==W||X[lt>>R]==0)&&(ct=f(ct,lt-ct),Z===void 0?Z=ct:(Z+=String.fromCharCode(0),Z+=ct),ct=lt+r)}return qt(M),Z},toWireType:function(M,W){typeof W!="string"&&at("Cannot pass non-string to C++ string type "+u);var X=w(W),Z=bn(4+X+r);return pt[Z>>2]=X>>R,_(W,Z+4,X+r),M!==null&&M.push(qt,Z),Z},argPackAdvance:8,readValueFromPointer:Kt,ja:function(M){qt(M)}})},t:function(o,r,u,f,_,w){gt[o]={name:Tt(r),sa:Bt(u,f),la:Bt(_,w),elements:[]}},s:function(o,r,u,f,_,w,x,R,M){gt[o].elements.push({Aa:r,ya:Bt(u,f),za:_,Ea:w,Da:Bt(x,R),Fa:M})},v:function(o,r,u,f,_,w){ke[o]={name:Tt(r),sa:Bt(u,f),la:Bt(_,w),Ha:[]}},j:function(o,r,u,f,_,w,x,R,M,W){ke[o].Ha.push({Na:Tt(r),Aa:u,ya:Bt(f,_),za:w,Ea:x,Da:Bt(R,M),Fa:W})},G:function(o,r){r=Tt(r),Ht(o,{Ra:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(o,r,u,f){o=An[o],r=On(r),u=In(u),o(r,u,null,f)},J:mi,x:function(o){return o===0?Qt(gi()):(o=In(o),Qt(gi()[o]))},c:function(o,r){var u=Rr(o,r),f=u[0];r=f.name+"_$"+u.slice(1).map(function(x){return x.name}).join("_")+"$";var _=_i[r];if(_!==void 0)return _;var w=Array(o-1);return _=Sr((x,R,M,W)=>{for(var X=0,Z=0;Z<o-1;++Z)w[Z]=u[Z+1].readValueFromPointer(W+X),X+=u[Z+1].argPackAdvance;for(x=x[R].apply(x,w),Z=0;Z<o-1;++Z)u[Z+1].Ka&&u[Z+1].Ka(w[Z]);if(!f.Ra)return f.toWireType(M,x)}),_i[r]=_},n:function(o){4<o&&(jt[o].Ca+=1)},w:function(o,r,u,f){o=On(o);var _=vi[r];return _||(_=Cr(r),vi[r]=_),_(o,u,f)},K:function(){return Qt([])},D:function(o){return Qt(In(o))},H:function(o,r){return o=Ue(o,"_emval_take_value"),o=o.readValueFromPointer(r),Qt(o)},g:function(){rt("")},B:function(o){var r=Q.length;if(o>>>=0,2147483648<o)return!1;for(var u=1;4>=u;u*=2){var f=r*(1+.2/u);f=Math.min(f,o+100663296),f=Math.max(o,f),0<f%65536&&(f+=65536-f%65536);t:{try{T.grow(Math.min(2147483648,f)-ht.byteLength+65535>>>16),xt();var _=1;break t}catch{}_=void 0}if(_)return!0}return!1},C:function(){return 0},y:function(){},o:function(o,r,u,f){for(var _=0,w=0;w<u;w++){var x=it[r>>2],R=it[r+4>>2];r+=8;for(var M=0;M<R;M++){var W=Q[x+M],X=Nr[o];W===0||W===10?((o===1?V:L)(m(X,0)),X.length=0):X.push(W)}_+=R}return it[f>>2]=_,0},A:function(){}};(function(){function o(_){s.asm=_.exports,T=s.asm.L,xt(),F=s.asm._,p.unshift(s.asm.M),k--,s.monitorRunDependencies&&s.monitorRunDependencies(k),k==0&&H&&(_=H,H=null,_())}function r(_){o(_.instance)}function u(_){return It().then(function(w){return WebAssembly.instantiate(w,f)}).then(function(w){return w}).then(_,function(w){L("failed to asynchronously prepare wasm: "+w),rt(w)})}var f={a:Pr};if(k++,s.monitorRunDependencies&&s.monitorRunDependencies(k),s.instantiateWasm)try{return s.instantiateWasm(f,o)}catch(_){return L("Module.instantiateWasm callback failed with error: "+_),!1}return function(){return q||typeof WebAssembly.instantiateStreaming!="function"||mt()||ut.startsWith("file://")||typeof fetch!="function"?u(r):fetch(ut,{credentials:"same-origin"}).then(function(_){return WebAssembly.instantiateStreaming(_,f).then(r,function(w){return L("wasm streaming compile failed: "+w),L("falling back to ArrayBuffer instantiation"),u(r)})})}().catch(I),{}})(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.M).apply(null,arguments)},s.__Z6ToCmdsRK6SkPath=function(){return(s.__Z6ToCmdsRK6SkPath=s.asm.N).apply(null,arguments)},s.__Z8FromCmdsmi=function(){return(s.__Z8FromCmdsmi=s.asm.O).apply(null,arguments)},s.__Z7NewPathv=function(){return(s.__Z7NewPathv=s.asm.P).apply(null,arguments)},s.__Z8CopyPathRK6SkPath=function(){return(s.__Z8CopyPathRK6SkPath=s.asm.Q).apply(null,arguments)},s.__Z6EqualsRK6SkPathS1_=function(){return(s.__Z6EqualsRK6SkPathS1_=s.asm.R).apply(null,arguments)},s.__Z11ToSVGStringRK6SkPath=function(){return(s.__Z11ToSVGStringRK6SkPath=s.asm.S).apply(null,arguments)},s.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(s.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=s.asm.T).apply(null,arguments)},s.__Z13ApplySimplifyR6SkPath=function(){return(s.__Z13ApplySimplifyR6SkPath=s.asm.U).apply(null,arguments)},s.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(s.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=s.asm.V).apply(null,arguments)},s.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(s.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=s.asm.W).apply(null,arguments)},s.__Z14ResolveBuilderR11SkOpBuilder=function(){return(s.__Z14ResolveBuilderR11SkOpBuilder=s.asm.X).apply(null,arguments)},s.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(s.__Z8ToCanvasRK6SkPathN10emscripten3valE=s.asm.Y).apply(null,arguments)},s.__Z8ToPath2DRK6SkPath=function(){return(s.__Z8ToPath2DRK6SkPath=s.asm.Z).apply(null,arguments)};var qt=s._free=function(){return(qt=s._free=s.asm.$).apply(null,arguments)},bn=s._malloc=function(){return(bn=s._malloc=s.asm.aa).apply(null,arguments)},Ti=s.___getTypeName=function(){return(Ti=s.___getTypeName=s.asm.ba).apply(null,arguments)};s.___embind_register_native_and_builtin_types=function(){return(s.___embind_register_native_and_builtin_types=s.asm.ca).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.da).apply(null,arguments)};var Ve;H=function o(){Ve||Bn(),Ve||(H=o)};function Bn(){function o(){if(!Ve&&(Ve=!0,s.calledRun=!0,!S)){if(vt(p),E(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;){var r=s.postRun.shift();g.unshift(r)}vt(g)}}if(!(0<k)){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)D();vt(c),0<k||(s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),o()},1)):o())}}if(s.run=Bn,s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);0<s.preInit.length;)s.preInit.pop()();return Bn(),a.ready}})();n.exports=e})(cr);var ls=cr.exports;const fs=Xi(ls),ds="/assets/pathkit-1356ccfa.wasm";let $t=null,en="",nn="",rn="",on="";async function lr(){await tt.scene.local.deleteItems([on,en,nn,rn]),en="",nn="",on="",rn=""}async function fr(){if(!$t)return;const[n,t]=$t;t(),$t=null,lr()}async function dr(){if(!$t)return;const[n,t]=$t,e=n(i=>{i.visible=!1,i.metadata[`${j.EXTENSIONID}/isVisionLine`]=!0,i.points.pop(),i.points.push(i.points[0])});e.points.length>=4&&tt.scene.items.addItems([e]),t(),$t=null,lr()}async function hs(n,t){if(!t.transformer)if($t)if(t.target&&(t.target.id===en||t.target.id===nn))dr();else if(t.target&&(t.target.id===on||t.target.id===rn))fr();else{const[e]=$t;e(i=>{i.points.push(t.pointerPosition)})}else{const e=sr().tension(0).points([t.pointerPosition,t.pointerPosition]).fillColor("#000000").strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();$t=await tt.interaction.startItemInteraction(e);const i=ge().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(t.pointerPosition).layer("POPOVER").build(),a=tn().plainText("Finish [Enter]").position(t.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),s=ge().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(t.pointerPosition).layer("POPOVER").visible(!1).build(),l=tn().plainText("Cancel [Escape]").position(t.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await tt.scene.local.addItems([a,i,s,l]),en=a.id,nn=i.id,on=l.id,rn=s.id}}function ps(n,t){if(!$t||t.transformer)return;const[e]=$t;e(i=>{i.points[i.points.length-1]=t.pointerPosition})}function ys(n,t){$t&&(t.key=="Escape"?fr():t.key=="Enter"&&dr())}const Mn={onToolClick:hs,onToolMove:ps,onKeyDown:ys};let Vt=null,Be="",Se="",sn="",an="";async function hr(){await tt.scene.local.deleteItems([an,Be,Se,sn]),Be="",Se="",an="",sn=""}async function pr(){if(!Vt)return;const[n,t]=Vt;t(),Vt=null,await hr()}async function yr(){if(!Vt)return;const[n,t]=Vt,e=n(i=>{i.visible=!1,i.metadata[`${j.EXTENSIONID}/isVisionLine`]=!0,i.points.pop()});e.points.length>=2&&await tt.scene.items.addItems([e]),t(),Vt=null,await hr()}async function ms(n,t){if(!t.transformer)if(Vt)if(t.target&&(t.target.id===Be||t.target.id===Se))await yr();else if(t.target&&(t.target.id===an||t.target.id===sn))await pr();else{const[e]=Vt;e(i=>{i.points.push(t.pointerPosition)}),await tt.scene.local.updateItems(i=>i.id==Se||i.id==Be,i=>{for(const a of i)a.position=t.pointerPosition})}else{const e=sr().tension(0).points([t.pointerPosition,t.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Vt=await tt.interaction.startItemInteraction(e);const i=ge().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(t.pointerPosition).layer("POPOVER").build(),a=tn().plainText("Finish [Enter]").position(t.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),s=ge().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(t.pointerPosition).layer("POPOVER").visible(!1).build(),l=tn().plainText("Cancel [Escape]").position(t.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build();await tt.scene.local.addItems([a,i,s,l]),Be=a.id,Se=i.id,an=l.id,sn=s.id}}function gs(n,t){if(!Vt||t.transformer)return;const[e]=Vt,i=Math.round(z.gridDpi/z.gridSnap),a=Math.round(t.pointerPosition.x/z.gridDpi)*z.gridDpi,s=Math.round(t.pointerPosition.y/z.gridDpi)*z.gridDpi,l=Math.abs(a-t.pointerPosition.x),E=Math.abs(s-t.pointerPosition.y);let I,v;l<=i?I=a:I=t.pointerPosition.x,E<=i?v=s:v=t.pointerPosition.y,e(y=>{y.points[y.points.length-1]={x:I,y:v}})}function _s(n,t){Vt&&(t.key=="Escape"?pr():t.key=="Enter"&&yr())}const Ln={onToolClick:ms,onToolMove:gs,onKeyDown:_s};class Vi{constructor(){_t(this,"startTime");_t(this,"accumulatedTime");this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const t=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,t}else{const t=this.accumulatedTime;return this.accumulatedTime=0,t}}}function We(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mr={exports:{}};(function(n,t){(function(e){n.exports=e()})(function(){return function e(i,a,s){function l(v,y){if(!a[v]){if(!i[v]){var A=typeof We=="function"&&We;if(!y&&A)return A(v,!0);if(E)return E(v,!0);throw new Error("Cannot find module '"+v+"'")}y=a[v]={exports:{}},i[v][0].call(y.exports,function(K){var J=i[v][1][K];return l(J||K)},y,y.exports,e,i,a,s)}return a[v].exports}for(var E=typeof We=="function"&&We,I=0;I<s.length;I++)l(s[I]);return l}({1:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){var C=e("crypto");function G(T,S){S=U(T,S);var h;return(h=S.algorithm!=="passthrough"?C.createHash(S.algorithm):new q).write===void 0&&(h.write=h.update,h.end=h.update),L(S,h).dispatch(T),h.update||h.end(""),h.digest?h.digest(S.encoding==="buffer"?void 0:S.encoding):(T=h.read(),S.encoding!=="buffer"?T.toString(S.encoding):T)}(a=i.exports=G).sha1=function(T){return G(T)},a.keys=function(T){return G(T,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(T){return G(T,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(T){return G(T,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var b=C.getHashes?C.getHashes().slice():["sha1","md5"],N=(b.push("passthrough"),["buffer","hex","binary","base64"]);function U(T,S){var h={};if(h.algorithm=(S=S||{}).algorithm||"sha1",h.encoding=S.encoding||"hex",h.excludeValues=!!S.excludeValues,h.algorithm=h.algorithm.toLowerCase(),h.encoding=h.encoding.toLowerCase(),h.ignoreUnknown=S.ignoreUnknown===!0,h.respectType=S.respectType!==!1,h.respectFunctionNames=S.respectFunctionNames!==!1,h.respectFunctionProperties=S.respectFunctionProperties!==!1,h.unorderedArrays=S.unorderedArrays===!0,h.unorderedSets=S.unorderedSets!==!1,h.unorderedObjects=S.unorderedObjects!==!1,h.replacer=S.replacer||void 0,h.excludeKeys=S.excludeKeys||void 0,T===void 0)throw new Error("Object argument required.");for(var m=0;m<b.length;++m)b[m].toLowerCase()===h.algorithm.toLowerCase()&&(h.algorithm=b[m]);if(b.indexOf(h.algorithm)===-1)throw new Error('Algorithm "'+h.algorithm+'"  not supported. supported values: '+b.join(", "));if(N.indexOf(h.encoding)===-1&&h.algorithm!=="passthrough")throw new Error('Encoding "'+h.encoding+'"  not supported. supported values: '+N.join(", "));return h}function V(T){if(typeof T=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(T))!=null}function L(T,S,h){h=h||[];function m(d){return S.update?S.update(d,"utf8"):S.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=T.replacer?T.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var O,B=Object.prototype.toString.call(d),nt=/\[object (.*)\]/i.exec(B);if(nt=(nt=nt?nt[1]:"unknown:["+B+"]").toLowerCase(),0<=(B=h.indexOf(d)))return this.dispatch("[CIRCULAR:"+B+"]");if(h.push(d),E!==void 0&&E.isBuffer&&E.isBuffer(d))return m("buffer:"),m(d);if(nt==="object"||nt==="function"||nt==="asyncfunction")return B=Object.keys(d),T.unorderedObjects&&(B=B.sort()),T.respectType===!1||V(d)||B.splice(0,0,"prototype","__proto__","constructor"),T.excludeKeys&&(B=B.filter(function(et){return!T.excludeKeys(et)})),m("object:"+B.length+":"),O=this,B.forEach(function(et){O.dispatch(et),m(":"),T.excludeValues||O.dispatch(d[et]),m(",")});if(!this["_"+nt]){if(T.ignoreUnknown)return m("["+nt+"]");throw new Error('Unknown object type "'+nt+'"')}this["_"+nt](d)},_array:function(d,et){et=et!==void 0?et:T.unorderedArrays!==!1;var B=this;if(m("array:"+d.length+":"),!et||d.length<=1)return d.forEach(function(P){return B.dispatch(P)});var nt=[],et=d.map(function(P){var $=new q,ot=h.slice();return L(T,$,ot).dispatch(P),nt=nt.concat(ot.slice(h.length)),$.read().toString()});return h=h.concat(nt),et.sort(),this._array(et,!1)},_date:function(d){return m("date:"+d.toJSON())},_symbol:function(d){return m("symbol:"+d.toString())},_error:function(d){return m("error:"+d.toString())},_boolean:function(d){return m("bool:"+d.toString())},_string:function(d){m("string:"+d.length+":"),m(d.toString())},_function:function(d){m("fn:"),V(d)?this.dispatch("[native]"):this.dispatch(d.toString()),T.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),T.respectFunctionProperties&&this._object(d)},_number:function(d){return m("number:"+d.toString())},_xml:function(d){return m("xml:"+d.toString())},_null:function(){return m("Null")},_undefined:function(){return m("Undefined")},_regexp:function(d){return m("regex:"+d.toString())},_uint8array:function(d){return m("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return m("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return m("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return m("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return m("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return m("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return m("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return m("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return m("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return m("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return m("url:"+d.toString())},_map:function(d){return m("map:"),d=Array.from(d),this._array(d,T.unorderedSets!==!1)},_set:function(d){return m("set:"),d=Array.from(d),this._array(d,T.unorderedSets!==!1)},_file:function(d){return m("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(T.ignoreUnknown)return m("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return m("domwindow")},_bigint:function(d){return m("bigint:"+d.toString())},_process:function(){return m("process")},_timer:function(){return m("timer")},_pipe:function(){return m("pipe")},_tcp:function(){return m("tcp")},_udp:function(){return m("udp")},_tty:function(){return m("tty")},_statwatcher:function(){return m("statwatcher")},_securecontext:function(){return m("securecontext")},_connection:function(){return m("connection")},_zlib:function(){return m("zlib")},_context:function(){return m("context")},_nodescript:function(){return m("nodescript")},_httpparser:function(){return m("httpparser")},_dataview:function(){return m("dataview")},_signal:function(){return m("signal")},_fsevent:function(){return m("fsevent")},_tlswrap:function(){return m("tlswrap")}}}function q(){return{buf:"",write:function(T){this.buf+=T},end:function(T){this.buf+=T},read:function(){return this.buf}}}a.writeToStream=function(T,S,h){return h===void 0&&(h=S,S={}),L(S=U(T,S),h).dispatch(T)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){(function(C){var G=typeof Uint8Array<"u"?Uint8Array:Array,b="+".charCodeAt(0),N="/".charCodeAt(0),U="0".charCodeAt(0),V="a".charCodeAt(0),L="A".charCodeAt(0),q="-".charCodeAt(0),T="_".charCodeAt(0);function S(h){return h=h.charCodeAt(0),h===b||h===q?62:h===N||h===T?63:h<U?-1:h<U+10?h-U+26+26:h<L+26?h-L:h<V+26?h-V+26:void 0}C.toByteArray=function(h){var m,d;if(0<h.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var O=h.length,O=h.charAt(O-2)==="="?2:h.charAt(O-1)==="="?1:0,B=new G(3*h.length/4-O),nt=0<O?h.length-4:h.length,et=0;function P($){B[et++]=$}for(m=0;m<nt;m+=4,0)P((16711680&(d=S(h.charAt(m))<<18|S(h.charAt(m+1))<<12|S(h.charAt(m+2))<<6|S(h.charAt(m+3))))>>16),P((65280&d)>>8),P(255&d);return O==2?P(255&(d=S(h.charAt(m))<<2|S(h.charAt(m+1))>>4)):O==1&&(P((d=S(h.charAt(m))<<10|S(h.charAt(m+1))<<4|S(h.charAt(m+2))>>2)>>8&255),P(255&d)),B},C.fromByteArray=function(h){var m,d,O,B,nt=h.length%3,et="";function P($){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt($)}for(m=0,O=h.length-nt;m<O;m+=3)d=(h[m]<<16)+(h[m+1]<<8)+h[m+2],et+=P((B=d)>>18&63)+P(B>>12&63)+P(B>>6&63)+P(63&B);switch(nt){case 1:et=(et+=P((d=h[h.length-1])>>2))+P(d<<4&63)+"==";break;case 2:et=(et=(et+=P((d=(h[h.length-2]<<8)+h[h.length-1])>>10))+P(d>>4&63))+P(d<<2&63)+"="}return et}})(a===void 0?this.base64js={}:a)}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(e,i,a){(function(s,l,b,I,v,y,A,K,J){var C=e("base64-js"),G=e("ieee754");function b(c,p,g){if(!(this instanceof b))return new b(c,p,g);var D,k,H,rt,mt=typeof c;if(p==="base64"&&mt=="string")for(c=(rt=c).trim?rt.trim():rt.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(mt=="number")D=ht(c);else if(mt=="string")D=b.byteLength(c,p);else{if(mt!="object")throw new Error("First argument needs to be a number, array or string.");D=ht(c.length)}if(b._useTypedArrays?k=b._augment(new Uint8Array(D)):((k=this).length=D,k._isBuffer=!0),b._useTypedArrays&&typeof c.byteLength=="number")k._set(c);else if(Y(rt=c)||b.isBuffer(rt)||rt&&typeof rt=="object"&&typeof rt.length=="number")for(H=0;H<D;H++)b.isBuffer(c)?k[H]=c.readUInt8(H):k[H]=c[H];else if(mt=="string")k.write(c,0,p);else if(mt=="number"&&!b._useTypedArrays&&!g)for(H=0;H<D;H++)k[H]=0;return k}function N(c,p,g,D){return b._charsWritten=it(function(k){for(var H=[],rt=0;rt<k.length;rt++)H.push(255&k.charCodeAt(rt));return H}(p),c,g,D)}function U(c,p,g,D){return b._charsWritten=it(function(k){for(var H,rt,mt=[],ut=0;ut<k.length;ut++)rt=k.charCodeAt(ut),H=rt>>8,rt=rt%256,mt.push(rt),mt.push(H);return mt}(p),c,g,D)}function V(c,p,g){var D="";g=Math.min(c.length,g);for(var k=p;k<g;k++)D+=String.fromCharCode(c[k]);return D}function L(c,p,g,H){H||(F(typeof g=="boolean","missing or invalid endian"),F(p!=null,"missing offset"),F(p+1<c.length,"Trying to read beyond buffer length"));var k,H=c.length;if(!(H<=p))return g?(k=c[p],p+1<H&&(k|=c[p+1]<<8)):(k=c[p]<<8,p+1<H&&(k|=c[p+1])),k}function q(c,p,g,H){H||(F(typeof g=="boolean","missing or invalid endian"),F(p!=null,"missing offset"),F(p+3<c.length,"Trying to read beyond buffer length"));var k,H=c.length;if(!(H<=p))return g?(p+2<H&&(k=c[p+2]<<16),p+1<H&&(k|=c[p+1]<<8),k|=c[p],p+3<H&&(k+=c[p+3]<<24>>>0)):(p+1<H&&(k=c[p+1]<<16),p+2<H&&(k|=c[p+2]<<8),p+3<H&&(k|=c[p+3]),k+=c[p]<<24>>>0),k}function T(c,p,g,D){if(D||(F(typeof g=="boolean","missing or invalid endian"),F(p!=null,"missing offset"),F(p+1<c.length,"Trying to read beyond buffer length")),!(c.length<=p))return D=L(c,p,g,!0),32768&D?-1*(65535-D+1):D}function S(c,p,g,D){if(D||(F(typeof g=="boolean","missing or invalid endian"),F(p!=null,"missing offset"),F(p+3<c.length,"Trying to read beyond buffer length")),!(c.length<=p))return D=q(c,p,g,!0),2147483648&D?-1*(4294967295-D+1):D}function h(c,p,g,D){return D||(F(typeof g=="boolean","missing or invalid endian"),F(p+3<c.length,"Trying to read beyond buffer length")),G.read(c,p,g,23,4)}function m(c,p,g,D){return D||(F(typeof g=="boolean","missing or invalid endian"),F(p+7<c.length,"Trying to read beyond buffer length")),G.read(c,p,g,52,8)}function d(c,p,g,D,k){if(k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+1<c.length,"trying to write beyond buffer length"),Et(p,65535)),k=c.length,!(k<=g))for(var H=0,rt=Math.min(k-g,2);H<rt;H++)c[g+H]=(p&255<<8*(D?H:1-H))>>>8*(D?H:1-H)}function O(c,p,g,D,k){if(k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+3<c.length,"trying to write beyond buffer length"),Et(p,4294967295)),k=c.length,!(k<=g))for(var H=0,rt=Math.min(k-g,4);H<rt;H++)c[g+H]=p>>>8*(D?H:3-H)&255}function B(c,p,g,D,k){k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+1<c.length,"Trying to write beyond buffer length"),kt(p,32767,-32768)),c.length<=g||d(c,0<=p?p:65535+p+1,g,D,k)}function nt(c,p,g,D,k){k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+3<c.length,"Trying to write beyond buffer length"),kt(p,2147483647,-2147483648)),c.length<=g||O(c,0<=p?p:4294967295+p+1,g,D,k)}function et(c,p,g,D,k){k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+3<c.length,"Trying to write beyond buffer length"),xt(p,34028234663852886e22,-34028234663852886e22)),c.length<=g||G.write(c,p,g,D,23,4)}function P(c,p,g,D,k){k||(F(p!=null,"missing value"),F(typeof D=="boolean","missing or invalid endian"),F(g!=null,"missing offset"),F(g+7<c.length,"Trying to write beyond buffer length"),xt(p,17976931348623157e292,-17976931348623157e292)),c.length<=g||G.write(c,p,g,D,52,8)}a.Buffer=b,a.SlowBuffer=b,a.INSPECT_MAX_BYTES=50,b.poolSize=8192,b._useTypedArrays=function(){try{var c=new ArrayBuffer(0),p=new Uint8Array(c);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),b.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.isBuffer=function(c){return!(c==null||!c._isBuffer)},b.byteLength=function(c,p){var g;switch(c+="",p||"utf8"){case"hex":g=c.length/2;break;case"utf8":case"utf-8":g=st(c).length;break;case"ascii":case"binary":case"raw":g=c.length;break;case"base64":g=ft(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":g=2*c.length;break;default:throw new Error("Unknown encoding")}return g},b.concat=function(c,p){if(F(Y(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new b(0);if(c.length===1)return c[0];if(typeof p!="number")for(k=p=0;k<c.length;k++)p+=c[k].length;for(var g=new b(p),D=0,k=0;k<c.length;k++){var H=c[k];H.copy(g,D),D+=H.length}return g},b.prototype.write=function(c,p,g,D){isFinite(p)?isFinite(g)||(D=g,g=void 0):(ut=D,D=p,p=g,g=ut),p=Number(p)||0;var k,H,rt,mt,ut=this.length-p;switch((!g||ut<(g=Number(g)))&&(g=ut),D=String(D||"utf8").toLowerCase()){case"hex":k=function(Dt,Ot,It,vt){It=Number(It)||0;var gt=Dt.length-It;(!vt||gt<(vt=Number(vt)))&&(vt=gt),F((gt=Ot.length)%2==0,"Invalid hex string"),gt/2<vt&&(vt=gt/2);for(var Wt=0;Wt<vt;Wt++){var Kt=parseInt(Ot.substr(2*Wt,2),16);F(!isNaN(Kt),"Invalid hex string"),Dt[It+Wt]=Kt}return b._charsWritten=2*Wt,Wt}(this,c,p,g);break;case"utf8":case"utf-8":H=this,rt=p,mt=g,k=b._charsWritten=it(st(c),H,rt,mt);break;case"ascii":case"binary":k=N(this,c,p,g);break;case"base64":H=this,rt=p,mt=g,k=b._charsWritten=it(ft(c),H,rt,mt);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":k=U(this,c,p,g);break;default:throw new Error("Unknown encoding")}return k},b.prototype.toString=function(c,p,g){var D,k,H,rt,mt=this;if(c=String(c||"utf8").toLowerCase(),p=Number(p)||0,(g=g!==void 0?Number(g):mt.length)===p)return"";switch(c){case"hex":D=function(ut,Dt,Ot){var It=ut.length;(!Dt||Dt<0)&&(Dt=0),(!Ot||Ot<0||It<Ot)&&(Ot=It);for(var vt="",gt=Dt;gt<Ot;gt++)vt+=Q(ut[gt]);return vt}(mt,p,g);break;case"utf8":case"utf-8":D=function(ut,Dt,Ot){var It="",vt="";Ot=Math.min(ut.length,Ot);for(var gt=Dt;gt<Ot;gt++)ut[gt]<=127?(It+=pt(vt)+String.fromCharCode(ut[gt]),vt=""):vt+="%"+ut[gt].toString(16);return It+pt(vt)}(mt,p,g);break;case"ascii":case"binary":D=V(mt,p,g);break;case"base64":k=mt,rt=g,D=(H=p)===0&&rt===k.length?C.fromByteArray(k):C.fromByteArray(k.slice(H,rt));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":D=function(ut,Dt,Ot){for(var It=ut.slice(Dt,Ot),vt="",gt=0;gt<It.length;gt+=2)vt+=String.fromCharCode(It[gt]+256*It[gt+1]);return vt}(mt,p,g);break;default:throw new Error("Unknown encoding")}return D},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},b.prototype.copy=function(c,p,g,D){if(p=p||0,(D=D||D===0?D:this.length)!==(g=g||0)&&c.length!==0&&this.length!==0){F(g<=D,"sourceEnd < sourceStart"),F(0<=p&&p<c.length,"targetStart out of bounds"),F(0<=g&&g<this.length,"sourceStart out of bounds"),F(0<=D&&D<=this.length,"sourceEnd out of bounds"),D>this.length&&(D=this.length);var k=(D=c.length-p<D-g?c.length-p+g:D)-g;if(k<100||!b._useTypedArrays)for(var H=0;H<k;H++)c[H+p]=this[H+g];else c._set(this.subarray(g,g+k),p)}},b.prototype.slice=function(c,p){var g=this.length;if(c=ot(c,g,0),p=ot(p,g,g),b._useTypedArrays)return b._augment(this.subarray(c,p));for(var D=p-c,k=new b(D,void 0,!0),H=0;H<D;H++)k[H]=this[H+c];return k},b.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},b.prototype.set=function(c,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,p)},b.prototype.readUInt8=function(c,p){if(p||(F(c!=null,"missing offset"),F(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},b.prototype.readUInt16LE=function(c,p){return L(this,c,!0,p)},b.prototype.readUInt16BE=function(c,p){return L(this,c,!1,p)},b.prototype.readUInt32LE=function(c,p){return q(this,c,!0,p)},b.prototype.readUInt32BE=function(c,p){return q(this,c,!1,p)},b.prototype.readInt8=function(c,p){if(p||(F(c!=null,"missing offset"),F(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},b.prototype.readInt16LE=function(c,p){return T(this,c,!0,p)},b.prototype.readInt16BE=function(c,p){return T(this,c,!1,p)},b.prototype.readInt32LE=function(c,p){return S(this,c,!0,p)},b.prototype.readInt32BE=function(c,p){return S(this,c,!1,p)},b.prototype.readFloatLE=function(c,p){return h(this,c,!0,p)},b.prototype.readFloatBE=function(c,p){return h(this,c,!1,p)},b.prototype.readDoubleLE=function(c,p){return m(this,c,!0,p)},b.prototype.readDoubleBE=function(c,p){return m(this,c,!1,p)},b.prototype.writeUInt8=function(c,p,g){g||(F(c!=null,"missing value"),F(p!=null,"missing offset"),F(p<this.length,"trying to write beyond buffer length"),Et(c,255)),p>=this.length||(this[p]=c)},b.prototype.writeUInt16LE=function(c,p,g){d(this,c,p,!0,g)},b.prototype.writeUInt16BE=function(c,p,g){d(this,c,p,!1,g)},b.prototype.writeUInt32LE=function(c,p,g){O(this,c,p,!0,g)},b.prototype.writeUInt32BE=function(c,p,g){O(this,c,p,!1,g)},b.prototype.writeInt8=function(c,p,g){g||(F(c!=null,"missing value"),F(p!=null,"missing offset"),F(p<this.length,"Trying to write beyond buffer length"),kt(c,127,-128)),p>=this.length||(0<=c?this.writeUInt8(c,p,g):this.writeUInt8(255+c+1,p,g))},b.prototype.writeInt16LE=function(c,p,g){B(this,c,p,!0,g)},b.prototype.writeInt16BE=function(c,p,g){B(this,c,p,!1,g)},b.prototype.writeInt32LE=function(c,p,g){nt(this,c,p,!0,g)},b.prototype.writeInt32BE=function(c,p,g){nt(this,c,p,!1,g)},b.prototype.writeFloatLE=function(c,p,g){et(this,c,p,!0,g)},b.prototype.writeFloatBE=function(c,p,g){et(this,c,p,!1,g)},b.prototype.writeDoubleLE=function(c,p,g){P(this,c,p,!0,g)},b.prototype.writeDoubleBE=function(c,p,g){P(this,c,p,!1,g)},b.prototype.fill=function(c,p,g){if(p=p||0,g=g||this.length,F(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),F(p<=g,"end < start"),g!==p&&this.length!==0){F(0<=p&&p<this.length,"start out of bounds"),F(0<=g&&g<=this.length,"end out of bounds");for(var D=p;D<g;D++)this[D]=c}},b.prototype.inspect=function(){for(var c=[],p=this.length,g=0;g<p;g++)if(c[g]=Q(this[g]),g===a.INSPECT_MAX_BYTES){c[g+1]="...";break}return"<Buffer "+c.join(" ")+">"},b.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(b._useTypedArrays)return new b(this).buffer;for(var c=new Uint8Array(this.length),p=0,g=c.length;p<g;p+=1)c[p]=this[p];return c.buffer};var $=b.prototype;function ot(c,p,g){return typeof c!="number"?g:p<=(c=~~c)?p:0<=c||0<=(c+=p)?c:0}function ht(c){return(c=~~Math.ceil(+c))<0?0:c}function Y(c){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(c)}function Q(c){return c<16?"0"+c.toString(16):c.toString(16)}function st(c){for(var p=[],g=0;g<c.length;g++){var D=c.charCodeAt(g);if(D<=127)p.push(c.charCodeAt(g));else for(var k=g,H=(55296<=D&&D<=57343&&g++,encodeURIComponent(c.slice(k,g+1)).substr(1).split("%")),rt=0;rt<H.length;rt++)p.push(parseInt(H[rt],16))}return p}function ft(c){return C.toByteArray(c)}function it(c,p,g,D){for(var k=0;k<D&&!(k+g>=p.length||k>=c.length);k++)p[k+g]=c[k];return k}function pt(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function Et(c,p){F(typeof c=="number","cannot write a non-number as a number"),F(0<=c,"specified a negative value for writing an unsigned value"),F(c<=p,"value is larger than maximum value for type"),F(Math.floor(c)===c,"value has a fractional component")}function kt(c,p,g){F(typeof c=="number","cannot write a non-number as a number"),F(c<=p,"value larger than maximum allowed value"),F(g<=c,"value smaller than minimum allowed value"),F(Math.floor(c)===c,"value has a fractional component")}function xt(c,p,g){F(typeof c=="number","cannot write a non-number as a number"),F(c<=p,"value larger than maximum allowed value"),F(g<=c,"value smaller than minimum allowed value")}function F(c,p){if(!c)throw new Error(p||"Failed assertion")}b._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=$.get,c.set=$.set,c.write=$.write,c.toString=$.toString,c.toLocaleString=$.toString,c.toJSON=$.toJSON,c.copy=$.copy,c.slice=$.slice,c.readUInt8=$.readUInt8,c.readUInt16LE=$.readUInt16LE,c.readUInt16BE=$.readUInt16BE,c.readUInt32LE=$.readUInt32LE,c.readUInt32BE=$.readUInt32BE,c.readInt8=$.readInt8,c.readInt16LE=$.readInt16LE,c.readInt16BE=$.readInt16BE,c.readInt32LE=$.readInt32LE,c.readInt32BE=$.readInt32BE,c.readFloatLE=$.readFloatLE,c.readFloatBE=$.readFloatBE,c.readDoubleLE=$.readDoubleLE,c.readDoubleBE=$.readDoubleBE,c.writeUInt8=$.writeUInt8,c.writeUInt16LE=$.writeUInt16LE,c.writeUInt16BE=$.writeUInt16BE,c.writeUInt32LE=$.writeUInt32LE,c.writeUInt32BE=$.writeUInt32BE,c.writeInt8=$.writeInt8,c.writeInt16LE=$.writeInt16LE,c.writeInt16BE=$.writeInt16BE,c.writeInt32LE=$.writeInt32LE,c.writeInt32BE=$.writeInt32BE,c.writeFloatLE=$.writeFloatLE,c.writeFloatBE=$.writeFloatBE,c.writeDoubleLE=$.writeDoubleLE,c.writeDoubleBE=$.writeDoubleBE,c.fill=$.fill,c.inspect=$.inspect,c.toArrayBuffer=$.toArrayBuffer,c}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(e,i,a){(function(s,l,C,I,v,y,A,K,J){var C=e("buffer").Buffer,G=4,b=new C(G);b.fill(0),i.exports={hash:function(N,U,V,L){for(var q=U(function(d,O){d.length%G!=0&&(B=d.length+(G-d.length%G),d=C.concat([d,b],B));for(var B,nt=[],et=O?d.readInt32BE:d.readInt32LE,P=0;P<d.length;P+=G)nt.push(et.call(d,P));return nt}(N=C.isBuffer(N)?N:new C(N),L),8*N.length),U=L,T=new C(V),S=U?T.writeInt32BE:T.writeInt32LE,h=0;h<q.length;h++)S.call(T,q[h],4*h,!0);return T}}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(e,i,a){(function(s,l,C,I,v,y,A,K,J){var C=e("buffer").Buffer,G=e("./sha"),b=e("./sha256"),N=e("./rng"),U={sha1:G,sha256:b,md5:e("./md5")},V=64,L=new C(V);function q(d,O){var B=U[d=d||"sha1"],nt=[];return B||T("algorithm:",d,"is not yet supported"),{update:function(et){return C.isBuffer(et)||(et=new C(et)),nt.push(et),et.length,this},digest:function(et){var P=C.concat(nt),P=O?function($,ot,ht){C.isBuffer(ot)||(ot=new C(ot)),C.isBuffer(ht)||(ht=new C(ht)),ot.length>V?ot=$(ot):ot.length<V&&(ot=C.concat([ot,L],V));for(var Y=new C(V),Q=new C(V),st=0;st<V;st++)Y[st]=54^ot[st],Q[st]=92^ot[st];return ht=$(C.concat([Y,ht])),$(C.concat([Q,ht]))}(B,O,P):B(P);return nt=null,et?P.toString(et):P}}}function T(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}L.fill(0),a.createHash=function(d){return q(d)},a.createHmac=q,a.randomBytes=function(d,O){if(!O||!O.call)return new C(N(d));try{O.call(this,void 0,new C(N(d)))}catch(B){O(B)}};var S,h=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],m=function(d){a[d]=function(){T("sorry,",d,"is not implemented yet")}};for(S in h)m(h[S])}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){var C=e("./helpers");function G(T,S){T[S>>5]|=128<<S%32,T[14+(S+64>>>9<<4)]=S;for(var h=1732584193,m=-271733879,d=-1732584194,O=271733878,B=0;B<T.length;B+=16){var nt=h,et=m,P=d,$=O,h=N(h,m,d,O,T[B+0],7,-680876936),O=N(O,h,m,d,T[B+1],12,-389564586),d=N(d,O,h,m,T[B+2],17,606105819),m=N(m,d,O,h,T[B+3],22,-1044525330);h=N(h,m,d,O,T[B+4],7,-176418897),O=N(O,h,m,d,T[B+5],12,1200080426),d=N(d,O,h,m,T[B+6],17,-1473231341),m=N(m,d,O,h,T[B+7],22,-45705983),h=N(h,m,d,O,T[B+8],7,1770035416),O=N(O,h,m,d,T[B+9],12,-1958414417),d=N(d,O,h,m,T[B+10],17,-42063),m=N(m,d,O,h,T[B+11],22,-1990404162),h=N(h,m,d,O,T[B+12],7,1804603682),O=N(O,h,m,d,T[B+13],12,-40341101),d=N(d,O,h,m,T[B+14],17,-1502002290),h=U(h,m=N(m,d,O,h,T[B+15],22,1236535329),d,O,T[B+1],5,-165796510),O=U(O,h,m,d,T[B+6],9,-1069501632),d=U(d,O,h,m,T[B+11],14,643717713),m=U(m,d,O,h,T[B+0],20,-373897302),h=U(h,m,d,O,T[B+5],5,-701558691),O=U(O,h,m,d,T[B+10],9,38016083),d=U(d,O,h,m,T[B+15],14,-660478335),m=U(m,d,O,h,T[B+4],20,-405537848),h=U(h,m,d,O,T[B+9],5,568446438),O=U(O,h,m,d,T[B+14],9,-1019803690),d=U(d,O,h,m,T[B+3],14,-187363961),m=U(m,d,O,h,T[B+8],20,1163531501),h=U(h,m,d,O,T[B+13],5,-1444681467),O=U(O,h,m,d,T[B+2],9,-51403784),d=U(d,O,h,m,T[B+7],14,1735328473),h=V(h,m=U(m,d,O,h,T[B+12],20,-1926607734),d,O,T[B+5],4,-378558),O=V(O,h,m,d,T[B+8],11,-2022574463),d=V(d,O,h,m,T[B+11],16,1839030562),m=V(m,d,O,h,T[B+14],23,-35309556),h=V(h,m,d,O,T[B+1],4,-1530992060),O=V(O,h,m,d,T[B+4],11,1272893353),d=V(d,O,h,m,T[B+7],16,-155497632),m=V(m,d,O,h,T[B+10],23,-1094730640),h=V(h,m,d,O,T[B+13],4,681279174),O=V(O,h,m,d,T[B+0],11,-358537222),d=V(d,O,h,m,T[B+3],16,-722521979),m=V(m,d,O,h,T[B+6],23,76029189),h=V(h,m,d,O,T[B+9],4,-640364487),O=V(O,h,m,d,T[B+12],11,-421815835),d=V(d,O,h,m,T[B+15],16,530742520),h=L(h,m=V(m,d,O,h,T[B+2],23,-995338651),d,O,T[B+0],6,-198630844),O=L(O,h,m,d,T[B+7],10,1126891415),d=L(d,O,h,m,T[B+14],15,-1416354905),m=L(m,d,O,h,T[B+5],21,-57434055),h=L(h,m,d,O,T[B+12],6,1700485571),O=L(O,h,m,d,T[B+3],10,-1894986606),d=L(d,O,h,m,T[B+10],15,-1051523),m=L(m,d,O,h,T[B+1],21,-2054922799),h=L(h,m,d,O,T[B+8],6,1873313359),O=L(O,h,m,d,T[B+15],10,-30611744),d=L(d,O,h,m,T[B+6],15,-1560198380),m=L(m,d,O,h,T[B+13],21,1309151649),h=L(h,m,d,O,T[B+4],6,-145523070),O=L(O,h,m,d,T[B+11],10,-1120210379),d=L(d,O,h,m,T[B+2],15,718787259),m=L(m,d,O,h,T[B+9],21,-343485551),h=q(h,nt),m=q(m,et),d=q(d,P),O=q(O,$)}return Array(h,m,d,O)}function b(T,S,h,m,d,O){return q((S=q(q(S,T),q(m,O)))<<d|S>>>32-d,h)}function N(T,S,h,m,d,O,B){return b(S&h|~S&m,T,S,d,O,B)}function U(T,S,h,m,d,O,B){return b(S&m|h&~m,T,S,d,O,B)}function V(T,S,h,m,d,O,B){return b(S^h^m,T,S,d,O,B)}function L(T,S,h,m,d,O,B){return b(h^(S|~m),T,S,d,O,B)}function q(T,S){var h=(65535&T)+(65535&S);return(T>>16)+(S>>16)+(h>>16)<<16|65535&h}i.exports=function(T){return C.hash(T,G,16)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){i.exports=function(C){for(var G,b=new Array(C),N=0;N<C;N++)!(3&N)&&(G=4294967296*Math.random()),b[N]=G>>>((3&N)<<3)&255;return b}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){var C=e("./helpers");function G(U,V){U[V>>5]|=128<<24-V%32,U[15+(V+64>>9<<4)]=V;for(var L,q,T,S=Array(80),h=1732584193,m=-271733879,d=-1732584194,O=271733878,B=-1009589776,nt=0;nt<U.length;nt+=16){for(var et=h,P=m,$=d,ot=O,ht=B,Y=0;Y<80;Y++){S[Y]=Y<16?U[nt+Y]:N(S[Y-3]^S[Y-8]^S[Y-14]^S[Y-16],1);var Q=b(b(N(h,5),(Q=m,q=d,T=O,(L=Y)<20?Q&q|~Q&T:!(L<40)&&L<60?Q&q|Q&T|q&T:Q^q^T)),b(b(B,S[Y]),(L=Y)<20?1518500249:L<40?1859775393:L<60?-1894007588:-899497514)),B=O,O=d,d=N(m,30),m=h,h=Q}h=b(h,et),m=b(m,P),d=b(d,$),O=b(O,ot),B=b(B,ht)}return Array(h,m,d,O,B)}function b(U,V){var L=(65535&U)+(65535&V);return(U>>16)+(V>>16)+(L>>16)<<16|65535&L}function N(U,V){return U<<V|U>>>32-V}i.exports=function(U){return C.hash(U,G,20,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){function C(V,L){var q=(65535&V)+(65535&L);return(V>>16)+(L>>16)+(q>>16)<<16|65535&q}function G(V,L){var q,T=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),h=new Array(64);V[L>>5]|=128<<24-L%32,V[15+(L+64>>9<<4)]=L;for(var m,d,O=0;O<V.length;O+=16){for(var B=S[0],nt=S[1],et=S[2],P=S[3],$=S[4],ot=S[5],ht=S[6],Y=S[7],Q=0;Q<64;Q++)h[Q]=Q<16?V[Q+O]:C(C(C((d=h[Q-2],N(d,17)^N(d,19)^U(d,10)),h[Q-7]),(d=h[Q-15],N(d,7)^N(d,18)^U(d,3))),h[Q-16]),q=C(C(C(C(Y,N(d=$,6)^N(d,11)^N(d,25)),$&ot^~$&ht),T[Q]),h[Q]),m=C(N(m=B,2)^N(m,13)^N(m,22),B&nt^B&et^nt&et),Y=ht,ht=ot,ot=$,$=C(P,q),P=et,et=nt,nt=B,B=C(q,m);S[0]=C(B,S[0]),S[1]=C(nt,S[1]),S[2]=C(et,S[2]),S[3]=C(P,S[3]),S[4]=C($,S[4]),S[5]=C(ot,S[5]),S[6]=C(ht,S[6]),S[7]=C(Y,S[7])}return S}var b=e("./helpers"),N=function(V,L){return V>>>L|V<<32-L},U=function(V,L){return V>>>L};i.exports=function(V){return b.hash(V,G,32,!0)}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){a.read=function(C,G,b,N,O){var V,L,q=8*O-N-1,T=(1<<q)-1,S=T>>1,h=-7,m=b?O-1:0,d=b?-1:1,O=C[G+m];for(m+=d,V=O&(1<<-h)-1,O>>=-h,h+=q;0<h;V=256*V+C[G+m],m+=d,h-=8);for(L=V&(1<<-h)-1,V>>=-h,h+=N;0<h;L=256*L+C[G+m],m+=d,h-=8);if(V===0)V=1-S;else{if(V===T)return L?NaN:1/0*(O?-1:1);L+=Math.pow(2,N),V-=S}return(O?-1:1)*L*Math.pow(2,V-N)},a.write=function(C,G,b,N,U,B){var L,q,T=8*B-U-1,S=(1<<T)-1,h=S>>1,m=U===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=N?0:B-1,O=N?1:-1,B=G<0||G===0&&1/G<0?1:0;for(G=Math.abs(G),isNaN(G)||G===1/0?(q=isNaN(G)?1:0,L=S):(L=Math.floor(Math.log(G)/Math.LN2),G*(N=Math.pow(2,-L))<1&&(L--,N*=2),2<=(G+=1<=L+h?m/N:m*Math.pow(2,1-h))*N&&(L++,N/=2),S<=L+h?(q=0,L=S):1<=L+h?(q=(G*N-1)*Math.pow(2,U),L+=h):(q=G*Math.pow(2,h-1)*Math.pow(2,U),L=0));8<=U;C[b+d]=255&q,d+=O,q/=256,U-=8);for(L=L<<U|q,T+=U;0<T;C[b+d]=255&L,d+=O,L/=256,T-=8);C[b+d-O]|=128*B}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(e,i,a){(function(s,l,E,I,v,y,A,K,J){var C,G,b;function N(){}(s=i.exports={}).nextTick=(G=typeof window<"u"&&window.setImmediate,b=typeof window<"u"&&window.postMessage&&window.addEventListener,G?function(U){return window.setImmediate(U)}:b?(C=[],window.addEventListener("message",function(U){var V=U.source;V!==window&&V!==null||U.data!=="process-tick"||(U.stopPropagation(),0<C.length&&C.shift()())},!0),function(U){C.push(U),window.postMessage("process-tick","*")}):function(U){setTimeout(U,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=N,s.addListener=N,s.once=N,s.off=N,s.removeListener=N,s.removeAllListeners=N,s.emit=N,s.binding=function(U){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(U){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(mr);var vs=mr.exports;const He=Xi(vs);class Es{constructor(t){_t(this,"cache");_t(this,"useHash");this.cache={},this.useHash=t}cacheValue(t,e){this.cache[this.useHash?He(t):String(t)]=e}deleteValue(t){delete this.cache[this.useHash?He(t):String(t)]}getValue(t){return this.cache[this.useHash?He(t):String(t)]}isCached(t){return(this.useHash?He(t):String(t))in this.cache}invalidate(t){t&&Object.entries(this.cache).forEach(([e,i])=>t(e,i)),this.cache={}}}function Xe(n,t){return(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)}function ji(n,t){return n.x==t.x&&n.y==t.y}function Ye(n,t,e){return e===void 0&&(e=.01),Math.abs(n-t)<=e}function Un(n,t){return(n%t+t)%t}async function Ts(){await tt.contextMenu.create({id:`${j.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${j.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(n){await tt.scene.items.updateItems(n.items,t=>{for(const e of t)e.metadata[`${j.EXTENSIONID}/hasVision`]&&e.layer=="CHARACTER"?delete e.metadata[`${j.EXTENSIONID}/hasVision`]:e.layer=="CHARACTER"&&(e.metadata[`${j.EXTENSIONID}/hasVision`]=!0,e.metadata[`${j.EXTENSIONID}/visionRange`]||(e.metadata[`${j.EXTENSIONID}/visionRange`]=j.VISIONDEFAULT))})}}),await tt.contextMenu.create({id:`${j.EXTENSIONID}/set-background-image`,icons:[{icon:"/set-background.svg",label:"Set as background image",filter:{every:[{key:"layer",value:"MAP"},{key:["metadata",`${j.EXTENSIONID}/isBackgroundImage`],value:!0,operator:"!="}]}}],async onClick(n){if(n.items.length!=1)return;const t=n.items[0];await tt.scene.items.updateItems(e=>e.layer=="MAP",e=>{for(const i of e)t.id!=i.id&&i.metadata[`${j.EXTENSIONID}/isBackgroundImage`]?delete i.metadata[`${j.EXTENSIONID}/isBackgroundImage`]:t.id==i.id&&(i.metadata[`${j.EXTENSIONID}/isBackgroundImage`]=!0)})}}),await tt.contextMenu.create({id:`${j.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{every:[{key:["metadata",`${j.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${j.EXTENSIONID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{every:[{key:["metadata",`${j.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(n){await tt.scene.items.updateItems(n.items,t=>{for(const e of t)e.metadata[`${j.EXTENSIONID}/isVisionLine`]&&e.metadata[`${j.EXTENSIONID}/disabled`]?delete e.metadata[`${j.EXTENSIONID}/disabled`]:e.metadata[`${j.EXTENSIONID}/isVisionLine`]&&(e.metadata[`${j.EXTENSIONID}/disabled`]=!0)})}}),await tt.contextMenu.create({id:`${j.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{every:[{key:["metadata",`${j.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${j.EXTENSIONID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{every:[{key:["metadata",`${j.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${j.EXTENSIONID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{every:[{key:["metadata",`${j.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(n){await tt.scene.items.updateItems(n.items,t=>{for(const e of t)e.metadata[`${j.EXTENSIONID}/isVisionLine`]&&e.metadata[`${j.EXTENSIONID}/oneSided`]=="right"?delete e.metadata[`${j.EXTENSIONID}/oneSided`]:e.metadata[`${j.EXTENSIONID}/isVisionLine`]&&e.metadata[`${j.EXTENSIONID}/oneSided`]=="left"?e.metadata[`${j.EXTENSIONID}/oneSided`]="right":e.metadata[`${j.EXTENSIONID}/isVisionLine`]&&(e.metadata[`${j.EXTENSIONID}/oneSided`]="left")})}})}async function Os(){await tt.tool.create({id:`${j.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await tt.tool.activateTool(`${j.EXTENSIONID}/vision-tool`)}})}async function ws(){await tt.tool.createMode({id:`${j.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${j.EXTENSIONID}/vision-tool`]}}],onToolClick:Mn.onToolClick,onToolMove:Mn.onToolMove,onKeyDown:Mn.onKeyDown}),await tt.tool.createMode({id:`${j.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${j.EXTENSIONID}/vision-tool`]}}],onToolClick:Ln.onToolClick,onToolMove:Ln.onToolMove,onKeyDown:Ln.onKeyDown})}function Is(n){for(const[t,e]of Object.entries(n)){const i=document.getElementById(t);i&&(i.innerText=e)}}var Gt,oe=!1;const pe=new Es(!1);async function As(n){if(oe=!0,Gt||(Gt=await fs({locateFile:()=>ds})),!await tt.scene.isReady()){pe.invalidate((P,$)=>$.shadowPath.delete()),oe=!1;return}const t=await tt.scene.local.getItems(),{awaitTimer:e,computeTimer:i,metadata:a,size:s,offset:l,scale:E,visionShapes:I,tokensWithVision:v,invalidateCache:y}=n.detail,[A,K]=s;let J=0,C=0;if(y&&pe.invalidate((P,$)=>$.shadowPath.delete()),i.resume(),!(a[`${j.EXTENSIONID}/visionEnabled`]===!0)||v.length==0){await tt.scene.local.deleteItems(t.filter(Yn).map(P=>P.id)),oe=!1;return}const b=[];for(const P of I)for(let $=0;$<P.points.length-1;$++)b.push({startPosition:{x:P.points[$].x*P.scale.x+P.position.x,y:P.points[$].y*P.scale.y+P.position.y},endPosition:{x:P.points[$+1].x*P.scale.x+P.position.x,y:P.points[$+1].y*P.scale.y+P.position.y},originalShape:P,oneSided:P.metadata[`${j.EXTENSIONID}/oneSided`]});const N=[],U=[],V=z.players.filter(P=>P.role=="GM");for(const P of v){const $=z.userId===P.createdUserId,ot=V.some(Y=>Y.id==P.createdUserId);if(!$&&z.role!=="GM"&&!ot)continue;const ht=pe.getValue(P.id);if(N.push([]),!(ht!==void 0&&ji(ht.player.position,P.position)))for(const Y of b){const Q=(P.position.x-Y.startPosition.x)*(Y.endPosition.y-Y.startPosition.y)-(P.position.y-Y.startPosition.y)*(Y.endPosition.x-Y.startPosition.x);if(Y.oneSided!==void 0&&(Y.oneSided=="right"&&Q>0||Y.oneSided=="left"&&Q<0))continue;const st={x:Y.startPosition.x-P.position.x,y:Y.startPosition.y-P.position.y},ft={x:Y.endPosition.x-P.position.x,y:Y.endPosition.y-P.position.y};var L={x:0,y:0},q={x:0,y:0},T=0,S=0,h=0,m=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
st.x<0?T=l[0]*E[0]:T=(A+l[0])*E[0],st.y<0?S=l[1]*E[1]:S=(K+l[1])*E[1],ft.x<0?h=l[0]*E[0]:h=(A+l[0])*E[0],ft.y<0?m=l[1]*E[1]:m=(K+l[1])*E[1];const it=[],pt=[];if(st.x!=0){const g=st.y/st.x,D=Y.startPosition.y-g*Y.startPosition.x;it.push({x:T,y:g*T+D})}if(st.y!=0){const g=st.x/st.y,D=g*Y.startPosition.y-Y.startPosition.x;it.push({x:g*S-D,y:S})}if(ft.x!=0){const g=ft.y/ft.x,D=Y.endPosition.y-g*Y.endPosition.x;pt.push({x:h,y:g*h+D})}if(ft.y!=0){const g=ft.x/ft.y,D=g*Y.endPosition.y-Y.endPosition.x;pt.push({x:g*m-D,y:m})}it.length==1||Xe(it[0],Y.startPosition)<Xe(it[1],Y.startPosition)?L=it[0]:L=it[1],pt.length==1||Xe(pt[0],Y.endPosition)<Xe(pt[1],Y.endPosition)?q=pt[0]:q=pt[1];const Et=[{x:Y.startPosition.x,y:Y.startPosition.y},L,q,{x:Y.endPosition.x,y:Y.endPosition.y}],kt=[{x:(A+l[0])*E[0],y:l[1]*E[1]},{x:(A+l[0])*E[0],y:(K+l[1])*E[1]},{x:l[0]*E[0],y:(K+l[1])*E[1]},{x:l[0]*E[0],y:l[1]*E[1]}],xt=[0,0];let F=0;for(const g of[L,q])Ye(g.y,l[1]*E[1])?xt[F]=0:Ye(g.y,(K+l[1])*E[1])?xt[F]=2:Ye(g.x,l[0]*E[0])?xt[F]=3:Ye(g.x,(A+l[0])*E[0])&&(xt[F]=1),F++;let c=Math.sign(Q);c=c==0?1:-c;const p=c==1?xt[1]:Un(xt[1]-1,4);for(let g=xt[0]+(c==1?0:-1);Un(g,4)!=p;g+=c)Et.splice(Et.length-2,0,kt[Un(g,4)]);N[N.length-1].push({pointset:Et,fromShape:Y.originalShape})}}if(N.length==0){oe=!1;return}const d={};for(let P=0;P<N.length;P++){const $=v[P];let ot=pe.getValue($.id);if(ot!==void 0&&ji(ot.player.position,$.position)){d[P]=ot.shadowPath.copy(),J++;continue}C++;const ht=N[P],Y=new Gt.SkOpBuilder,Q=Gt.NewPath().rect(l[0],l[1],s[0],s[1]);Y.add(Q,Gt.PathOp.UNION),Q.delete();for(const ft of ht){const it=ft.fromShape,pt=Gt.NewPath();pt.moveTo(ft.pointset[0].x,ft.pointset[0].y);for(let Et=1;Et<ft.pointset.length;Et++)pt.lineTo(ft.pointset[Et].x,ft.pointset[Et].y);if(it.style.closed!=!1){const Et=Gt.NewPath();Et.moveTo(it.points[0].x*it.scale.x+it.position.x,it.points[0].y*it.scale.y+it.position.y);for(let kt=1;kt<it.points.length-1;kt++)Et.lineTo(it.points[kt].x*it.scale.x+it.position.x,it.points[kt].y*it.scale.y+it.position.y);pt.op(Et,Gt.PathOp.DIFFERENCE),Et.delete()}Y.add(pt,Gt.PathOp.DIFFERENCE),pt.delete()}const st=Y.resolve();if(!st){console.error("Couldn't compute fog");return}if(Y.delete(),st!==void 0){st.simplify(),d[P]=st;let ft=pe.getValue($.id);ft!==void 0&&ft.shadowPath.delete(),pe.cacheValue($.id,{shadowPath:st.copy(),player:$})}}for(let P=0;P<v.length;P++){const $=v[P],ot=$.metadata[`${j.EXTENSIONID}/visionRange`],ht=z.userId===v[P].createdUserId,Y=V.some(Q=>Q.id==v[P].createdUserId);if(ot){if(!ht&&z.role!=="GM"&&!Y)continue;const Q=z.gridDpi*(ot/z.gridScale+.5),st=Gt.NewPath().ellipse($.position.x,$.position.y,Q,Q,0,0,2*Math.PI);d[P].op(st,Gt.PathOp.INTERSECT),st.delete();const ft=z.players.find(it=>it.id===$.createdUserId);if(ft&&z.role==="GM"){const it=ge().strokeColor(ft.color).fillOpacity(0).position({x:$.position.x,y:$.position.y}).width(Q*2).height(Q*2).shapeType("CIRCLE").metadata({[`${j.EXTENSIONID}/isIndicatorRing`]:!0}).build();U.push(it)}}}const O=[];for(const P of Object.values(d))O.push({cmds:P.toCmds(),visible:!1,zIndex:3}),P.delete();i.pause(),e.resume();const B=[tt.scene.local.deleteItems(t.filter(os).map(P=>P.id)),tt.scene.local.addItems(O.map(P=>{const $=ns().commands(P.cmds).locked(!0).visible(P.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${j.EXTENSIONID}/isVisionFog`]:!0}).build();return $.zIndex=P.zIndex,$})),tt.scene.local.deleteItems(t.filter(Yn).map(P=>P.id))];U.length>0&&B.push(tt.scene.local.addItems(U)),z.fog.filled||B.push(tt.scene.fog.setFilled(!0)),await Promise.all(B);const[nt,et]=[e.stop(),i.stop()];Is({compute_time:`${et} ms`,communication_time:`${nt} ms`,cache_hits:J,cache_misses:C}),oe=!1}document.addEventListener("updateVision",As);let $n,Fi,Oe=[],Gi,Vn;async function we(){var U;if(oe||!await tt.scene.isReady())return;const[n,t]=[new Vi,new Vi];n.start(),n.pause(),t.start();const e=z.players.filter(V=>V.role=="GM"),i=z.items.filter(V=>V.layer=="CHARACTER"&&e.some(L=>V.createdUserId===L.id)),a=z.role=="GM"?z.items.filter(ar):z.items.filter(as).concat(i),s=z.items.filter(ss),l=(U=z.items.filter(ur))==null?void 0:U[0],E=z.metadata[`${j.EXTENSIONID}/visionEnabled`]===!0;if(l===void 0)return;const I=[l.width*l.scale.x,l.height*l.scale.y],v=[l.scale.x,l.scale.y],y=[l.position.x,l.position.y],A=document.getElementById("mapHeight"),K=document.getElementById("mapWidth");K.value=(Math.round(I[0])/z.gridDpi).toString(),A.value=(Math.round(I[1])/z.gridDpi).toString();const J=JSON.stringify(s),C=JSON.stringify(a),G=JSON.stringify(l);if(G==Vn&&E==Gi&&$n==J&&Fi==C&&I[0]==Oe[0]&&I[1]==Oe[1])return;let b=!1;(G!=Vn||$n!=J||I[0]!=Oe[0]||I[1]!=Oe[1])&&(b=!0),Vn=G,Fi=C,$n=J,Oe=I,Gi=E,t.pause();const N=new CustomEvent("updateVision",{detail:{awaitTimer:n,computeTimer:t,allItems:z.items,metadata:z.metadata,size:I,offset:y,scale:v,tokensWithVision:a,visionShapes:s,invalidateCache:b}});oe||document.dispatchEvent(N)}const ri=document.getElementById("app");ri.innerHTML=`
  <div>
    <div>
      <div class="title">Smoke! x Dynamic Fog&nbsp;&nbsp;</div>
      <input type="checkbox" id="vision_checkbox" class="large">
    </div>
    <hr>
    <div style="text-align: center;">
      <p><span id="map_size">Boundary Size: 
      <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
      <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
      <input type="button" id="mapSubmit" value="Update"/></span></p>
      <hr>
      <div class="visionTitle">Vision Radius</div>
      <p id="no_tokens_message">Enable vision on your character tokens.</p>
      <div id="token_list_div" style="display: block;">
        <table style="margin: auto; padding: 0;"><tbody id="token_list">
        </tbody></table>
      </div>
      </div>
    <div id="debug_div" style="display: none;">
      <br><hr><br>
      <h2>Debug</h2>
      <h3>Performance Info</h3>
      <ul>
        <li><p>Compute time: <span id=compute_time>N/A</span></p></li>
        <li><p>Communication time: <span id=communication_time>N/A</span></p></li>
        <li><p>Cache hits/misses: <span id=cache_hits>?</span>/<span id=cache_misses>?</span></p></li>
      </ul>
    </div>
  </div>
`;ri.style.textAlign="left";ri.parentElement.style.placeItems="start";const gr=document.getElementById("vision_checkbox"),bs=document.getElementById("token_list"),Wi=document.getElementById("no_tokens_message"),Bs=document.getElementById("mapHeight"),Ss=document.getElementById("mapWidth"),Rs=document.getElementById("mapSubmit");async function Cs(){gr.addEventListener("click",async n=>{if(!z.ready||!n.target){n.preventDefault();return}const t=n.target;await tt.scene.setMetadata({[`${j.EXTENSIONID}/visionEnabled`]:t.checked})},!1)}function Ze(n){const t=n.filter(ar);z.metadata&&(gr.checked=z.metadata[`${j.EXTENSIONID}/visionEnabled`]==!0),t.length>0?Wi.style.display="none":Wi.style.display="block";const e=document.getElementsByClassName("token-table-entry"),i=[];for(const a of e){const s=a.id.slice(3);t.find(l=>l.id===s)===void 0&&i.push(a)}for(const a of i)a.remove();for(const a of t){const s=document.getElementById(`tr-${a.id}`);if(s){const l=s.getElementsByClassName("token-name")[0],E=s.getElementsByClassName("token-vision-range")[0],I=s.getElementsByClassName("unlimited-vision")[0];l&&(l.innerText=a.name),E&&(I.checked||(E.value=a.metadata[`${j.EXTENSIONID}/visionRange`]?a.metadata[`${j.EXTENSIONID}/visionRange`]:j.VISIONDEFAULT)),I&&(I.checked=!a.metadata[`${j.EXTENSIONID}/visionRange`]),I.checked?E.setAttribute("disabled","disabled"):E.removeAttribute("disabled")}else{const l=document.createElement("tr");l.id=`tr-${a.id}`,l.className="token-table-entry",l.innerHTML=`<td class="token-name">${a.name}</td><td><input class="token-vision-range" type="number" value=${j.VISIONDEFAULT}><span class="unit">ft</span></td><td>&nbsp;&nbsp;&infin;&nbsp<input type="checkbox" class="unlimited-vision"></td>`,bs.appendChild(l);const E=l.getElementsByClassName("token-vision-range")[0],I=l.getElementsByClassName("unlimited-vision")[0];E.addEventListener("change",async v=>{if(!v||!v.target)return;const y=v.target,A=parseInt(y.value);A<0&&(y.value="0"),A>999&&(y.value="999"),await tt.scene.items.updateItems([a],K=>{K[0].metadata[`${j.EXTENSIONID}/visionRange`]=A})},!1),I.addEventListener("click",async v=>{if(!v||!v.target)return;let y=0;v.target.checked?E.setAttribute("disabled","disabled"):(y=parseInt(E.value),E.removeAttribute("disabled")),await tt.scene.items.updateItems([a],K=>{K[0].metadata[`${j.EXTENSIONID}/visionRange`]=y})},!1)}}}async function Hi(n){let t,e;[z.items,z.metadata,z.gridDpi,z.gridScale,t,e]=await Promise.all([tt.scene.items.getItems(),tt.scene.getMetadata(),tt.scene.grid.getDpi(),tt.scene.grid.getScale(),tt.scene.fog.getFilled(),tt.scene.fog.getColor()]),await tt.scene.items.deleteItems(z.items.filter(Yn).map(s=>s.id)),z.gridScale=z.gridScale.parsed.multiplier,z.fog={filled:t,style:{color:e,strokeWidth:5}};let i;if(z.items.filter(rs).length==0){const s=z.items.filter(E=>E.layer=="MAP"&&E.type=="IMAGE"),l=s.map(E=>E.image.width*E.image.height/Math.pow(E.grid.dpi,2));i=s[l.indexOf(Math.max(...l))]}let a;z.items.filter(ur).length==0&&(a=ge().width(z.gridDpi*30).height(z.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),a.metadata[`${j.EXTENSIONID}/isBackgroundImage`]=!0,a.id=j.GRIDID,z.items.push(a)),n=="GM"&&(a&&await tt.scene.items.addItems([a]),Rs.onclick=async()=>{await tt.scene.items.updateItems([j.GRIDID],s=>{for(const l of s){const E=l;E.width=z.gridDpi*+Ss.value,E.height=z.gridDpi*+Bs.value}})},Ze(z.items),i!==void 0&&await tt.scene.items.updateItems([i],s=>{s[0].metadata[`${j.EXTENSIONID}/isBackgroundImage`]=!0}))}tt.onReady(async()=>{await tt.player.getRole().then(async n=>{n=="GM"&&(z.role="GM",await Cs(),await Ts(),await Os(),await ws()),tt.scene.fog.onChange(t=>{z.fog=t}),tt.scene.items.onChange(t=>{const e=t;z.items=e,z.ready&&(n=="GM"&&Ze(e),we())}),z.userId=await tt.player.getId(),z.players=await tt.party.getPlayers(),tt.party.onChange(t=>{z.players=t}),tt.scene.grid.onChange(t=>{z.gridDpi=t.dpi,z.gridScale=parseInt(t.scale),z.ready&&we()}),tt.scene.onMetadataChange(t=>{z.metadata=t,z.ready&&we()}),tt.scene.onReadyChange(t=>{z.ready=t,t?(Hi(n),we()):n=="GM"&&Ze([])}),z.ready=await tt.scene.isReady(),z.ready?(Hi(n),we()):n=="GM"&&Ze([])})});
