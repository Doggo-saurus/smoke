var xr=Object.defineProperty;var kr=(n,e,t)=>e in n?xr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ve=(n,e,t)=>(kr(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();var Re=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Lr{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return Re(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECt",{items:e})})}getName(){return Re(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return Re(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return Re(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return Re(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return Re(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return Re(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return Re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return Re(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:i}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return i.indexOf(e)===-1})}getConnectionId(){return Re(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=i=>{e(i.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var Fe=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Dr{constructor(e){this.messageBus=e}reset(){return Fe(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return Fe(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return Fe(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return Fe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return Fe(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return Fe(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return Fe(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return Fe(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function Mr(n){return typeof n.id=="string"}var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ur(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}),t}var Kn={exports:{}},yt=typeof Reflect=="object"?Reflect:null,Ai=yt&&typeof yt.apply=="function"?yt.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},Kt;yt&&typeof yt.ownKeys=="function"?Kt=yt.ownKeys:Object.getOwnPropertySymbols?Kt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Kt=function(e){return Object.getOwnPropertyNames(e)};function $r(n){console&&console.warn&&console.warn(n)}var Yi=Number.isNaN||function(e){return e!==e};function he(){he.init.call(this)}Kn.exports=he;Kn.exports.once=Gr;he.EventEmitter=he;he.prototype._events=void 0;he.prototype._eventsCount=0;he.prototype._maxListeners=void 0;var Ii=10;function un(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(he,"defaultMaxListeners",{enumerable:!0,get:function(){return Ii},set:function(n){if(typeof n!="number"||n<0||Yi(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Ii=n}});he.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};he.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Yi(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ki(n){return n._maxListeners===void 0?he.defaultMaxListeners:n._maxListeners}he.prototype.getMaxListeners=function(){return Ki(this)};he.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var a=e==="error",s=this._events;if(s!==void 0)a=a&&s.error===void 0;else if(!a)return!1;if(a){var f;if(t.length>0&&(f=t[0]),f instanceof Error)throw f;var T=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw T.context=f,T}var b=s[e];if(b===void 0)return!1;if(typeof b=="function")Ai(b,this,t);else for(var v=b.length,y=Qi(b,v),i=0;i<v;++i)Ai(y[i],this,t);return!0};function zi(n,e,t,i){var a,s,f;if(un(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),f=s[e]),f===void 0)f=s[e]=t,++n._eventsCount;else if(typeof f=="function"?f=s[e]=i?[t,f]:[f,t]:i?f.unshift(t):f.push(t),a=Ki(n),a>0&&f.length>a&&!f.warned){f.warned=!0;var T=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");T.name="MaxListenersExceededWarning",T.emitter=n,T.type=e,T.count=f.length,$r(T)}return n}he.prototype.addListener=function(e,t){return zi(this,e,t,!1)};he.prototype.on=he.prototype.addListener;he.prototype.prependListener=function(e,t){return zi(this,e,t,!0)};function Vr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zi(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},a=Vr.bind(i);return a.listener=t,i.wrapFn=a,a}he.prototype.once=function(e,t){return un(t),this.on(e,Zi(this,e,t)),this};he.prototype.prependOnceListener=function(e,t){return un(t),this.prependListener(e,Zi(this,e,t)),this};he.prototype.removeListener=function(e,t){var i,a,s,f,T;if(un(t),a=this._events,a===void 0)return this;if(i=a[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete a[e],a.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,f=i.length-1;f>=0;f--)if(i[f]===t||i[f].listener===t){T=i[f].listener,s=f;break}if(s<0)return this;s===0?i.shift():jr(i,s),i.length===1&&(a[e]=i[0]),a.removeListener!==void 0&&this.emit("removeListener",e,T||t)}return this};he.prototype.off=he.prototype.removeListener;he.prototype.removeAllListeners=function(e){var t,i,a;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),f;for(a=0;a<s.length;++a)f=s[a],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(a=t.length-1;a>=0;a--)this.removeListener(e,t[a]);return this};function qi(n,e,t){var i=n._events;if(i===void 0)return[];var a=i[e];return a===void 0?[]:typeof a=="function"?t?[a.listener||a]:[a]:t?Fr(a):Qi(a,a.length)}he.prototype.listeners=function(e){return qi(this,e,!0)};he.prototype.rawListeners=function(e){return qi(this,e,!1)};he.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):Ji.call(n,e)};he.prototype.listenerCount=Ji;function Ji(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}he.prototype.eventNames=function(){return this._eventsCount>0?Kt(this._events):[]};function Qi(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function jr(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Fr(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function Gr(n,e){return new Promise(function(t,i){function a(f){n.removeListener(e,s),i(f)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",a),t([].slice.call(arguments))}er(n,e,s,{once:!0}),e!=="error"&&Wr(n,a,{once:!0})})}function Wr(n,e,t){typeof n.on=="function"&&er(n,"error",e,t)}function er(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function a(s){i.once&&n.removeEventListener(e,a),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var Hr=Kn.exports;let jt;const Xr=new Uint8Array(16);function Yr(){if(!jt&&(jt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!jt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jt(Xr)}const we=[];for(let n=0;n<256;++n)we.push((n+256).toString(16).slice(1));function Kr(n,e=0){return(we[n[e+0]]+we[n[e+1]]+we[n[e+2]]+we[n[e+3]]+"-"+we[n[e+4]]+we[n[e+5]]+"-"+we[n[e+6]]+we[n[e+7]]+"-"+we[n[e+8]]+we[n[e+9]]+"-"+we[n[e+10]]+we[n[e+11]]+we[n[e+12]]+we[n[e+13]]+we[n[e+14]]+we[n[e+15]]).toLowerCase()}const zr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Bi={randomUUID:zr};function tr(n,e,t){if(Bi.randomUUID&&!e&&!n)return Bi.randomUUID();n=n||{};const i=n.random||(n.rng||Yr)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=i[a];return e}return Kr(i)}class Zr extends Hr.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=i=>{const a=i.data;if(i.origin===this.targetOrigin&&Mr(a)){if(a.id==="OBR_READY"){this.ready=!0;const s=a.data;this.ref=s.ref,this.userId=s.userId}this.emit(a.id,a.data)}},this.send=(i,a,s)=>{var f;if(!this.ref)throw Error("Unable to send message: not ready");(f=window.parent)===null||f===void 0||f.postMessage({id:i,data:a,ref:this.ref,nonce:s},this.targetOrigin)},this.sendAsync=(i,a,s=5e3)=>{const f=`_${tr()}`;return this.send(i,a,f),Promise.race([new Promise((T,b)=>{const v=this;function y(K){v.off(`${i}_RESPONSE${f}`,y),v.off(`${i}_ERROR${f}`,w),T(K)}function w(K){v.off(`${i}_RESPONSE${f}`,y),v.off(`${i}_ERROR${f}`,w),b(K)}this.on(`${i}_RESPONSE${f}`,y),this.on(`${i}_ERROR${f}`,w)}),new Promise((T,b)=>window.setTimeout(()=>b(new Error(`Message ${i} took longer than ${s}ms to get a result`)),s))])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var bi=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class qr{constructor(e){this.messageBus=e}show(e,t){return bi(this,void 0,void 0,function*(){const{id:i}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return i})}close(e){return bi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var lt=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Jr{constructor(e){this.messageBus=e}getColor(){return lt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return lt(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return lt(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=i=>{e(i.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var Ne=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Qr{constructor(e){this.messageBus=e}getDpi(){return Ne(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return Ne(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return Ne(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return Ne(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return Ne(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return Ne(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return Ne(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return Ne(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,i){return Ne(this,void 0,void 0,function*(){const{position:a}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:i});return a})}getDistance(e,t){return Ne(this,void 0,void 0,function*(){const{distance:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return i})}onChange(e){const t=i=>{e(i.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var Ft=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class eo{constructor(e){this.messageBus=e}undo(){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Ft(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Ft(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function Ie(n){for(var e=arguments.length,t=Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(a){return"'"+a+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function at(n){return!!n&&!!n[ke]}function et(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var i=Object.getPrototypeOf(t);if(i===null)return!0;var a=Object.hasOwnProperty.call(i,"constructor")&&i.constructor;return a===Object||typeof a=="function"&&Function.toString.call(a)===uo}(n)||Array.isArray(n)||!!n[It]||!!(!((e=n.constructor)===null||e===void 0)&&e[It])||cn(n)||ln(n))}function mt(n,e,t){t===void 0&&(t=!1),tt(n)===0?(t?Object.keys:ti)(n).forEach(function(i){t&&typeof i=="symbol"||e(i,n[i],n)}):n.forEach(function(i,a){return e(a,i,n)})}function tt(n){var e=n[ke];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:cn(n)?2:ln(n)?3:0}function Ct(n,e){return tt(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function zt(n,e){return tt(n)===2?n.get(e):n[e]}function nr(n,e,t){var i=tt(n);i===2?n.set(e,t):i===3?n.add(t):n[e]=t}function to(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function cn(n){return so&&n instanceof Map}function ln(n){return ao&&n instanceof Set}function rt(n){return n.o||n.t}function zn(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=co(n);delete e[ke];for(var t=ti(e),i=0;i<t.length;i++){var a=t[i],s=e[a];s.writable===!1&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[a]={configurable:!0,writable:!0,enumerable:s.enumerable,value:n[a]})}return Object.create(Object.getPrototypeOf(n),e)}function Zn(n,e){return e===void 0&&(e=!1),qn(n)||at(n)||!et(n)||(tt(n)>1&&(n.set=n.add=n.clear=n.delete=no),Object.freeze(n),e&&mt(n,function(t,i){return Zn(i,!0)},!0)),n}function no(){Ie(2)}function qn(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function Ye(n){var e=Wn[n];return e||Ie(18,n),e}function io(n,e){Wn[n]||(Wn[n]=e)}function Si(){return Rt}function Cn(n,e){e&&(Ye("Patches"),n.u=[],n.s=[],n.v=e)}function qt(n){jn(n),n.p.forEach(ro),n.p=null}function jn(n){n===Rt&&(Rt=n.l)}function Ci(n){return Rt={p:[],l:Rt,h:n,m:!0,_:0}}function ro(n){var e=n[ke];e.i===0||e.i===1?e.j():e.g=!0}function Rn(n,e){e._=e.p.length;var t=e.p[0],i=n!==void 0&&n!==t;return e.h.O||Ye("ES5").S(e,n,i),i?(t[ke].P&&(qt(e),Ie(4)),et(n)&&(n=Jt(e,n),e.l||Qt(e,n)),e.u&&Ye("Patches").M(t[ke].t,n,e.u,e.s)):n=Jt(e,t,[]),qt(e),e.u&&e.v(e.u,e.s),n!==ei?n:void 0}function Jt(n,e,t){if(qn(e))return e;var i=e[ke];if(!i)return mt(e,function(T,b){return Ri(n,i,e,T,b,t)},!0),e;if(i.A!==n)return e;if(!i.P)return Qt(n,i.t,!0),i.t;if(!i.I){i.I=!0,i.A._--;var a=i.i===4||i.i===5?i.o=zn(i.k):i.o,s=a,f=!1;i.i===3&&(s=new Set(a),a.clear(),f=!0),mt(s,function(T,b){return Ri(n,i,a,T,b,t,f)}),Qt(n,a,!1),t&&n.u&&Ye("Patches").N(i,t,n.u,n.s)}return i.o}function Ri(n,e,t,i,a,s,f){if(at(a)){var T=Jt(n,a,s&&e&&e.i!==3&&!Ct(e.R,i)?s.concat(i):void 0);if(nr(t,i,T),!at(T))return;n.m=!1}else f&&t.add(a);if(et(a)&&!qn(a)){if(!n.h.D&&n._<1)return;Jt(n,a),e&&e.A.l||Qt(n,a)}}function Qt(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&Zn(e,t)}function Nn(n,e){var t=n[ke];return(t?rt(t):n)[e]}function Ni(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}}function Fn(n){n.P||(n.P=!0,n.l&&Fn(n.l))}function Pn(n){n.o||(n.o=zn(n.t))}function Gn(n,e,t){var i=cn(e)?Ye("MapSet").F(e,t):ln(e)?Ye("MapSet").T(e,t):n.O?function(a,s){var f=Array.isArray(a),T={i:f?1:0,A:s?s.A:Si(),P:!1,I:!1,R:{},l:s,t:a,k:null,o:null,j:null,C:!1},b=T,v=Hn;f&&(b=[T],v=At);var y=Proxy.revocable(b,v),w=y.revoke,K=y.proxy;return T.k=K,T.j=w,K}(e,t):Ye("ES5").J(e,t);return(t?t.A:Si()).p.push(i),i}function oo(n){return at(n)||Ie(22,n),function e(t){if(!et(t))return t;var i,a=t[ke],s=tt(t);if(a){if(!a.P&&(a.i<4||!Ye("ES5").K(a)))return a.t;a.I=!0,i=Pi(t,s),a.I=!1}else i=Pi(t,s);return mt(i,function(f,T){a&&zt(a.t,f)===T||nr(i,f,e(T))}),s===3?new Set(i):i}(n)}function Pi(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return zn(n)}function Jn(){function n(i){if(!et(i))return i;if(Array.isArray(i))return i.map(n);if(cn(i))return new Map(Array.from(i.entries()).map(function(f){return[f[0],n(f[1])]}));if(ln(i))return new Set(Array.from(i).map(n));var a=Object.create(Object.getPrototypeOf(i));for(var s in i)a[s]=n(i[s]);return Ct(i,It)&&(a[It]=i[It]),a}function e(i){return at(i)?n(i):i}var t="add";io("Patches",{$:function(i,a){return a.forEach(function(s){for(var f=s.path,T=s.op,b=i,v=0;v<f.length-1;v++){var y=tt(b),w=f[v];typeof w!="string"&&typeof w!="number"&&(w=""+w),y!==0&&y!==1||w!=="__proto__"&&w!=="constructor"||Ie(24),typeof b=="function"&&w==="prototype"&&Ie(24),typeof(b=zt(b,w))!="object"&&Ie(15,f.join("/"))}var K=tt(b),Q=n(s.value),R=f[f.length-1];switch(T){case"replace":switch(K){case 2:return b.set(R,Q);case 3:Ie(16);default:return b[R]=Q}case t:switch(K){case 1:return R==="-"?b.push(Q):b.splice(R,0,Q);case 2:return b.set(R,Q);case 3:return b.add(Q);default:return b[R]=Q}case"remove":switch(K){case 1:return b.splice(R,1);case 2:return b.delete(R);case 3:return b.delete(s.value);default:return delete b[R]}default:Ie(17,T)}}),i},N:function(i,a,s,f){switch(i.i){case 0:case 4:case 2:return function(T,b,v,y){var w=T.t,K=T.o;mt(T.R,function(Q,R){var F=zt(w,Q),I=zt(K,Q),P=R?Ct(w,Q)?"replace":t:"remove";if(F!==I||P!=="replace"){var U=b.concat(Q);v.push(P==="remove"?{op:P,path:U}:{op:P,path:U,value:I}),y.push(P===t?{op:"remove",path:U}:P==="remove"?{op:t,path:U,value:e(F)}:{op:"replace",path:U,value:e(F)})}})}(i,a,s,f);case 5:case 1:return function(T,b,v,y){var w=T.t,K=T.R,Q=T.o;if(Q.length<w.length){var R=[Q,w];w=R[0],Q=R[1];var F=[y,v];v=F[0],y=F[1]}for(var I=0;I<w.length;I++)if(K[I]&&Q[I]!==w[I]){var P=b.concat([I]);v.push({op:"replace",path:P,value:e(Q[I])}),y.push({op:"replace",path:P,value:e(w[I])})}for(var U=w.length;U<Q.length;U++){var $=b.concat([U]);v.push({op:t,path:$,value:e(Q[U])})}w.length<Q.length&&y.push({op:"replace",path:b.concat(["length"]),value:w.length})}(i,a,s,f);case 3:return function(T,b,v,y){var w=T.t,K=T.o,Q=0;w.forEach(function(R){if(!K.has(R)){var F=b.concat([Q]);v.push({op:"remove",path:F,value:R}),y.unshift({op:t,path:F,value:R})}Q++}),Q=0,K.forEach(function(R){if(!w.has(R)){var F=b.concat([Q]);v.push({op:t,path:F,value:R}),y.unshift({op:"remove",path:F,value:R})}Q++})}(i,a,s,f)}},M:function(i,a,s,f){s.push({op:"replace",path:[],value:a===ei?void 0:a}),f.push({op:"replace",path:[],value:i})}})}var xi,Rt,Qn=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",so=typeof Map<"u",ao=typeof Set<"u",ki=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",ei=Qn?Symbol.for("immer-nothing"):((xi={})["immer-nothing"]=!0,xi),It=Qn?Symbol.for("immer-draftable"):"__$immer_draftable",ke=Qn?Symbol.for("immer-state"):"__$immer_state",uo=""+Object.prototype.constructor,ti=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,co=Object.getOwnPropertyDescriptors||function(n){var e={};return ti(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},Wn={},Hn={get:function(n,e){if(e===ke)return n;var t=rt(n);if(!Ct(t,e))return function(a,s,f){var T,b=Ni(s,f);return b?"value"in b?b.value:(T=b.get)===null||T===void 0?void 0:T.call(a.k):void 0}(n,t,e);var i=t[e];return n.I||!et(i)?i:i===Nn(n.t,e)?(Pn(n),n.o[e]=Gn(n.A.h,i,n)):i},has:function(n,e){return e in rt(n)},ownKeys:function(n){return Reflect.ownKeys(rt(n))},set:function(n,e,t){var i=Ni(rt(n),e);if(i!=null&&i.set)return i.set.call(n.k,t),!0;if(!n.P){var a=Nn(rt(n),e),s=a==null?void 0:a[ke];if(s&&s.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(to(t,a)&&(t!==void 0||Ct(n.t,e)))return!0;Pn(n),Fn(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return Nn(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,Pn(n),Fn(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=rt(n),i=Reflect.getOwnPropertyDescriptor(t,e);return i&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:i.enumerable,value:t[e]}},defineProperty:function(){Ie(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){Ie(12)}},At={};mt(Hn,function(n,e){At[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),At.deleteProperty=function(n,e){return At.set.call(this,n,e,void 0)},At.set=function(n,e,t){return Hn.set.call(this,n[0],e,t,n[0])};var lo=function(){function n(t){var i=this;this.O=ki,this.D=!0,this.produce=function(a,s,f){if(typeof a=="function"&&typeof s!="function"){var T=s;s=a;var b=i;return function(F){var I=this;F===void 0&&(F=T);for(var P=arguments.length,U=Array(P>1?P-1:0),$=1;$<P;$++)U[$-1]=arguments[$];return b.produce(F,function(D){var Z;return(Z=s).call.apply(Z,[I,D].concat(U))})}}var v;if(typeof s!="function"&&Ie(6),f!==void 0&&typeof f!="function"&&Ie(7),et(a)){var y=Ci(i),w=Gn(i,a,void 0),K=!0;try{v=s(w),K=!1}finally{K?qt(y):jn(y)}return typeof Promise<"u"&&v instanceof Promise?v.then(function(F){return Cn(y,f),Rn(F,y)},function(F){throw qt(y),F}):(Cn(y,f),Rn(v,y))}if(!a||typeof a!="object"){if((v=s(a))===void 0&&(v=a),v===ei&&(v=void 0),i.D&&Zn(v,!0),f){var Q=[],R=[];Ye("Patches").M(a,v,Q,R),f(Q,R)}return v}Ie(21,a)},this.produceWithPatches=function(a,s){if(typeof a=="function")return function(v){for(var y=arguments.length,w=Array(y>1?y-1:0),K=1;K<y;K++)w[K-1]=arguments[K];return i.produceWithPatches(v,function(Q){return a.apply(void 0,[Q].concat(w))})};var f,T,b=i.produce(a,s,function(v,y){f=v,T=y});return typeof Promise<"u"&&b instanceof Promise?b.then(function(v){return[v,f,T]}):[b,f,T]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){et(t)||Ie(8),at(t)&&(t=oo(t));var i=Ci(this),a=Gn(this,t,void 0);return a[ke].C=!0,jn(i),a},e.finishDraft=function(t,i){var a=t&&t[ke],s=a.A;return Cn(s,i),Rn(void 0,s)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!ki&&Ie(20),this.O=t},e.applyPatches=function(t,i){var a;for(a=i.length-1;a>=0;a--){var s=i[a];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}a>-1&&(i=i.slice(a+1));var f=Ye("Patches").$;return at(t)?f(t,i):this.produce(t,function(T){return f(T,i)})},n}(),Le=new lo;Le.produce;var ni=Le.produceWithPatches.bind(Le);Le.setAutoFreeze.bind(Le);Le.setUseProxies.bind(Le);Le.applyPatches.bind(Le);Le.createDraft.bind(Le);Le.finishDraft.bind(Le);var ft=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};Jn();class fo{constructor(e){this.messageBus=e}getItems(e){return ft(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t){return ft(this,void 0,void 0,function*(){let i;this.isItemArray(e)?i=e:i=yield this.getItems(e);const[a,s]=ni(i,t),f=a.map(T=>({id:T.id,type:T.type}));for(const T of s){const[b,v]=T.path;typeof b=="number"&&typeof v=="string"&&(f[b][v]=a[b][v])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:f})})}addItems(e){return ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ft(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return ft(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var dt=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};Jn();class ho{constructor(e){this.messageBus=e}getItems(e){return dt(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,i){return dt(this,void 0,void 0,function*(){const a=yield this.getItems(e),[s,f]=ni(a,t),T=s.map(b=>({id:b.id,type:b.type}));for(const b of f){const[v,y]=b.path;typeof v=="number"&&typeof y=="string"&&(T[v][y]=s[v][y])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:T,fastUpdate:i})})}addItems(e){return dt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return dt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return dt(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return dt(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=i=>{e(i.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var xn=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class po{constructor(e){this.messageBus=e,this.grid=new Qr(e),this.fog=new Jr(e),this.history=new eo(e),this.items=new fo(e),this.local=new ho(e)}isReady(){return xn(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=i=>{e(i.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return xn(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return xn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=i=>{e(i.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function Bt(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:e.icon.startsWith("http")?e.icon:`${window.location.origin}${e.icon}`}))}function ir(n){return Object.assign(Object.assign({},n),{url:n.url.startsWith("http")?n.url:`${window.location.origin}${n.url}`})}var Li=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class yo{constructor(e){this.contextMenus={},this.handleClick=t=>{const i=this.contextMenus[t.id];i&&i.onClick(t.context,t.elementId)},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Li(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bt(e.icons)}),this.contextMenus[e.id]=e})}remove(e){return Li(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var Xe=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class mo{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const i=this.tools[t.id];if(i)if(i.onClick){const a=i.onClick(t.context,t.elementId);Promise.resolve(a).then(s=>{s&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var i;const a=this.toolActions[t.id];a&&((i=a.onClick)===null||i===void 0||i.call(a,t.context,t.elementId))},this.handleToolModeClick=t=>{const i=this.toolModes[t.id];if(i)if(i.onClick){const a=i.onClick(t.context,t.elementId);Promise.resolve(a).then(s=>{s&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const i=this.toolModes[t.id];if(i)if(i.onToolClick){const a=i.onToolClick(t.context,t.event);Promise.resolve(a).then(s=>{s&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const i=this.toolModes[t.id];if(i)if(i.onToolDoubleClick){const a=i.onToolDoubleClick(t.context,t.event);Promise.resolve(a).then(s=>{s&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolDown)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolMove=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolMove)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolUp=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolUp)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolDragStart)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolDragMove)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolDragEnd)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onToolDragCancel)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeKeyDown=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onKeyDown)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeKeyUp=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onKeyUp)===null||i===void 0||i.call(a,t.context,t.event))},this.handleToolModeActivate=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onActivate)===null||i===void 0||i.call(a,t.context))},this.handleToolModeDeactivate=t=>{var i;const a=this.toolModes[t.id];a&&((i=a.onDeactivate)===null||i===void 0||i.call(a,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:Bt(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return Xe(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bt(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bt(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return Xe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var ht=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class go{constructor(e){this.messageBus=e}open(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ir(e)))})}close(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return ht(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return ht(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var Di=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class _o{constructor(e){this.messageBus=e}open(e){return Di(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ir(e)))})}close(e){return Di(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var Pe=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class vo{constructor(e){this.messageBus=e}getWidth(){return Pe(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return Pe(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return Pe(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return Pe(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return Pe(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return Pe(this,void 0,void 0,function*(){const t=Bt([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return Pe(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return Pe(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return Pe(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=i=>{e(i.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Eo=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};Jn();class To{constructor(e){this.messageBus=e}startItemInteraction(e){return Eo(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e});let i=e;return[f=>{const[T,b]=ni(i,f);return i=T,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:t,patches:b}),T},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:t})}]})}}var Oo=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class wo{constructor(e){this.messageBus=e}getPlayers(){return Oo(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=i=>{e(i.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var kn=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Ao{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return kn(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return kn(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=i=>{e(i.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=i=>{e(i.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var Io=globalThis&&globalThis.__awaiter||function(n,e,t,i){function a(s){return s instanceof t?s:new t(function(f){f(s)})}return new(t||(t=Promise))(function(s,f){function T(y){try{v(i.next(y))}catch(w){f(w)}}function b(y){try{v(i.throw(y))}catch(w){f(w)}}function v(y){y.done?s(y.value):a(y.value).then(T,b)}v((i=i.apply(n,e||[])).next())})};class Bo{constructor(e){this.messageBus=e}getTheme(){return Io(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=i=>{e(i.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}class fn{constructor(e){this._item={createdUserId:e.id,id:tr(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:e.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(e){return this._item.createdUserId=e,this.self()}id(e){return this._item.id=e,this.self()}name(e){return this._item.name=e,this.self()}lastModified(e){return this._item.lastModified=e,this.self()}zIndex(e){return this._item.zIndex=e,this.self()}lastModifiedUserId(e){return this._item.lastModifiedUserId=e,this.self()}locked(e){return this._item.locked=e,this.self()}metadata(e){return this._item.metadata=e,this.self()}position(e){return this._item.position=e,this.self()}rotation(e){return this._item.rotation=e,this.self()}scale(e){return this._item.scale=e,this.self()}visible(e){return this._item.visible=e,this.self()}attachedTo(e){return this._item.attachedTo=e,this.self()}layer(e){return this._item.layer=e,this.self()}disableHit(e){return this._item.disableHit=e,this.self()}disableAutoZIndex(e){return this._item.disableAutoZIndex=e,this.self()}disableAttachmentBehavior(e){return this._item.disableAttachmentBehavior=e,this.self()}self(){return this}}class bo extends fn{constructor(e){super(e),this._points=[],this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[],tension:.5},this._item.name="Curve",this._item.layer="DRAWING"}points(e){return this._points=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}tension(e){return this._style.tension=e,this.self()}closed(e){return this._style.closed=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"CURVE",points:this._points,style:this._style})}}class So extends fn{constructor(e){super(e),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:8,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"CENTER",textAlignVertical:"MIDDLE",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"PLAIN",width:"AUTO",height:"AUTO"},this._style={backgroundColor:"#3D4051",backgroundOpacity:1,cornerRadius:8,pointerDirection:"DOWN",pointerWidth:4,pointerHeight:4},this._item.layer="TEXT",this._item.name="Label"}text(e){return this._text=e,this.self()}width(e){return this._text.width=e,this.self()}height(e){return this._text.height=e,this.self()}plainText(e){return this._text.plainText=e,this.self()}padding(e){return this._text.style.padding=e,this.self()}fontFamily(e){return this._text.style.fontFamily=e,this.self()}fontSize(e){return this._text.style.fontSize=e,this.self()}fontWeight(e){return this._text.style.fontWeight=e,this.self()}textAlign(e){return this._text.style.textAlign=e,this.self()}textAlignVertical(e){return this._text.style.textAlignVertical=e,this.self()}fillColor(e){return this._text.style.fillColor=e,this.self()}fillOpacity(e){return this._text.style.fillOpacity=e,this.self()}strokeColor(e){return this._text.style.strokeColor=e,this.self()}strokeOpacity(e){return this._text.style.strokeOpacity=e,this.self()}strokeWidth(e){return this._text.style.strokeWidth=e,this.self()}lineHeight(e){return this._text.style.lineHeight=e,this.self()}style(e){return this._style=e,this.self()}backgroundColor(e){return this._style.backgroundColor=e,this.self()}backgroundOpacity(e){return this._style.backgroundOpacity=e,this.self()}cornerRadius(e){return this._style.cornerRadius=e,this.self()}pointerWidth(e){return this._style.pointerWidth=e,this.self()}pointerHeight(e){return this._style.pointerHeight=e,this.self()}pointerDirection(e){return this._style.pointerDirection=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"LABEL",text:this._text,style:this._style})}}class Co extends fn{constructor(e){super(e),this._width=0,this._height=0,this._shapeType="RECTANGLE",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.layer="DRAWING",this._item.name="Shape"}width(e){return this._width=e,this.self()}height(e){return this._height=e,this.self()}shapeType(e){return this._shapeType=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"SHAPE",width:this._width,height:this._height,shapeType:this._shapeType,style:this._style})}}class Ro extends fn{constructor(e){super(e),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(e){return this._commands=e,this.self()}fillRule(e){return this._fillRule=e,this.self()}style(e){return this._style=e,this.self()}fillColor(e){return this._style.fillColor=e,this.self()}fillOpacity(e){return this._style.fillOpacity=e,this.self()}strokeColor(e){return this._style.strokeColor=e,this.self()}strokeOpacity(e){return this._style.strokeOpacity=e,this.self()}strokeWidth(e){return this._style.strokeWidth=e,this.self()}strokeDash(e){return this._style.strokeDash=e,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const No=typeof atob=="function",ii=typeof Buffer=="function",Mi=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Po="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",xo=Array.prototype.slice.call(Po),Gt=(n=>{let e={};return n.forEach((t,i)=>e[t]=i),e})(xo),ko=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,st=String.fromCharCode.bind(String),Ui=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),rr=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),Lo=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Do=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return st((t>>>10)+55296)+st((t&1023)+56320);case 3:return st((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return st((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Mo=n=>n.replace(Lo,Do),Uo=n=>{if(n=n.replace(/\s+/g,""),!ko.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",i,a;for(let s=0;s<n.length;)e=Gt[n.charAt(s++)]<<18|Gt[n.charAt(s++)]<<12|(i=Gt[n.charAt(s++)])<<6|(a=Gt[n.charAt(s++)]),t+=i===64?st(e>>16&255):a===64?st(e>>16&255,e>>8&255):st(e>>16&255,e>>8&255,e&255);return t},or=No?n=>atob(rr(n)):ii?n=>Buffer.from(n,"base64").toString("binary"):Uo,$o=ii?n=>Ui(Buffer.from(n,"base64")):n=>Ui(or(n).split("").map(e=>e.charCodeAt(0))),Vo=ii?n=>Buffer.from(n,"base64").toString("utf8"):Mi?n=>Mi.decode($o(n)):n=>Mo(or(n)),jo=n=>rr(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),Fo=n=>Vo(jo(n));function Go(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",i="";if(e){const s=Fo(e).split(" ");s.length===2&&(t=s[0],i=s[1])}return{origin:t,roomId:i}}var $i;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})($i||($i={}));const Xn=Go(),Be=new Zr(Xn.origin,Xn.roomId),Wo=new Dr(Be),Nt=new Lr(Be),Ho=new wo(Be),Xo=new qr(Be),Yo=new po(Be),Ko=new yo(Be),zo=new mo(Be),Zo=new go(Be),qo=new _o(Be),Jo=new vo(Be),Qo=new To(Be),es=new Ao(Be),ts=new Bo(Be),ee={onReady:n=>{Be.ready?n():Be.once("OBR_READY",()=>n())},get isReady(){return Be.ready},viewport:Wo,player:Nt,party:Ho,notification:Xo,scene:Yo,contextMenu:Ko,tool:zo,popover:Zo,modal:qo,action:Jo,interaction:Qo,room:es,theme:ts,isAvailable:!!Xn.origin};function sr(){return new bo(Nt)}function en(){return new So(Nt)}function gt(){return new Co(Nt)}function ns(){return new Ro(Nt)}class is{constructor(){ve(this,"userId");ve(this,"role");ve(this,"items");ve(this,"players");ve(this,"metadata");ve(this,"gridDpi");ve(this,"gridScale");ve(this,"fog");ve(this,"ready");this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1}}const te=new is;class H{}ve(H,"EXTENSIONID","com.battle-system.smoke"),ve(H,"VISIONDEFAULT","30"),ve(H,"LABELSID","com.battle-system.labels"),ve(H,"DICENOTATION",/(\d+)[dD](\d+)(.*)$/i),ve(H,"DICEMODIFIER",/([+-])(\d+)/),ve(H,"PARENTHESESMATCH",/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g),ve(H,"PLUSMATCH",/\s(\+\d+)\s/g);function rs(n){return n.layer=="MAP"&&n.metadata[`${H.EXTENSIONID}/isBackgroundImage`]}function Yn(n){return n.metadata[`${H.EXTENSIONID}/isVisionFog`]}function os(n){return n.metadata[`${H.EXTENSIONID}/isIndicatorRing`]}function ss(n){return n.metadata[`${H.EXTENSIONID}/isVisionLine`]&&!n.metadata[`${H.EXTENSIONID}/disabled`]}function ar(n){return n.layer=="CHARACTER"&&n.metadata[`${H.EXTENSIONID}/hasVision`]}function as(n){return n.layer=="CHARACTER"&&n.createdUserId==te.userId&&n.metadata[`${H.EXTENSIONID}/hasVision`]}function ur(n){return n.layer=="DRAWING"&&n.metadata[`${H.EXTENSIONID}/isBackgroundImage`]}var cr={exports:{}};const us={},cs=Object.freeze(Object.defineProperty({__proto__:null,default:us},Symbol.toStringTag,{value:"Module"})),Ln=Ur(cs);(function(n,e){var t=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(a){a=a||{};var s;s||(s=typeof a<"u"?a:{});var f=Object.assign,T,b;s.ready=new Promise(function(o,r){T=o,b=r}),function(o){var r={};o.loadCmdsTypedArray=function(C){for(var L=0,j=0;j<C.length;j++)L+=C[j].length;if(r[L])var W=r[L];else W=new Float32Array(L),r[L]=W;var z=0;for(j=0;j<C.length;j++)for(var le=0;le<C[j].length;le++){var pe=C[j][le];typeof pe=="string"&&(pe=o.SkBits2FloatUnsigned(parseInt(pe))),W[z]=pe,z++}return C=o._malloc(W.length*W.BYTES_PER_ELEMENT),o.HEAPF32.set(W,C/W.BYTES_PER_ELEMENT),[C,L]},o.FromCmds=function(C){C=o.loadCmdsTypedArray(C);var L=o._FromCmds(C[0],C[1]);return o._free(C[0]),L};var u,l,g,A,k;o.cubicYFromX=function(C,L,j,W,z){return u&&l===C&&g===L&&A===j&&k===W||(u&&u.delete(),u=new o._SkCubicMap([C,L],[j,W]),l=C,g=L,A=j,k=W),u.computeYFromX(z)},o.cubicPtFromT=function(C,L,j,W,z){return u&&l===C&&g===L&&A===j&&k===W||(u&&u.delete(),u=new o._SkCubicMap([C,L],[j,W]),l=C,g=L,A=j,k=W),u.computePtFromT(z)}}(s),function(o){o.onRuntimeInitialized=function(){o.SkPath.prototype.addPath=function(){var r=arguments[0];if(arguments.length===1)this._addPath(r,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var u=arguments[1];this._addPath(r,u.a,u.c,u.e,u.b,u.d,u.f,0,0,1)}else if(arguments.length===7)u=arguments,this._addPath(r,u[1],u[3],u[5],u[2],u[4],u[6],0,0,1);else if(arguments.length===10)u=arguments,this._addPath(r,u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},o.SkPath.prototype.arc=function(r,u,l,g,A,k){return this._arc(r,u,l,g,A,!!k),this},o.SkPath.prototype.arcTo=function(r,u,l,g,A){return this._arcTo(r,u,l,g,A),this},o.SkPath.prototype.bezierCurveTo=function(r,u,l,g,A,k){return this._cubicTo(r,u,l,g,A,k),this},o.SkPath.prototype.close=function(){return this._close(),this},o.SkPath.prototype.closePath=function(){return this._close(),this},o.SkPath.prototype.conicTo=function(r,u,l,g,A){return this._conicTo(r,u,l,g,A),this},o.SkPath.prototype.cubicTo=function(r,u,l,g,A,k){return this._cubicTo(r,u,l,g,A,k),this},o.SkPath.prototype.dash=function(r,u,l){return this._dash(r,u,l)?this:null},o.SkPath.prototype.ellipse=function(r,u,l,g,A,k,C,L){return this._ellipse(r,u,l,g,A,k,C,!!L),this},o.SkPath.prototype.lineTo=function(r,u){return this._lineTo(r,u),this},o.SkPath.prototype.moveTo=function(r,u){return this._moveTo(r,u),this},o.SkPath.prototype.op=function(r,u){return this._op(r,u)?this:null},o.SkPath.prototype.quadraticCurveTo=function(r,u,l,g){return this._quadTo(r,u,l,g),this},o.SkPath.prototype.quadTo=function(r,u,l,g){return this._quadTo(r,u,l,g),this},o.SkPath.prototype.rect=function(r,u,l,g){return this._rect(r,u,l,g),this},o.SkPath.prototype.simplify=function(){return this._simplify()?this:null},o.SkPath.prototype.stroke=function(r){return r=r||{},r.width=r.width||1,r.miter_limit=r.miter_limit||4,r.cap=r.cap||o.StrokeCap.BUTT,r.join=r.join||o.StrokeJoin.MITER,this._stroke(r)?this:null},o.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var r=arguments;this._transform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},o.SkPath.prototype.trim=function(r,u,l){return this._trim(r,u,!!l)?this:null}}}(s);var v=f({},s),y=typeof window=="object",w=typeof importScripts=="function",K="",Q,R,F,I,P,U;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(K=w?Ln.dirname(K)+"/":__dirname+"/",U=()=>{P||(I=Ln,P=Ln)},Q=function(o,r){return U(),o=P.normalize(o),I.readFileSync(o,r?null:"utf8")},F=o=>(o=Q(o,!0),o.buffer||(o=new Uint8Array(o)),o),R=(o,r,u)=>{U(),o=P.normalize(o),I.readFile(o,function(l,g){l?u(l):r(g.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(o){throw o}),process.on("unhandledRejection",function(o){throw o}),s.inspect=function(){return"[Emscripten Module object]"}):(y||w)&&(w?K=self.location.href:typeof document<"u"&&document.currentScript&&(K=document.currentScript.src),i&&(K=i),K.indexOf("blob:")!==0?K=K.substr(0,K.replace(/[?#].*/,"").lastIndexOf("/")+1):K="",Q=o=>{var r=new XMLHttpRequest;return r.open("GET",o,!1),r.send(null),r.responseText},w&&(F=o=>{var r=new XMLHttpRequest;return r.open("GET",o,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),R=(o,r,u)=>{var l=new XMLHttpRequest;l.open("GET",o,!0),l.responseType="arraybuffer",l.onload=()=>{l.status==200||l.status==0&&l.response?r(l.response):u()},l.onerror=u,l.send(null)});var $=s.print||console.log.bind(console),D=s.printErr||console.warn.bind(console);f(s,v),v=null;var Z;s.wasmBinary&&(Z=s.wasmBinary),s.noExitRuntime,typeof WebAssembly!="object"&&re("no native wasm support detected");var E,S=!1,h=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function m(o,r,u){var l=r+u;for(u=r;o[u]&&!(u>=l);)++u;if(16<u-r&&o.subarray&&h)return h.decode(o.subarray(r,u));for(l="";r<u;){var g=o[r++];if(g&128){var A=o[r++]&63;if((g&224)==192)l+=String.fromCharCode((g&31)<<6|A);else{var k=o[r++]&63;g=(g&240)==224?(g&15)<<12|A<<6|k:(g&7)<<18|A<<12|k<<6|o[r++]&63,65536>g?l+=String.fromCharCode(g):(g-=65536,l+=String.fromCharCode(55296|g>>10,56320|g&1023))}}else l+=String.fromCharCode(g)}return l}function d(o,r,u){var l=J;if(0<u){u=r+u-1;for(var g=0;g<o.length;++g){var A=o.charCodeAt(g);if(55296<=A&&57343>=A){var k=o.charCodeAt(++g);A=65536+((A&1023)<<10)|k&1023}if(127>=A){if(r>=u)break;l[r++]=A}else{if(2047>=A){if(r+1>=u)break;l[r++]=192|A>>6}else{if(65535>=A){if(r+2>=u)break;l[r++]=224|A>>12}else{if(r+3>=u)break;l[r++]=240|A>>18,l[r++]=128|A>>12&63}l[r++]=128|A>>6&63}l[r++]=128|A&63}}l[r]=0}}var O=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function B(o,r){for(var u=o>>1,l=u+r/2;!(u>=l)&&ue[u];)++u;if(u<<=1,32<u-o&&O)return O.decode(J.subarray(o,u));for(u="",l=0;!(l>=r/2);++l){var g=oe[o+2*l>>1];if(g==0)break;u+=String.fromCharCode(g)}return u}function ne(o,r,u){if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var l=r;u=u<2*o.length?u/2:o.length;for(var g=0;g<u;++g)oe[r>>1]=o.charCodeAt(g),r+=2;return oe[r>>1]=0,r-l}function N(o){return 2*o.length}function Y(o,r){for(var u=0,l="";!(u>=r/4);){var g=de[o+4*u>>2];if(g==0)break;++u,65536<=g?(g-=65536,l+=String.fromCharCode(55296|g>>10,56320|g&1023)):l+=String.fromCharCode(g)}return l}function X(o,r,u){if(u===void 0&&(u=2147483647),4>u)return 0;var l=r;u=l+u-4;for(var g=0;g<o.length;++g){var A=o.charCodeAt(g);if(55296<=A&&57343>=A){var k=o.charCodeAt(++g);A=65536+((A&1023)<<10)|k&1023}if(de[r>>2]=A,r+=4,r+4>u)break}return de[r>>2]=0,r-l}function q(o){for(var r=0,u=0;u<o.length;++u){var l=o.charCodeAt(u);55296<=l&&57343>=l&&++u,r+=4}return r}var se,ie,J,oe,ue,de,ye,Te,De;function Me(){var o=E.buffer;se=o,s.HEAP8=ie=new Int8Array(o),s.HEAP16=oe=new Int16Array(o),s.HEAP32=de=new Int32Array(o),s.HEAPU8=J=new Uint8Array(o),s.HEAPU16=ue=new Uint16Array(o),s.HEAPU32=ye=new Uint32Array(o),s.HEAPF32=Te=new Float32Array(o),s.HEAPF64=De=new Float64Array(o)}var V,c=[],p=[],_=[];function M(){var o=s.preRun.shift();c.unshift(o)}var x=0,G=null;s.preloadedImages={},s.preloadedAudios={};function re(o){throw s.onAbort&&s.onAbort(o),o="Aborted("+o+")",D(o),S=!0,o=new WebAssembly.RuntimeError(o+". Build with -s ASSERTIONS=1 for more info."),b(o),o}function me(){return ce.startsWith("data:application/octet-stream;base64,")}var ce;if(ce="pathkit.wasm",!me()){var xe=ce;ce=s.locateFile?s.locateFile(xe,K):K+xe}function Oe(){var o=ce;try{if(o==ce&&Z)return new Uint8Array(Z);if(F)return F(o);throw"both async and sync fetching of the wasm failed"}catch(r){re(r)}}function Ae(){if(!Z&&(y||w)){if(typeof fetch=="function"&&!ce.startsWith("file://"))return fetch(ce,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+ce+"'";return o.arrayBuffer()}).catch(function(){return Oe()});if(R)return new Promise(function(o,r){R(ce,function(u){o(new Uint8Array(u))},r)})}return Promise.resolve().then(function(){return Oe()})}function _e(o){for(;0<o.length;){var r=o.shift();if(typeof r=="function")r(s);else{var u=r.Wa;typeof u=="number"?r.xa===void 0?V.get(u)():V.get(u)(r.xa):u(r.xa===void 0?null:r.xa)}}}var ge={};function We(o){for(;o.length;){var r=o.pop();o.pop()(r)}}function Ke(o){return this.fromWireType(ye[o>>2])}var ut={},nt={},Pt={};function oi(o){if(o===void 0)return"_unknown";o=o.replace(/[^a-zA-Z0-9_]/g,"$");var r=o.charCodeAt(0);return 48<=r&&57>=r?"_"+o:o}function dn(o,r){return o=oi(o),function(){return r.apply(this,arguments)}}function hn(o){var r=Error,u=dn(o,function(l){this.name=o,this.message=l,l=Error(l).stack,l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(r.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},u}var si=void 0;function xt(o){throw new si(o)}function ze(o,r,u){function l(C){C=u(C),C.length!==o.length&&xt("Mismatched type converter count");for(var L=0;L<o.length;++L)He(o[L],C[L])}o.forEach(function(C){Pt[C]=r});var g=Array(r.length),A=[],k=0;r.forEach(function(C,L){nt.hasOwnProperty(C)?g[L]=nt[C]:(A.push(C),ut.hasOwnProperty(C)||(ut[C]=[]),ut[C].push(function(){g[L]=nt[C],++k,k===A.length&&l(g)}))}),A.length===0&&l(g)}var kt={};function Lt(o){switch(o){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+o)}}var ai=void 0;function Ee(o){for(var r="";J[o];)r+=ai[J[o++]];return r}var ct=void 0;function ae(o){throw new ct(o)}function He(o,r,u={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var l=r.name;if(o||ae('type "'+l+'" must have a positive integer typeid pointer'),nt.hasOwnProperty(o)){if(u.Qa)return;ae("Cannot register type '"+l+"' twice")}nt[o]=r,delete Pt[o],ut.hasOwnProperty(o)&&(r=ut[o],delete ut[o],r.forEach(function(g){g()}))}function pn(o){ae(o.ea.ha.fa.name+" instance already deleted")}var yn=!1;function ui(){}function ci(o){--o.count.value,o.count.value===0&&(o.ka?o.ma.la(o.ka):o.ha.fa.la(o.ga))}function _t(o){return typeof FinalizationGroup>"u"?(_t=r=>r,o):(yn=new FinalizationGroup(function(r){for(var u=r.next();!u.done;u=r.next())u=u.value,u.ga?ci(u):console.warn("object already deleted: "+u.ga)}),_t=r=>(yn.register(r,r.ea,r.ea),r),ui=r=>{yn.unregister(r.ea)},_t(o))}var vt=void 0,Et=[];function mn(){for(;Et.length;){var o=Et.pop();o.ea.pa=!1,o.delete()}}function Je(){}var li={};function fi(o,r,u){if(o[r].ia===void 0){var l=o[r];o[r]=function(){return o[r].ia.hasOwnProperty(arguments.length)||ae("Function '"+u+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+o[r].ia+")!"),o[r].ia[arguments.length].apply(this,arguments)},o[r].ia=[],o[r].ia[l.ua]=l}}function gn(o,r,u){s.hasOwnProperty(o)?((u===void 0||s[o].ia!==void 0&&s[o].ia[u]!==void 0)&&ae("Cannot register public name '"+o+"' twice"),fi(s,o,o),s.hasOwnProperty(u)&&ae("Cannot register multiple overloads of a function with the same number of arguments ("+u+")!"),s[o].ia[u]=r):(s[o]=r,u!==void 0&&(s[o].Xa=u))}function _r(o,r,u,l,g,A,k,C){this.name=o,this.constructor=r,this.qa=u,this.la=l,this.na=g,this.Oa=A,this.ta=k,this.La=C,this.Ta=[]}function _n(o,r,u){for(;r!==u;)r.ta||ae("Expected null or instance of "+u.name+", got an instance of "+r.name),o=r.ta(o),r=r.na;return o}function vr(o,r){return r===null?(this.Ba&&ae("null is not a valid "+this.name),0):(r.ea||ae('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||ae("Cannot pass deleted object as a pointer of type "+this.name),_n(r.ea.ga,r.ea.ha.fa,this.fa))}function Er(o,r){if(r===null){if(this.Ba&&ae("null is not a valid "+this.name),this.wa){var u=this.sa();return o!==null&&o.push(this.la,u),u}return 0}if(r.ea||ae('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||ae("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&r.ea.ha.va&&ae("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name),u=_n(r.ea.ga,r.ea.ha.fa,this.fa),this.wa)switch(r.ea.ka===void 0&&ae("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:r.ea.ma===this?u=r.ea.ka:ae("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name);break;case 1:u=r.ea.ka;break;case 2:if(r.ea.ma===this)u=r.ea.ka;else{var l=r.clone();u=this.Ua(u,Qe(function(){l.delete()})),o!==null&&o.push(this.la,u)}break;default:ae("Unsupporting sharing policy")}return u}function Tr(o,r){return r===null?(this.Ba&&ae("null is not a valid "+this.name),0):(r.ea||ae('Cannot pass "'+wn(r)+'" as a '+this.name),r.ea.ga||ae("Cannot pass deleted object as a pointer of type "+this.name),r.ea.ha.va&&ae("Cannot convert argument of type "+r.ea.ha.name+" to parameter type "+this.name),_n(r.ea.ga,r.ea.ha.fa,this.fa))}function di(o,r,u){return r===u?o:u.na===void 0?null:(o=di(o,r,u.na),o===null?null:u.La(o))}var Tt={};function Or(o,r){for(r===void 0&&ae("ptr should not be undefined");o.na;)r=o.ta(r),o=o.na;return Tt[r]}function Dt(o,r){return r.ha&&r.ga||xt("makeClassHandle requires ptr and ptrType"),!!r.ma!=!!r.ka&&xt("Both smartPtrType and smartPtr must be specified"),r.count={value:1},_t(Object.create(o,{ea:{value:r}}))}function Ze(o,r,u,l){this.name=o,this.fa=r,this.Ba=u,this.va=l,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,r.na!==void 0?this.toWireType=Er:(this.toWireType=l?vr:Tr,this.ja=null)}function hi(o,r,u){s.hasOwnProperty(o)||xt("Replacing nonexistant public symbol"),s[o].ia!==void 0&&u!==void 0?s[o].ia[u]=r:(s[o]=r,s[o].ua=u)}function wr(o,r){var u=[];return function(){u.length=arguments.length;for(var l=0;l<arguments.length;l++)u[l]=arguments[l];return o.includes("j")?(l=s["dynCall_"+o],l=u&&u.length?l.apply(null,[r].concat(u)):l.call(null,r)):l=V.get(r).apply(null,u),l}}function be(o,r){o=Ee(o);var u=o.includes("j")?wr(o,r):V.get(r);return typeof u!="function"&&ae("unknown function pointer with signature "+o+": "+r),u}var pi=void 0;function yi(o){o=Ti(o);var r=Ee(o);return qe(o),r}function Mt(o,r){function u(A){g[A]||nt[A]||(Pt[A]?Pt[A].forEach(u):(l.push(A),g[A]=!0))}var l=[],g={};throw r.forEach(u),new pi(o+": "+l.map(yi).join([", "]))}function vn(o,r){for(var u=[],l=0;l<o;l++)u.push(de[(r>>2)+l]);return u}function En(o,r,u,l,g){var A=r.length;2>A&&ae("argTypes array size mismatch! Must at least get return value and 'this' types!");var k=r[1]!==null&&u!==null,C=!1;for(u=1;u<r.length;++u)if(r[u]!==null&&r[u].ja===void 0){C=!0;break}var L=r[0].name!=="void",j=A-2,W=Array(j),z=[],le=[];return function(){if(arguments.length!==j&&ae("function "+o+" called with "+arguments.length+" arguments, expected "+j+" args!"),le.length=0,z.length=k?2:1,z[0]=g,k){var pe=r[1].toWireType(le,this);z[1]=pe}for(var fe=0;fe<j;++fe)W[fe]=r[fe+2].toWireType(le,arguments[fe]),z.push(W[fe]);if(fe=l.apply(null,z),C)We(le);else for(var Se=k?1:2;Se<r.length;Se++){var Ce=Se===1?pe:W[Se-2];r[Se].ja!==null&&r[Se].ja(Ce)}return pe=L?r[0].fromWireType(fe):void 0,pe}}var Tn=[],je=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function mi(o){4<o&&--je[o].Ca===0&&(je[o]=void 0,Tn.push(o))}function On(o){return o||ae("Cannot use deleted val. handle = "+o),je[o].value}function Qe(o){switch(o){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var r=Tn.length?Tn.pop():je.length;return je[r]={Ca:1,value:o},r}}function Ar(o,r,u){switch(r){case 0:return function(l){return this.fromWireType((u?ie:J)[l])};case 1:return function(l){return this.fromWireType((u?oe:ue)[l>>1])};case 2:return function(l){return this.fromWireType((u?de:ye)[l>>2])};default:throw new TypeError("Unknown integer type: "+o)}}function Ut(o,r){var u=nt[o];return u===void 0&&ae(r+" has unknown type "+yi(o)),u}function wn(o){if(o===null)return"null";var r=typeof o;return r==="object"||r==="array"||r==="function"?o.toString():""+o}function Ir(o,r){switch(r){case 2:return function(u){return this.fromWireType(Te[u>>2])};case 3:return function(u){return this.fromWireType(De[u>>3])};default:throw new TypeError("Unknown float type: "+o)}}function Br(o,r,u){switch(r){case 0:return u?function(l){return ie[l]}:function(l){return J[l]};case 1:return u?function(l){return oe[l>>1]}:function(l){return ue[l>>1]};case 2:return u?function(l){return de[l>>2]}:function(l){return ye[l>>2]};default:throw new TypeError("Unknown integer type: "+o)}}var br={};function An(o){var r=br[o];return r===void 0?Ee(o):r}var In=[];function gi(){function o(r){r.$$$embind_global$$$=r;var u=typeof $$$embind_global$$$=="object"&&r.$$$embind_global$$$===r;return u||delete r.$$$embind_global$$$,u}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof Sn=="object"&&o(Sn)?$$$embind_global$$$=Sn:typeof self=="object"&&o(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Sr(o){var r=In.length;return In.push(o),r}function Cr(o,r){for(var u=Array(o),l=0;l<o;++l)u[l]=Ut(de[(r>>2)+l],"parameter "+l);return u}var _i=[];function Rr(o){var r=Array(o+1);return function(u,l,g){r[0]=u;for(var A=0;A<o;++A){var k=Ut(de[(l>>2)+A],"parameter "+A);r[A+1]=k.readValueFromPointer(g),g+=k.argPackAdvance}return u=new(u.bind.apply(u,r)),Qe(u)}}var vi={},Nr=[null,[],[]];si=s.InternalError=hn("InternalError");for(var Ei=Array(256),$t=0;256>$t;++$t)Ei[$t]=String.fromCharCode($t);ai=Ei,ct=s.BindingError=hn("BindingError"),Je.prototype.isAliasOf=function(o){if(!(this instanceof Je&&o instanceof Je))return!1;var r=this.ea.ha.fa,u=this.ea.ga,l=o.ea.ha.fa;for(o=o.ea.ga;r.na;)u=r.ta(u),r=r.na;for(;l.na;)o=l.ta(o),l=l.na;return r===l&&u===o},Je.prototype.clone=function(){if(this.ea.ga||pn(this),this.ea.ra)return this.ea.count.value+=1,this;var o=_t,r=Object,u=r.create,l=Object.getPrototypeOf(this),g=this.ea;return o=o(u.call(r,l,{ea:{value:{count:g.count,pa:g.pa,ra:g.ra,ga:g.ga,ha:g.ha,ka:g.ka,ma:g.ma}}})),o.ea.count.value+=1,o.ea.pa=!1,o},Je.prototype.delete=function(){this.ea.ga||pn(this),this.ea.pa&&!this.ea.ra&&ae("Object already scheduled for deletion"),ui(this),ci(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},Je.prototype.isDeleted=function(){return!this.ea.ga},Je.prototype.deleteLater=function(){return this.ea.ga||pn(this),this.ea.pa&&!this.ea.ra&&ae("Object already scheduled for deletion"),Et.push(this),Et.length===1&&vt&&vt(mn),this.ea.pa=!0,this},Ze.prototype.Pa=function(o){return this.Ia&&(o=this.Ia(o)),o},Ze.prototype.Ga=function(o){this.la&&this.la(o)},Ze.prototype.argPackAdvance=8,Ze.prototype.readValueFromPointer=Ke,Ze.prototype.deleteObject=function(o){o!==null&&o.delete()},Ze.prototype.fromWireType=function(o){function r(){return this.wa?Dt(this.fa.qa,{ha:this.Sa,ga:u,ma:this,ka:o}):Dt(this.fa.qa,{ha:this,ga:o})}var u=this.Pa(o);if(!u)return this.Ga(o),null;var l=Or(this.fa,u);if(l!==void 0)return l.ea.count.value===0?(l.ea.ga=u,l.ea.ka=o,l.clone()):(l=l.clone(),this.Ga(o),l);if(l=this.fa.Oa(u),l=li[l],!l)return r.call(this);l=this.va?l.Ja:l.pointerType;var g=di(u,this.fa,l.fa);return g===null?r.call(this):this.wa?Dt(l.fa.qa,{ha:l,ga:g,ma:this,ka:o}):Dt(l.fa.qa,{ha:l,ga:g})},s.getInheritedInstanceCount=function(){return Object.keys(Tt).length},s.getLiveInheritedInstances=function(){var o=[],r;for(r in Tt)Tt.hasOwnProperty(r)&&o.push(Tt[r]);return o},s.flushPendingDeletes=mn,s.setDelayFunction=function(o){vt=o,Et.length&&vt&&vt(mn)},pi=s.UnboundTypeError=hn("UnboundTypeError"),s.count_emval_handles=function(){for(var o=0,r=5;r<je.length;++r)je[r]!==void 0&&++o;return o},s.get_first_emval=function(){for(var o=5;o<je.length;++o)if(je[o]!==void 0)return je[o];return null};var Pr={r:function(o){var r=ge[o];delete ge[o];var u=r.elements,l=u.length,g=u.map(function(C){return C.Aa}).concat(u.map(function(C){return C.Ea})),A=r.sa,k=r.la;ze([o],g,function(C){return u.forEach(function(L,j){var W=C[j],z=L.ya,le=L.za,pe=C[j+l],fe=L.Da,Se=L.Fa;L.read=Ce=>W.fromWireType(z(le,Ce)),L.write=(Ce,it)=>{var Ue=[];fe(Se,Ce,pe.toWireType(Ue,it)),We(Ue)}}),[{name:r.name,fromWireType:function(L){for(var j=Array(l),W=0;W<l;++W)j[W]=u[W].read(L);return k(L),j},toWireType:function(L,j){if(l!==j.length)throw new TypeError("Incorrect number of tuple elements for "+r.name+": expected="+l+", actual="+j.length);for(var W=A(),z=0;z<l;++z)u[z].write(W,j[z]);return L!==null&&L.push(k,W),W},argPackAdvance:8,readValueFromPointer:Ke,ja:k}]})},u:function(o){var r=kt[o];delete kt[o];var u=r.sa,l=r.la,g=r.Ha,A=g.map(function(k){return k.Aa}).concat(g.map(function(k){return k.Ea}));ze([o],A,function(k){var C={};return g.forEach(function(L,j){var W=k[j],z=L.ya,le=L.za,pe=k[j+g.length],fe=L.Da,Se=L.Fa;C[L.Na]={read:function(Ce){return W.fromWireType(z(le,Ce))},write:function(Ce,it){var Ue=[];fe(Se,Ce,pe.toWireType(Ue,it)),We(Ue)}}}),[{name:r.name,fromWireType:function(L){var j={},W;for(W in C)j[W]=C[W].read(L);return l(L),j},toWireType:function(L,j){for(var W in C)if(!(W in j))throw new TypeError('Missing field:  "'+W+'"');var z=u();for(W in C)C[W].write(z,j[W]);return L!==null&&L.push(l,z),z},argPackAdvance:8,readValueFromPointer:Ke,ja:l}]})},z:function(){},F:function(o,r,u,l,g){var A=Lt(u);r=Ee(r),He(o,{name:r,fromWireType:function(k){return!!k},toWireType:function(k,C){return C?l:g},argPackAdvance:8,readValueFromPointer:function(k){if(u===1)var C=ie;else if(u===2)C=oe;else if(u===4)C=de;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(C[k>>A])},ja:null})},l:function(o,r,u,l,g,A,k,C,L,j,W,z,le){W=Ee(W),A=be(g,A),C&&(C=be(k,C)),j&&(j=be(L,j)),le=be(z,le);var pe=oi(W);gn(pe,function(){Mt("Cannot construct "+W+" due to unbound types",[l])}),ze([o,r,u],l?[l]:[],function(fe){if(fe=fe[0],l)var Se=fe.fa,Ce=Se.qa;else Ce=Je.prototype;fe=dn(pe,function(){if(Object.getPrototypeOf(this)!==it)throw new ct("Use 'new' to construct "+W);if(Ue.oa===void 0)throw new ct(W+" has no accessible constructor");var wi=Ue.oa[arguments.length];if(wi===void 0)throw new ct("Tried to invoke ctor of "+W+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ue.oa).toString()+") parameters instead!");return wi.apply(this,arguments)});var it=Object.create(Ce,{constructor:{value:fe}});fe.prototype=it;var Ue=new _r(W,fe,it,le,Se,A,C,j);Se=new Ze(W,Ue,!0,!1),Ce=new Ze(W+"*",Ue,!1,!1);var Oi=new Ze(W+" const*",Ue,!1,!0);return li[o]={pointerType:Ce,Ja:Oi},hi(pe,fe),[Se,Ce,Oi]})},i:function(o,r,u,l,g,A){0<r||re(void 0);var k=vn(r,u);g=be(l,g),ze([],[o],function(C){C=C[0];var L="constructor "+C.name;if(C.fa.oa===void 0&&(C.fa.oa=[]),C.fa.oa[r-1]!==void 0)throw new ct("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+C.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return C.fa.oa[r-1]=()=>{Mt("Cannot construct "+C.name+" due to unbound types",k)},ze([],k,function(j){return j.splice(1,0,null),C.fa.oa[r-1]=En(L,j,null,g,A),[]}),[]})},a:function(o,r,u,l,g,A,k,C){var L=vn(u,l);r=Ee(r),A=be(g,A),ze([],[o],function(j){function W(){Mt("Cannot call "+z+" due to unbound types",L)}j=j[0];var z=j.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),C&&j.fa.Ta.push(r);var le=j.fa.qa,pe=le[r];return pe===void 0||pe.ia===void 0&&pe.className!==j.name&&pe.ua===u-2?(W.ua=u-2,W.className=j.name,le[r]=W):(fi(le,r,z),le[r].ia[u-2]=W),ze([],L,function(fe){return fe=En(z,fe,j,A,k),le[r].ia===void 0?(fe.ua=u-2,le[r]=fe):le[r].ia[u-2]=fe,[]}),[]})},I:function(o,r,u){o=Ee(o),ze([],[r],function(l){return l=l[0],s[o]=l.fromWireType(u),[]})},E:function(o,r){r=Ee(r),He(o,{name:r,fromWireType:function(u){var l=On(u);return mi(u),l},toWireType:function(u,l){return Qe(l)},argPackAdvance:8,readValueFromPointer:Ke,ja:null})},h:function(o,r,u,l){function g(){}u=Lt(u),r=Ee(r),g.values={},He(o,{name:r,constructor:g,fromWireType:function(A){return this.constructor.values[A]},toWireType:function(A,k){return k.value},argPackAdvance:8,readValueFromPointer:Ar(r,u,l),ja:null}),gn(r,g)},k:function(o,r,u){var l=Ut(o,"enum");r=Ee(r),o=l.constructor,l=Object.create(l.constructor.prototype,{value:{value:u},constructor:{value:dn(l.name+"_"+r,function(){})}}),o.values[u]=l,o[r]=l},q:function(o,r,u){u=Lt(u),r=Ee(r),He(o,{name:r,fromWireType:function(l){return l},toWireType:function(l,g){return g},argPackAdvance:8,readValueFromPointer:Ir(r,u),ja:null})},f:function(o,r,u,l,g,A){var k=vn(r,u);o=Ee(o),g=be(l,g),gn(o,function(){Mt("Cannot call "+o+" due to unbound types",k)},r-1),ze([],k,function(C){return C=[C[0],null].concat(C.slice(1)),hi(o,En(o,C,null,g,A),r-1),[]})},e:function(o,r,u,l,g){r=Ee(r),g===-1&&(g=4294967295),g=Lt(u);var A=C=>C;if(l===0){var k=32-8*u;A=C=>C<<k>>>k}u=r.includes("unsigned")?function(C,L){return L>>>0}:function(C,L){return L},He(o,{name:r,fromWireType:A,toWireType:u,argPackAdvance:8,readValueFromPointer:Br(r,g,l!==0),ja:null})},b:function(o,r,u){function l(A){A>>=2;var k=ye;return new g(se,k[A+1],k[A])}var g=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][r];u=Ee(u),He(o,{name:u,fromWireType:l,argPackAdvance:8,readValueFromPointer:l},{Qa:!0})},p:function(o,r){r=Ee(r);var u=r==="std::string";He(o,{name:r,fromWireType:function(l){var g=ye[l>>2];if(u)for(var A=l+4,k=0;k<=g;++k){var C=l+4+k;if(k==g||J[C]==0){if(A=A?m(J,A,C-A):"",L===void 0)var L=A;else L+=String.fromCharCode(0),L+=A;A=C+1}}else{for(L=Array(g),k=0;k<g;++k)L[k]=String.fromCharCode(J[l+4+k]);L=L.join("")}return qe(l),L},toWireType:function(l,g){g instanceof ArrayBuffer&&(g=new Uint8Array(g));var A=typeof g=="string";A||g instanceof Uint8Array||g instanceof Uint8ClampedArray||g instanceof Int8Array||ae("Cannot pass non-string to std::string");var k=(u&&A?()=>{for(var j=0,W=0;W<g.length;++W){var z=g.charCodeAt(W);55296<=z&&57343>=z&&(z=65536+((z&1023)<<10)|g.charCodeAt(++W)&1023),127>=z?++j:j=2047>=z?j+2:65535>=z?j+3:j+4}return j}:()=>g.length)(),C=Bn(4+k+1);if(ye[C>>2]=k,u&&A)d(g,C+4,k+1);else if(A)for(A=0;A<k;++A){var L=g.charCodeAt(A);255<L&&(qe(C),ae("String has UTF-16 code units that do not fit in 8 bits")),J[C+4+A]=L}else for(A=0;A<k;++A)J[C+4+A]=g[A];return l!==null&&l.push(qe,C),C},argPackAdvance:8,readValueFromPointer:Ke,ja:function(l){qe(l)}})},m:function(o,r,u){if(u=Ee(u),r===2)var l=B,g=ne,A=N,k=()=>ue,C=1;else r===4&&(l=Y,g=X,A=q,k=()=>ye,C=2);He(o,{name:u,fromWireType:function(L){for(var j=ye[L>>2],W=k(),z,le=L+4,pe=0;pe<=j;++pe){var fe=L+4+pe*r;(pe==j||W[fe>>C]==0)&&(le=l(le,fe-le),z===void 0?z=le:(z+=String.fromCharCode(0),z+=le),le=fe+r)}return qe(L),z},toWireType:function(L,j){typeof j!="string"&&ae("Cannot pass non-string to C++ string type "+u);var W=A(j),z=Bn(4+W+r);return ye[z>>2]=W>>C,g(j,z+4,W+r),L!==null&&L.push(qe,z),z},argPackAdvance:8,readValueFromPointer:Ke,ja:function(L){qe(L)}})},t:function(o,r,u,l,g,A){ge[o]={name:Ee(r),sa:be(u,l),la:be(g,A),elements:[]}},s:function(o,r,u,l,g,A,k,C,L){ge[o].elements.push({Aa:r,ya:be(u,l),za:g,Ea:A,Da:be(k,C),Fa:L})},v:function(o,r,u,l,g,A){kt[o]={name:Ee(r),sa:be(u,l),la:be(g,A),Ha:[]}},j:function(o,r,u,l,g,A,k,C,L,j){kt[o].Ha.push({Na:Ee(r),Aa:u,ya:be(l,g),za:A,Ea:k,Da:be(C,L),Fa:j})},G:function(o,r){r=Ee(r),He(o,{Ra:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(o,r,u,l){o=In[o],r=On(r),u=An(u),o(r,u,null,l)},J:mi,x:function(o){return o===0?Qe(gi()):(o=An(o),Qe(gi()[o]))},c:function(o,r){var u=Cr(o,r),l=u[0];r=l.name+"_$"+u.slice(1).map(function(k){return k.name}).join("_")+"$";var g=_i[r];if(g!==void 0)return g;var A=Array(o-1);return g=Sr((k,C,L,j)=>{for(var W=0,z=0;z<o-1;++z)A[z]=u[z+1].readValueFromPointer(j+W),W+=u[z+1].argPackAdvance;for(k=k[C].apply(k,A),z=0;z<o-1;++z)u[z+1].Ka&&u[z+1].Ka(A[z]);if(!l.Ra)return l.toWireType(L,k)}),_i[r]=g},n:function(o){4<o&&(je[o].Ca+=1)},w:function(o,r,u,l){o=On(o);var g=vi[r];return g||(g=Rr(r),vi[r]=g),g(o,u,l)},K:function(){return Qe([])},D:function(o){return Qe(An(o))},H:function(o,r){return o=Ut(o,"_emval_take_value"),o=o.readValueFromPointer(r),Qe(o)},g:function(){re("")},B:function(o){var r=J.length;if(o>>>=0,2147483648<o)return!1;for(var u=1;4>=u;u*=2){var l=r*(1+.2/u);l=Math.min(l,o+100663296),l=Math.max(o,l),0<l%65536&&(l+=65536-l%65536);e:{try{E.grow(Math.min(2147483648,l)-se.byteLength+65535>>>16),Me();var g=1;break e}catch{}g=void 0}if(g)return!0}return!1},C:function(){return 0},y:function(){},o:function(o,r,u,l){for(var g=0,A=0;A<u;A++){var k=de[r>>2],C=de[r+4>>2];r+=8;for(var L=0;L<C;L++){var j=J[k+L],W=Nr[o];j===0||j===10?((o===1?$:D)(m(W,0)),W.length=0):W.push(j)}g+=C}return de[l>>2]=g,0},A:function(){}};(function(){function o(g){s.asm=g.exports,E=s.asm.L,Me(),V=s.asm._,p.unshift(s.asm.M),x--,s.monitorRunDependencies&&s.monitorRunDependencies(x),x==0&&G&&(g=G,G=null,g())}function r(g){o(g.instance)}function u(g){return Ae().then(function(A){return WebAssembly.instantiate(A,l)}).then(function(A){return A}).then(g,function(A){D("failed to asynchronously prepare wasm: "+A),re(A)})}var l={a:Pr};if(x++,s.monitorRunDependencies&&s.monitorRunDependencies(x),s.instantiateWasm)try{return s.instantiateWasm(l,o)}catch(g){return D("Module.instantiateWasm callback failed with error: "+g),!1}return function(){return Z||typeof WebAssembly.instantiateStreaming!="function"||me()||ce.startsWith("file://")||typeof fetch!="function"?u(r):fetch(ce,{credentials:"same-origin"}).then(function(g){return WebAssembly.instantiateStreaming(g,l).then(r,function(A){return D("wasm streaming compile failed: "+A),D("falling back to ArrayBuffer instantiation"),u(r)})})}().catch(b),{}})(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.M).apply(null,arguments)},s.__Z6ToCmdsRK6SkPath=function(){return(s.__Z6ToCmdsRK6SkPath=s.asm.N).apply(null,arguments)},s.__Z8FromCmdsmi=function(){return(s.__Z8FromCmdsmi=s.asm.O).apply(null,arguments)},s.__Z7NewPathv=function(){return(s.__Z7NewPathv=s.asm.P).apply(null,arguments)},s.__Z8CopyPathRK6SkPath=function(){return(s.__Z8CopyPathRK6SkPath=s.asm.Q).apply(null,arguments)},s.__Z6EqualsRK6SkPathS1_=function(){return(s.__Z6EqualsRK6SkPathS1_=s.asm.R).apply(null,arguments)},s.__Z11ToSVGStringRK6SkPath=function(){return(s.__Z11ToSVGStringRK6SkPath=s.asm.S).apply(null,arguments)},s.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(s.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=s.asm.T).apply(null,arguments)},s.__Z13ApplySimplifyR6SkPath=function(){return(s.__Z13ApplySimplifyR6SkPath=s.asm.U).apply(null,arguments)},s.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(s.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=s.asm.V).apply(null,arguments)},s.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(s.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=s.asm.W).apply(null,arguments)},s.__Z14ResolveBuilderR11SkOpBuilder=function(){return(s.__Z14ResolveBuilderR11SkOpBuilder=s.asm.X).apply(null,arguments)},s.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(s.__Z8ToCanvasRK6SkPathN10emscripten3valE=s.asm.Y).apply(null,arguments)},s.__Z8ToPath2DRK6SkPath=function(){return(s.__Z8ToPath2DRK6SkPath=s.asm.Z).apply(null,arguments)};var qe=s._free=function(){return(qe=s._free=s.asm.$).apply(null,arguments)},Bn=s._malloc=function(){return(Bn=s._malloc=s.asm.aa).apply(null,arguments)},Ti=s.___getTypeName=function(){return(Ti=s.___getTypeName=s.asm.ba).apply(null,arguments)};s.___embind_register_native_and_builtin_types=function(){return(s.___embind_register_native_and_builtin_types=s.asm.ca).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.da).apply(null,arguments)};var Vt;G=function o(){Vt||bn(),Vt||(G=o)};function bn(){function o(){if(!Vt&&(Vt=!0,s.calledRun=!0,!S)){if(_e(p),T(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;){var r=s.postRun.shift();_.unshift(r)}_e(_)}}if(!(0<x)){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)M();_e(c),0<x||(s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),o()},1)):o())}}if(s.run=bn,s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);0<s.preInit.length;)s.preInit.pop()();return bn(),a.ready}})();n.exports=t})(cr);var ls=cr.exports;const fs=Xi(ls),ds="/assets/pathkit-1356ccfa.wasm";let $e=null,tn="",nn="",rn="",on="";async function lr(){await ee.scene.local.deleteItems([on,tn,nn,rn]),tn="",nn="",on="",rn=""}async function fr(){if(!$e)return;const[n,e]=$e;e(),$e=null,lr()}async function dr(){if(!$e)return;const[n,e]=$e,t=n(i=>{i.visible=!1,i.metadata[`${H.EXTENSIONID}/isVisionLine`]=!0,i.points.pop(),i.points.push(i.points[0])});t.points.length>=4&&ee.scene.items.addItems([t]),e(),$e=null,lr()}async function hs(n,e){if(!e.transformer)if($e)if(e.target&&(e.target.id===tn||e.target.id===nn))dr();else if(e.target&&(e.target.id===on||e.target.id===rn))fr();else{const[t]=$e;t(i=>{i.points.push(e.pointerPosition)})}else{const t=sr().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();$e=await ee.interaction.startItemInteraction(t);const i=gt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),a=en().plainText("Finish").position(e.pointerPosition).layer("POPOVER").build(),s=gt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),f=en().plainText("Cancel").position(e.pointerPosition).layer("POPOVER").pointerDirection("UP").build();await ee.scene.local.addItems([a,i,s,f]),tn=a.id,nn=i.id,on=f.id,rn=s.id}}function ps(n,e){if(!$e||e.transformer)return;const[t]=$e;t(i=>{i.points[i.points.length-1]=e.pointerPosition})}function ys(n,e){$e&&(e.key=="Escape"?fr():e.key=="Enter"&&dr())}const Dn={onToolClick:hs,onToolMove:ps,onKeyDown:ys};let Ve=null,bt="",St="",sn="",an="";async function hr(){await ee.scene.local.deleteItems([an,bt,St,sn]),bt="",St="",an="",sn=""}async function pr(){if(!Ve)return;const[n,e]=Ve;e(),Ve=null,hr()}async function yr(){if(!Ve)return;const[n,e]=Ve,t=n(i=>{i.visible=!1,i.metadata[`${H.EXTENSIONID}/isVisionLine`]=!0,i.points.pop()});t.points.length>=2&&ee.scene.items.addItems([t]),e(),Ve=null,hr()}async function ms(n,e){if(!e.transformer)if(Ve)if(e.target&&(e.target.id===bt||e.target.id===St))yr();else if(e.target&&(e.target.id===an||e.target.id===sn))pr();else{const[t]=Ve;t(i=>{i.points.push(e.pointerPosition)}),ee.scene.local.updateItems(i=>i.id==St||i.id==bt,i=>{for(const a of i)a.position=e.pointerPosition})}else{const t=sr().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Ve=await ee.interaction.startItemInteraction(t);const i=gt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),a=en().plainText("Finish").position(e.pointerPosition).layer("POPOVER").build(),s=gt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),f=en().plainText("Cancel").position(e.pointerPosition).layer("POPOVER").build();ee.scene.local.addItems([a,i,s,f]),bt=a.id,St=i.id,an=f.id,sn=s.id}}function gs(n,e){if(!Ve||e.transformer)return;const[t]=Ve;t(i=>{i.points[i.points.length-1]=e.pointerPosition})}function _s(n,e){Ve&&(e.key=="Escape"?pr():e.key=="Enter"&&yr())}const Mn={onToolClick:ms,onToolMove:gs,onKeyDown:_s};class Vi{constructor(){ve(this,"startTime");ve(this,"accumulatedTime");this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Wt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var mr={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,a,s){function f(v,y){if(!a[v]){if(!i[v]){var w=typeof Wt=="function"&&Wt;if(!y&&w)return w(v,!0);if(T)return T(v,!0);throw new Error("Cannot find module '"+v+"'")}y=a[v]={exports:{}},i[v][0].call(y.exports,function(K){var Q=i[v][1][K];return f(Q||K)},y,y.exports,t,i,a,s)}return a[v].exports}for(var T=typeof Wt=="function"&&Wt,b=0;b<s.length;b++)f(s[b]);return f}({1:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){var R=t("crypto");function F(E,S){S=U(E,S);var h;return(h=S.algorithm!=="passthrough"?R.createHash(S.algorithm):new Z).write===void 0&&(h.write=h.update,h.end=h.update),D(S,h).dispatch(E),h.update||h.end(""),h.digest?h.digest(S.encoding==="buffer"?void 0:S.encoding):(E=h.read(),S.encoding!=="buffer"?E.toString(S.encoding):E)}(a=i.exports=F).sha1=function(E){return F(E)},a.keys=function(E){return F(E,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(E){return F(E,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(E){return F(E,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var I=R.getHashes?R.getHashes().slice():["sha1","md5"],P=(I.push("passthrough"),["buffer","hex","binary","base64"]);function U(E,S){var h={};if(h.algorithm=(S=S||{}).algorithm||"sha1",h.encoding=S.encoding||"hex",h.excludeValues=!!S.excludeValues,h.algorithm=h.algorithm.toLowerCase(),h.encoding=h.encoding.toLowerCase(),h.ignoreUnknown=S.ignoreUnknown===!0,h.respectType=S.respectType!==!1,h.respectFunctionNames=S.respectFunctionNames!==!1,h.respectFunctionProperties=S.respectFunctionProperties!==!1,h.unorderedArrays=S.unorderedArrays===!0,h.unorderedSets=S.unorderedSets!==!1,h.unorderedObjects=S.unorderedObjects!==!1,h.replacer=S.replacer||void 0,h.excludeKeys=S.excludeKeys||void 0,E===void 0)throw new Error("Object argument required.");for(var m=0;m<I.length;++m)I[m].toLowerCase()===h.algorithm.toLowerCase()&&(h.algorithm=I[m]);if(I.indexOf(h.algorithm)===-1)throw new Error('Algorithm "'+h.algorithm+'"  not supported. supported values: '+I.join(", "));if(P.indexOf(h.encoding)===-1&&h.algorithm!=="passthrough")throw new Error('Encoding "'+h.encoding+'"  not supported. supported values: '+P.join(", "));return h}function $(E){if(typeof E=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(E))!=null}function D(E,S,h){h=h||[];function m(d){return S.update?S.update(d,"utf8"):S.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=E.replacer?E.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var O,B=Object.prototype.toString.call(d),ne=/\[object (.*)\]/i.exec(B);if(ne=(ne=ne?ne[1]:"unknown:["+B+"]").toLowerCase(),0<=(B=h.indexOf(d)))return this.dispatch("[CIRCULAR:"+B+"]");if(h.push(d),T!==void 0&&T.isBuffer&&T.isBuffer(d))return m("buffer:"),m(d);if(ne==="object"||ne==="function"||ne==="asyncfunction")return B=Object.keys(d),E.unorderedObjects&&(B=B.sort()),E.respectType===!1||$(d)||B.splice(0,0,"prototype","__proto__","constructor"),E.excludeKeys&&(B=B.filter(function(N){return!E.excludeKeys(N)})),m("object:"+B.length+":"),O=this,B.forEach(function(N){O.dispatch(N),m(":"),E.excludeValues||O.dispatch(d[N]),m(",")});if(!this["_"+ne]){if(E.ignoreUnknown)return m("["+ne+"]");throw new Error('Unknown object type "'+ne+'"')}this["_"+ne](d)},_array:function(d,N){N=N!==void 0?N:E.unorderedArrays!==!1;var B=this;if(m("array:"+d.length+":"),!N||d.length<=1)return d.forEach(function(Y){return B.dispatch(Y)});var ne=[],N=d.map(function(Y){var X=new Z,q=h.slice();return D(E,X,q).dispatch(Y),ne=ne.concat(q.slice(h.length)),X.read().toString()});return h=h.concat(ne),N.sort(),this._array(N,!1)},_date:function(d){return m("date:"+d.toJSON())},_symbol:function(d){return m("symbol:"+d.toString())},_error:function(d){return m("error:"+d.toString())},_boolean:function(d){return m("bool:"+d.toString())},_string:function(d){m("string:"+d.length+":"),m(d.toString())},_function:function(d){m("fn:"),$(d)?this.dispatch("[native]"):this.dispatch(d.toString()),E.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),E.respectFunctionProperties&&this._object(d)},_number:function(d){return m("number:"+d.toString())},_xml:function(d){return m("xml:"+d.toString())},_null:function(){return m("Null")},_undefined:function(){return m("Undefined")},_regexp:function(d){return m("regex:"+d.toString())},_uint8array:function(d){return m("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return m("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return m("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return m("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return m("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return m("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return m("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return m("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return m("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return m("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return m("url:"+d.toString())},_map:function(d){return m("map:"),d=Array.from(d),this._array(d,E.unorderedSets!==!1)},_set:function(d){return m("set:"),d=Array.from(d),this._array(d,E.unorderedSets!==!1)},_file:function(d){return m("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(E.ignoreUnknown)return m("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return m("domwindow")},_bigint:function(d){return m("bigint:"+d.toString())},_process:function(){return m("process")},_timer:function(){return m("timer")},_pipe:function(){return m("pipe")},_tcp:function(){return m("tcp")},_udp:function(){return m("udp")},_tty:function(){return m("tty")},_statwatcher:function(){return m("statwatcher")},_securecontext:function(){return m("securecontext")},_connection:function(){return m("connection")},_zlib:function(){return m("zlib")},_context:function(){return m("context")},_nodescript:function(){return m("nodescript")},_httpparser:function(){return m("httpparser")},_dataview:function(){return m("dataview")},_signal:function(){return m("signal")},_fsevent:function(){return m("fsevent")},_tlswrap:function(){return m("tlswrap")}}}function Z(){return{buf:"",write:function(E){this.buf+=E},end:function(E){this.buf+=E},read:function(){return this.buf}}}a.writeToStream=function(E,S,h){return h===void 0&&(h=S,S={}),D(S=U(E,S),h).dispatch(E)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){(function(R){var F=typeof Uint8Array<"u"?Uint8Array:Array,I="+".charCodeAt(0),P="/".charCodeAt(0),U="0".charCodeAt(0),$="a".charCodeAt(0),D="A".charCodeAt(0),Z="-".charCodeAt(0),E="_".charCodeAt(0);function S(h){return h=h.charCodeAt(0),h===I||h===Z?62:h===P||h===E?63:h<U?-1:h<U+10?h-U+26+26:h<D+26?h-D:h<$+26?h-$+26:void 0}R.toByteArray=function(h){var m,d;if(0<h.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var O=h.length,O=h.charAt(O-2)==="="?2:h.charAt(O-1)==="="?1:0,B=new F(3*h.length/4-O),ne=0<O?h.length-4:h.length,N=0;function Y(X){B[N++]=X}for(m=0;m<ne;m+=4,0)Y((16711680&(d=S(h.charAt(m))<<18|S(h.charAt(m+1))<<12|S(h.charAt(m+2))<<6|S(h.charAt(m+3))))>>16),Y((65280&d)>>8),Y(255&d);return O==2?Y(255&(d=S(h.charAt(m))<<2|S(h.charAt(m+1))>>4)):O==1&&(Y((d=S(h.charAt(m))<<10|S(h.charAt(m+1))<<4|S(h.charAt(m+2))>>2)>>8&255),Y(255&d)),B},R.fromByteArray=function(h){var m,d,O,B,ne=h.length%3,N="";function Y(X){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(X)}for(m=0,O=h.length-ne;m<O;m+=3)d=(h[m]<<16)+(h[m+1]<<8)+h[m+2],N+=Y((B=d)>>18&63)+Y(B>>12&63)+Y(B>>6&63)+Y(63&B);switch(ne){case 1:N=(N+=Y((d=h[h.length-1])>>2))+Y(d<<4&63)+"==";break;case 2:N=(N=(N+=Y((d=(h[h.length-2]<<8)+h[h.length-1])>>10))+Y(d>>4&63))+Y(d<<2&63)+"="}return N}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,i,a){(function(s,f,I,b,v,y,w,K,Q){var R=t("base64-js"),F=t("ieee754");function I(c,p,_){if(!(this instanceof I))return new I(c,p,_);var M,x,G,re,me=typeof c;if(p==="base64"&&me=="string")for(c=(re=c).trim?re.trim():re.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(me=="number")M=se(c);else if(me=="string")M=I.byteLength(c,p);else{if(me!="object")throw new Error("First argument needs to be a number, array or string.");M=se(c.length)}if(I._useTypedArrays?x=I._augment(new Uint8Array(M)):((x=this).length=M,x._isBuffer=!0),I._useTypedArrays&&typeof c.byteLength=="number")x._set(c);else if(ie(re=c)||I.isBuffer(re)||re&&typeof re=="object"&&typeof re.length=="number")for(G=0;G<M;G++)I.isBuffer(c)?x[G]=c.readUInt8(G):x[G]=c[G];else if(me=="string")x.write(c,0,p);else if(me=="number"&&!I._useTypedArrays&&!_)for(G=0;G<M;G++)x[G]=0;return x}function P(c,p,_,M){return I._charsWritten=de(function(x){for(var G=[],re=0;re<x.length;re++)G.push(255&x.charCodeAt(re));return G}(p),c,_,M)}function U(c,p,_,M){return I._charsWritten=de(function(x){for(var G,re,me=[],ce=0;ce<x.length;ce++)re=x.charCodeAt(ce),G=re>>8,re=re%256,me.push(re),me.push(G);return me}(p),c,_,M)}function $(c,p,_){var M="";_=Math.min(c.length,_);for(var x=p;x<_;x++)M+=String.fromCharCode(c[x]);return M}function D(c,p,_,G){G||(V(typeof _=="boolean","missing or invalid endian"),V(p!=null,"missing offset"),V(p+1<c.length,"Trying to read beyond buffer length"));var x,G=c.length;if(!(G<=p))return _?(x=c[p],p+1<G&&(x|=c[p+1]<<8)):(x=c[p]<<8,p+1<G&&(x|=c[p+1])),x}function Z(c,p,_,G){G||(V(typeof _=="boolean","missing or invalid endian"),V(p!=null,"missing offset"),V(p+3<c.length,"Trying to read beyond buffer length"));var x,G=c.length;if(!(G<=p))return _?(p+2<G&&(x=c[p+2]<<16),p+1<G&&(x|=c[p+1]<<8),x|=c[p],p+3<G&&(x+=c[p+3]<<24>>>0)):(p+1<G&&(x=c[p+1]<<16),p+2<G&&(x|=c[p+2]<<8),p+3<G&&(x|=c[p+3]),x+=c[p]<<24>>>0),x}function E(c,p,_,M){if(M||(V(typeof _=="boolean","missing or invalid endian"),V(p!=null,"missing offset"),V(p+1<c.length,"Trying to read beyond buffer length")),!(c.length<=p))return M=D(c,p,_,!0),32768&M?-1*(65535-M+1):M}function S(c,p,_,M){if(M||(V(typeof _=="boolean","missing or invalid endian"),V(p!=null,"missing offset"),V(p+3<c.length,"Trying to read beyond buffer length")),!(c.length<=p))return M=Z(c,p,_,!0),2147483648&M?-1*(4294967295-M+1):M}function h(c,p,_,M){return M||(V(typeof _=="boolean","missing or invalid endian"),V(p+3<c.length,"Trying to read beyond buffer length")),F.read(c,p,_,23,4)}function m(c,p,_,M){return M||(V(typeof _=="boolean","missing or invalid endian"),V(p+7<c.length,"Trying to read beyond buffer length")),F.read(c,p,_,52,8)}function d(c,p,_,M,x){if(x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+1<c.length,"trying to write beyond buffer length"),Te(p,65535)),x=c.length,!(x<=_))for(var G=0,re=Math.min(x-_,2);G<re;G++)c[_+G]=(p&255<<8*(M?G:1-G))>>>8*(M?G:1-G)}function O(c,p,_,M,x){if(x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+3<c.length,"trying to write beyond buffer length"),Te(p,4294967295)),x=c.length,!(x<=_))for(var G=0,re=Math.min(x-_,4);G<re;G++)c[_+G]=p>>>8*(M?G:3-G)&255}function B(c,p,_,M,x){x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+1<c.length,"Trying to write beyond buffer length"),De(p,32767,-32768)),c.length<=_||d(c,0<=p?p:65535+p+1,_,M,x)}function ne(c,p,_,M,x){x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+3<c.length,"Trying to write beyond buffer length"),De(p,2147483647,-2147483648)),c.length<=_||O(c,0<=p?p:4294967295+p+1,_,M,x)}function N(c,p,_,M,x){x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+3<c.length,"Trying to write beyond buffer length"),Me(p,34028234663852886e22,-34028234663852886e22)),c.length<=_||F.write(c,p,_,M,23,4)}function Y(c,p,_,M,x){x||(V(p!=null,"missing value"),V(typeof M=="boolean","missing or invalid endian"),V(_!=null,"missing offset"),V(_+7<c.length,"Trying to write beyond buffer length"),Me(p,17976931348623157e292,-17976931348623157e292)),c.length<=_||F.write(c,p,_,M,52,8)}a.Buffer=I,a.SlowBuffer=I,a.INSPECT_MAX_BYTES=50,I.poolSize=8192,I._useTypedArrays=function(){try{var c=new ArrayBuffer(0),p=new Uint8Array(c);return p.foo=function(){return 42},p.foo()===42&&typeof p.subarray=="function"}catch{return!1}}(),I.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},I.isBuffer=function(c){return!(c==null||!c._isBuffer)},I.byteLength=function(c,p){var _;switch(c+="",p||"utf8"){case"hex":_=c.length/2;break;case"utf8":case"utf-8":_=oe(c).length;break;case"ascii":case"binary":case"raw":_=c.length;break;case"base64":_=ue(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":_=2*c.length;break;default:throw new Error("Unknown encoding")}return _},I.concat=function(c,p){if(V(ie(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new I(0);if(c.length===1)return c[0];if(typeof p!="number")for(x=p=0;x<c.length;x++)p+=c[x].length;for(var _=new I(p),M=0,x=0;x<c.length;x++){var G=c[x];G.copy(_,M),M+=G.length}return _},I.prototype.write=function(c,p,_,M){isFinite(p)?isFinite(_)||(M=_,_=void 0):(ce=M,M=p,p=_,_=ce),p=Number(p)||0;var x,G,re,me,ce=this.length-p;switch((!_||ce<(_=Number(_)))&&(_=ce),M=String(M||"utf8").toLowerCase()){case"hex":x=function(xe,Oe,Ae,_e){Ae=Number(Ae)||0;var ge=xe.length-Ae;(!_e||ge<(_e=Number(_e)))&&(_e=ge),V((ge=Oe.length)%2==0,"Invalid hex string"),ge/2<_e&&(_e=ge/2);for(var We=0;We<_e;We++){var Ke=parseInt(Oe.substr(2*We,2),16);V(!isNaN(Ke),"Invalid hex string"),xe[Ae+We]=Ke}return I._charsWritten=2*We,We}(this,c,p,_);break;case"utf8":case"utf-8":G=this,re=p,me=_,x=I._charsWritten=de(oe(c),G,re,me);break;case"ascii":case"binary":x=P(this,c,p,_);break;case"base64":G=this,re=p,me=_,x=I._charsWritten=de(ue(c),G,re,me);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":x=U(this,c,p,_);break;default:throw new Error("Unknown encoding")}return x},I.prototype.toString=function(c,p,_){var M,x,G,re,me=this;if(c=String(c||"utf8").toLowerCase(),p=Number(p)||0,(_=_!==void 0?Number(_):me.length)===p)return"";switch(c){case"hex":M=function(ce,xe,Oe){var Ae=ce.length;(!xe||xe<0)&&(xe=0),(!Oe||Oe<0||Ae<Oe)&&(Oe=Ae);for(var _e="",ge=xe;ge<Oe;ge++)_e+=J(ce[ge]);return _e}(me,p,_);break;case"utf8":case"utf-8":M=function(ce,xe,Oe){var Ae="",_e="";Oe=Math.min(ce.length,Oe);for(var ge=xe;ge<Oe;ge++)ce[ge]<=127?(Ae+=ye(_e)+String.fromCharCode(ce[ge]),_e=""):_e+="%"+ce[ge].toString(16);return Ae+ye(_e)}(me,p,_);break;case"ascii":case"binary":M=$(me,p,_);break;case"base64":x=me,re=_,M=(G=p)===0&&re===x.length?R.fromByteArray(x):R.fromByteArray(x.slice(G,re));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=function(ce,xe,Oe){for(var Ae=ce.slice(xe,Oe),_e="",ge=0;ge<Ae.length;ge+=2)_e+=String.fromCharCode(Ae[ge]+256*Ae[ge+1]);return _e}(me,p,_);break;default:throw new Error("Unknown encoding")}return M},I.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},I.prototype.copy=function(c,p,_,M){if(p=p||0,(M=M||M===0?M:this.length)!==(_=_||0)&&c.length!==0&&this.length!==0){V(_<=M,"sourceEnd < sourceStart"),V(0<=p&&p<c.length,"targetStart out of bounds"),V(0<=_&&_<this.length,"sourceStart out of bounds"),V(0<=M&&M<=this.length,"sourceEnd out of bounds"),M>this.length&&(M=this.length);var x=(M=c.length-p<M-_?c.length-p+_:M)-_;if(x<100||!I._useTypedArrays)for(var G=0;G<x;G++)c[G+p]=this[G+_];else c._set(this.subarray(_,_+x),p)}},I.prototype.slice=function(c,p){var _=this.length;if(c=q(c,_,0),p=q(p,_,_),I._useTypedArrays)return I._augment(this.subarray(c,p));for(var M=p-c,x=new I(M,void 0,!0),G=0;G<M;G++)x[G]=this[G+c];return x},I.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},I.prototype.set=function(c,p){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,p)},I.prototype.readUInt8=function(c,p){if(p||(V(c!=null,"missing offset"),V(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},I.prototype.readUInt16LE=function(c,p){return D(this,c,!0,p)},I.prototype.readUInt16BE=function(c,p){return D(this,c,!1,p)},I.prototype.readUInt32LE=function(c,p){return Z(this,c,!0,p)},I.prototype.readUInt32BE=function(c,p){return Z(this,c,!1,p)},I.prototype.readInt8=function(c,p){if(p||(V(c!=null,"missing offset"),V(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},I.prototype.readInt16LE=function(c,p){return E(this,c,!0,p)},I.prototype.readInt16BE=function(c,p){return E(this,c,!1,p)},I.prototype.readInt32LE=function(c,p){return S(this,c,!0,p)},I.prototype.readInt32BE=function(c,p){return S(this,c,!1,p)},I.prototype.readFloatLE=function(c,p){return h(this,c,!0,p)},I.prototype.readFloatBE=function(c,p){return h(this,c,!1,p)},I.prototype.readDoubleLE=function(c,p){return m(this,c,!0,p)},I.prototype.readDoubleBE=function(c,p){return m(this,c,!1,p)},I.prototype.writeUInt8=function(c,p,_){_||(V(c!=null,"missing value"),V(p!=null,"missing offset"),V(p<this.length,"trying to write beyond buffer length"),Te(c,255)),p>=this.length||(this[p]=c)},I.prototype.writeUInt16LE=function(c,p,_){d(this,c,p,!0,_)},I.prototype.writeUInt16BE=function(c,p,_){d(this,c,p,!1,_)},I.prototype.writeUInt32LE=function(c,p,_){O(this,c,p,!0,_)},I.prototype.writeUInt32BE=function(c,p,_){O(this,c,p,!1,_)},I.prototype.writeInt8=function(c,p,_){_||(V(c!=null,"missing value"),V(p!=null,"missing offset"),V(p<this.length,"Trying to write beyond buffer length"),De(c,127,-128)),p>=this.length||(0<=c?this.writeUInt8(c,p,_):this.writeUInt8(255+c+1,p,_))},I.prototype.writeInt16LE=function(c,p,_){B(this,c,p,!0,_)},I.prototype.writeInt16BE=function(c,p,_){B(this,c,p,!1,_)},I.prototype.writeInt32LE=function(c,p,_){ne(this,c,p,!0,_)},I.prototype.writeInt32BE=function(c,p,_){ne(this,c,p,!1,_)},I.prototype.writeFloatLE=function(c,p,_){N(this,c,p,!0,_)},I.prototype.writeFloatBE=function(c,p,_){N(this,c,p,!1,_)},I.prototype.writeDoubleLE=function(c,p,_){Y(this,c,p,!0,_)},I.prototype.writeDoubleBE=function(c,p,_){Y(this,c,p,!1,_)},I.prototype.fill=function(c,p,_){if(p=p||0,_=_||this.length,V(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),V(p<=_,"end < start"),_!==p&&this.length!==0){V(0<=p&&p<this.length,"start out of bounds"),V(0<=_&&_<=this.length,"end out of bounds");for(var M=p;M<_;M++)this[M]=c}},I.prototype.inspect=function(){for(var c=[],p=this.length,_=0;_<p;_++)if(c[_]=J(this[_]),_===a.INSPECT_MAX_BYTES){c[_+1]="...";break}return"<Buffer "+c.join(" ")+">"},I.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(I._useTypedArrays)return new I(this).buffer;for(var c=new Uint8Array(this.length),p=0,_=c.length;p<_;p+=1)c[p]=this[p];return c.buffer};var X=I.prototype;function q(c,p,_){return typeof c!="number"?_:p<=(c=~~c)?p:0<=c||0<=(c+=p)?c:0}function se(c){return(c=~~Math.ceil(+c))<0?0:c}function ie(c){return(Array.isArray||function(p){return Object.prototype.toString.call(p)==="[object Array]"})(c)}function J(c){return c<16?"0"+c.toString(16):c.toString(16)}function oe(c){for(var p=[],_=0;_<c.length;_++){var M=c.charCodeAt(_);if(M<=127)p.push(c.charCodeAt(_));else for(var x=_,G=(55296<=M&&M<=57343&&_++,encodeURIComponent(c.slice(x,_+1)).substr(1).split("%")),re=0;re<G.length;re++)p.push(parseInt(G[re],16))}return p}function ue(c){return R.toByteArray(c)}function de(c,p,_,M){for(var x=0;x<M&&!(x+_>=p.length||x>=c.length);x++)p[x+_]=c[x];return x}function ye(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function Te(c,p){V(typeof c=="number","cannot write a non-number as a number"),V(0<=c,"specified a negative value for writing an unsigned value"),V(c<=p,"value is larger than maximum value for type"),V(Math.floor(c)===c,"value has a fractional component")}function De(c,p,_){V(typeof c=="number","cannot write a non-number as a number"),V(c<=p,"value larger than maximum allowed value"),V(_<=c,"value smaller than minimum allowed value"),V(Math.floor(c)===c,"value has a fractional component")}function Me(c,p,_){V(typeof c=="number","cannot write a non-number as a number"),V(c<=p,"value larger than maximum allowed value"),V(_<=c,"value smaller than minimum allowed value")}function V(c,p){if(!c)throw new Error(p||"Failed assertion")}I._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=X.get,c.set=X.set,c.write=X.write,c.toString=X.toString,c.toLocaleString=X.toString,c.toJSON=X.toJSON,c.copy=X.copy,c.slice=X.slice,c.readUInt8=X.readUInt8,c.readUInt16LE=X.readUInt16LE,c.readUInt16BE=X.readUInt16BE,c.readUInt32LE=X.readUInt32LE,c.readUInt32BE=X.readUInt32BE,c.readInt8=X.readInt8,c.readInt16LE=X.readInt16LE,c.readInt16BE=X.readInt16BE,c.readInt32LE=X.readInt32LE,c.readInt32BE=X.readInt32BE,c.readFloatLE=X.readFloatLE,c.readFloatBE=X.readFloatBE,c.readDoubleLE=X.readDoubleLE,c.readDoubleBE=X.readDoubleBE,c.writeUInt8=X.writeUInt8,c.writeUInt16LE=X.writeUInt16LE,c.writeUInt16BE=X.writeUInt16BE,c.writeUInt32LE=X.writeUInt32LE,c.writeUInt32BE=X.writeUInt32BE,c.writeInt8=X.writeInt8,c.writeInt16LE=X.writeInt16LE,c.writeInt16BE=X.writeInt16BE,c.writeInt32LE=X.writeInt32LE,c.writeInt32BE=X.writeInt32BE,c.writeFloatLE=X.writeFloatLE,c.writeFloatBE=X.writeFloatBE,c.writeDoubleLE=X.writeDoubleLE,c.writeDoubleBE=X.writeDoubleBE,c.fill=X.fill,c.inspect=X.inspect,c.toArrayBuffer=X.toArrayBuffer,c}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,i,a){(function(s,f,R,b,v,y,w,K,Q){var R=t("buffer").Buffer,F=4,I=new R(F);I.fill(0),i.exports={hash:function(P,U,$,D){for(var Z=U(function(d,O){d.length%F!=0&&(B=d.length+(F-d.length%F),d=R.concat([d,I],B));for(var B,ne=[],N=O?d.readInt32BE:d.readInt32LE,Y=0;Y<d.length;Y+=F)ne.push(N.call(d,Y));return ne}(P=R.isBuffer(P)?P:new R(P),D),8*P.length),U=D,E=new R($),S=U?E.writeInt32BE:E.writeInt32LE,h=0;h<Z.length;h++)S.call(E,Z[h],4*h,!0);return E}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,i,a){(function(s,f,R,b,v,y,w,K,Q){var R=t("buffer").Buffer,F=t("./sha"),I=t("./sha256"),P=t("./rng"),U={sha1:F,sha256:I,md5:t("./md5")},$=64,D=new R($);function Z(d,O){var B=U[d=d||"sha1"],ne=[];return B||E("algorithm:",d,"is not yet supported"),{update:function(N){return R.isBuffer(N)||(N=new R(N)),ne.push(N),N.length,this},digest:function(N){var Y=R.concat(ne),Y=O?function(X,q,se){R.isBuffer(q)||(q=new R(q)),R.isBuffer(se)||(se=new R(se)),q.length>$?q=X(q):q.length<$&&(q=R.concat([q,D],$));for(var ie=new R($),J=new R($),oe=0;oe<$;oe++)ie[oe]=54^q[oe],J[oe]=92^q[oe];return se=X(R.concat([ie,se])),X(R.concat([J,se]))}(B,O,Y):B(Y);return ne=null,N?Y.toString(N):Y}}}function E(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}D.fill(0),a.createHash=function(d){return Z(d)},a.createHmac=Z,a.randomBytes=function(d,O){if(!O||!O.call)return new R(P(d));try{O.call(this,void 0,new R(P(d)))}catch(B){O(B)}};var S,h=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],m=function(d){a[d]=function(){E("sorry,",d,"is not implemented yet")}};for(S in h)m(h[S])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){var R=t("./helpers");function F(E,S){E[S>>5]|=128<<S%32,E[14+(S+64>>>9<<4)]=S;for(var h=1732584193,m=-271733879,d=-1732584194,O=271733878,B=0;B<E.length;B+=16){var ne=h,N=m,Y=d,X=O,h=P(h,m,d,O,E[B+0],7,-680876936),O=P(O,h,m,d,E[B+1],12,-389564586),d=P(d,O,h,m,E[B+2],17,606105819),m=P(m,d,O,h,E[B+3],22,-1044525330);h=P(h,m,d,O,E[B+4],7,-176418897),O=P(O,h,m,d,E[B+5],12,1200080426),d=P(d,O,h,m,E[B+6],17,-1473231341),m=P(m,d,O,h,E[B+7],22,-45705983),h=P(h,m,d,O,E[B+8],7,1770035416),O=P(O,h,m,d,E[B+9],12,-1958414417),d=P(d,O,h,m,E[B+10],17,-42063),m=P(m,d,O,h,E[B+11],22,-1990404162),h=P(h,m,d,O,E[B+12],7,1804603682),O=P(O,h,m,d,E[B+13],12,-40341101),d=P(d,O,h,m,E[B+14],17,-1502002290),h=U(h,m=P(m,d,O,h,E[B+15],22,1236535329),d,O,E[B+1],5,-165796510),O=U(O,h,m,d,E[B+6],9,-1069501632),d=U(d,O,h,m,E[B+11],14,643717713),m=U(m,d,O,h,E[B+0],20,-373897302),h=U(h,m,d,O,E[B+5],5,-701558691),O=U(O,h,m,d,E[B+10],9,38016083),d=U(d,O,h,m,E[B+15],14,-660478335),m=U(m,d,O,h,E[B+4],20,-405537848),h=U(h,m,d,O,E[B+9],5,568446438),O=U(O,h,m,d,E[B+14],9,-1019803690),d=U(d,O,h,m,E[B+3],14,-187363961),m=U(m,d,O,h,E[B+8],20,1163531501),h=U(h,m,d,O,E[B+13],5,-1444681467),O=U(O,h,m,d,E[B+2],9,-51403784),d=U(d,O,h,m,E[B+7],14,1735328473),h=$(h,m=U(m,d,O,h,E[B+12],20,-1926607734),d,O,E[B+5],4,-378558),O=$(O,h,m,d,E[B+8],11,-2022574463),d=$(d,O,h,m,E[B+11],16,1839030562),m=$(m,d,O,h,E[B+14],23,-35309556),h=$(h,m,d,O,E[B+1],4,-1530992060),O=$(O,h,m,d,E[B+4],11,1272893353),d=$(d,O,h,m,E[B+7],16,-155497632),m=$(m,d,O,h,E[B+10],23,-1094730640),h=$(h,m,d,O,E[B+13],4,681279174),O=$(O,h,m,d,E[B+0],11,-358537222),d=$(d,O,h,m,E[B+3],16,-722521979),m=$(m,d,O,h,E[B+6],23,76029189),h=$(h,m,d,O,E[B+9],4,-640364487),O=$(O,h,m,d,E[B+12],11,-421815835),d=$(d,O,h,m,E[B+15],16,530742520),h=D(h,m=$(m,d,O,h,E[B+2],23,-995338651),d,O,E[B+0],6,-198630844),O=D(O,h,m,d,E[B+7],10,1126891415),d=D(d,O,h,m,E[B+14],15,-1416354905),m=D(m,d,O,h,E[B+5],21,-57434055),h=D(h,m,d,O,E[B+12],6,1700485571),O=D(O,h,m,d,E[B+3],10,-1894986606),d=D(d,O,h,m,E[B+10],15,-1051523),m=D(m,d,O,h,E[B+1],21,-2054922799),h=D(h,m,d,O,E[B+8],6,1873313359),O=D(O,h,m,d,E[B+15],10,-30611744),d=D(d,O,h,m,E[B+6],15,-1560198380),m=D(m,d,O,h,E[B+13],21,1309151649),h=D(h,m,d,O,E[B+4],6,-145523070),O=D(O,h,m,d,E[B+11],10,-1120210379),d=D(d,O,h,m,E[B+2],15,718787259),m=D(m,d,O,h,E[B+9],21,-343485551),h=Z(h,ne),m=Z(m,N),d=Z(d,Y),O=Z(O,X)}return Array(h,m,d,O)}function I(E,S,h,m,d,O){return Z((S=Z(Z(S,E),Z(m,O)))<<d|S>>>32-d,h)}function P(E,S,h,m,d,O,B){return I(S&h|~S&m,E,S,d,O,B)}function U(E,S,h,m,d,O,B){return I(S&m|h&~m,E,S,d,O,B)}function $(E,S,h,m,d,O,B){return I(S^h^m,E,S,d,O,B)}function D(E,S,h,m,d,O,B){return I(h^(S|~m),E,S,d,O,B)}function Z(E,S){var h=(65535&E)+(65535&S);return(E>>16)+(S>>16)+(h>>16)<<16|65535&h}i.exports=function(E){return R.hash(E,F,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){i.exports=function(R){for(var F,I=new Array(R),P=0;P<R;P++)!(3&P)&&(F=4294967296*Math.random()),I[P]=F>>>((3&P)<<3)&255;return I}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){var R=t("./helpers");function F(U,$){U[$>>5]|=128<<24-$%32,U[15+($+64>>9<<4)]=$;for(var D,Z,E,S=Array(80),h=1732584193,m=-271733879,d=-1732584194,O=271733878,B=-1009589776,ne=0;ne<U.length;ne+=16){for(var N=h,Y=m,X=d,q=O,se=B,ie=0;ie<80;ie++){S[ie]=ie<16?U[ne+ie]:P(S[ie-3]^S[ie-8]^S[ie-14]^S[ie-16],1);var J=I(I(P(h,5),(J=m,Z=d,E=O,(D=ie)<20?J&Z|~J&E:!(D<40)&&D<60?J&Z|J&E|Z&E:J^Z^E)),I(I(B,S[ie]),(D=ie)<20?1518500249:D<40?1859775393:D<60?-1894007588:-899497514)),B=O,O=d,d=P(m,30),m=h,h=J}h=I(h,N),m=I(m,Y),d=I(d,X),O=I(O,q),B=I(B,se)}return Array(h,m,d,O,B)}function I(U,$){var D=(65535&U)+(65535&$);return(U>>16)+($>>16)+(D>>16)<<16|65535&D}function P(U,$){return U<<$|U>>>32-$}i.exports=function(U){return R.hash(U,F,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){function R($,D){var Z=(65535&$)+(65535&D);return($>>16)+(D>>16)+(Z>>16)<<16|65535&Z}function F($,D){var Z,E=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),S=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),h=new Array(64);$[D>>5]|=128<<24-D%32,$[15+(D+64>>9<<4)]=D;for(var m,d,O=0;O<$.length;O+=16){for(var B=S[0],ne=S[1],N=S[2],Y=S[3],X=S[4],q=S[5],se=S[6],ie=S[7],J=0;J<64;J++)h[J]=J<16?$[J+O]:R(R(R((d=h[J-2],P(d,17)^P(d,19)^U(d,10)),h[J-7]),(d=h[J-15],P(d,7)^P(d,18)^U(d,3))),h[J-16]),Z=R(R(R(R(ie,P(d=X,6)^P(d,11)^P(d,25)),X&q^~X&se),E[J]),h[J]),m=R(P(m=B,2)^P(m,13)^P(m,22),B&ne^B&N^ne&N),ie=se,se=q,q=X,X=R(Y,Z),Y=N,N=ne,ne=B,B=R(Z,m);S[0]=R(B,S[0]),S[1]=R(ne,S[1]),S[2]=R(N,S[2]),S[3]=R(Y,S[3]),S[4]=R(X,S[4]),S[5]=R(q,S[5]),S[6]=R(se,S[6]),S[7]=R(ie,S[7])}return S}var I=t("./helpers"),P=function($,D){return $>>>D|$<<32-D},U=function($,D){return $>>>D};i.exports=function($){return I.hash($,F,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){a.read=function(R,F,I,P,O){var $,D,Z=8*O-P-1,E=(1<<Z)-1,S=E>>1,h=-7,m=I?O-1:0,d=I?-1:1,O=R[F+m];for(m+=d,$=O&(1<<-h)-1,O>>=-h,h+=Z;0<h;$=256*$+R[F+m],m+=d,h-=8);for(D=$&(1<<-h)-1,$>>=-h,h+=P;0<h;D=256*D+R[F+m],m+=d,h-=8);if($===0)$=1-S;else{if($===E)return D?NaN:1/0*(O?-1:1);D+=Math.pow(2,P),$-=S}return(O?-1:1)*D*Math.pow(2,$-P)},a.write=function(R,F,I,P,U,B){var D,Z,E=8*B-U-1,S=(1<<E)-1,h=S>>1,m=U===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=P?0:B-1,O=P?1:-1,B=F<0||F===0&&1/F<0?1:0;for(F=Math.abs(F),isNaN(F)||F===1/0?(Z=isNaN(F)?1:0,D=S):(D=Math.floor(Math.log(F)/Math.LN2),F*(P=Math.pow(2,-D))<1&&(D--,P*=2),2<=(F+=1<=D+h?m/P:m*Math.pow(2,1-h))*P&&(D++,P/=2),S<=D+h?(Z=0,D=S):1<=D+h?(Z=(F*P-1)*Math.pow(2,U),D+=h):(Z=F*Math.pow(2,h-1)*Math.pow(2,U),D=0));8<=U;R[I+d]=255&Z,d+=O,Z/=256,U-=8);for(D=D<<U|Z,E+=U;0<E;R[I+d]=255&D,d+=O,D/=256,E-=8);R[I+d-O]|=128*B}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,i,a){(function(s,f,T,b,v,y,w,K,Q){var R,F,I;function P(){}(s=i.exports={}).nextTick=(F=typeof window<"u"&&window.setImmediate,I=typeof window<"u"&&window.postMessage&&window.addEventListener,F?function(U){return window.setImmediate(U)}:I?(R=[],window.addEventListener("message",function(U){var $=U.source;$!==window&&$!==null||U.data!=="process-tick"||(U.stopPropagation(),0<R.length&&R.shift()())},!0),function(U){R.push(U),window.postMessage("process-tick","*")}):function(U){setTimeout(U,0)}),s.title="browser",s.browser=!0,s.env={},s.argv=[],s.on=P,s.addListener=P,s.once=P,s.off=P,s.removeListener=P,s.removeAllListeners=P,s.emit=P,s.binding=function(U){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(U){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(mr);var vs=mr.exports;const Ht=Xi(vs);class Es{constructor(e){ve(this,"cache");ve(this,"useHash");this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Ht(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Ht(e):String(e)]}getValue(e){return this.cache[this.useHash?Ht(e):String(e)]}isCached(e){return(this.useHash?Ht(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,i])=>e(t,i)),this.cache={}}}function Xt(n,e){return(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)}function ji(n,e){return n.x==e.x&&n.y==e.y}function Yt(n,e,t){return t===void 0&&(t=.01),Math.abs(n-e)<=t}function Un(n,e){return(n%e+e)%e}async function Ts(){await ee.contextMenu.create({id:`${H.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${H.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(n){await ee.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${H.EXTENSIONID}/hasVision`]&&t.layer=="CHARACTER"?delete t.metadata[`${H.EXTENSIONID}/hasVision`]:t.layer=="CHARACTER"&&(t.metadata[`${H.EXTENSIONID}/hasVision`]=!0,t.metadata[`${H.EXTENSIONID}/visionRange`]||(t.metadata[`${H.EXTENSIONID}/visionRange`]=H.VISIONDEFAULT))})}}),await ee.contextMenu.create({id:`${H.EXTENSIONID}/set-background-image`,icons:[{icon:"/set-background.svg",label:"Set as background image",filter:{every:[{key:"layer",value:"MAP"},{key:["metadata",`${H.EXTENSIONID}/isBackgroundImage`],value:!0,operator:"!="}]}}],async onClick(n){if(n.items.length!=1)return;const e=n.items[0];await ee.scene.items.updateItems(t=>t.layer=="MAP",t=>{for(const i of t)e.id!=i.id&&i.metadata[`${H.EXTENSIONID}/isBackgroundImage`]?delete i.metadata[`${H.EXTENSIONID}/isBackgroundImage`]:e.id==i.id&&(i.metadata[`${H.EXTENSIONID}/isBackgroundImage`]=!0)})}}),await ee.contextMenu.create({id:`${H.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{every:[{key:["metadata",`${H.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${H.EXTENSIONID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{every:[{key:["metadata",`${H.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(n){await ee.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${H.EXTENSIONID}/isVisionLine`]&&t.metadata[`${H.EXTENSIONID}/disabled`]?delete t.metadata[`${H.EXTENSIONID}/disabled`]:t.metadata[`${H.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${H.EXTENSIONID}/disabled`]=!0)})}}),await ee.contextMenu.create({id:`${H.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{every:[{key:["metadata",`${H.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${H.EXTENSIONID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{every:[{key:["metadata",`${H.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${H.EXTENSIONID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{every:[{key:["metadata",`${H.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(n){await ee.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${H.EXTENSIONID}/isVisionLine`]&&t.metadata[`${H.EXTENSIONID}/oneSided`]=="right"?delete t.metadata[`${H.EXTENSIONID}/oneSided`]:t.metadata[`${H.EXTENSIONID}/isVisionLine`]&&t.metadata[`${H.EXTENSIONID}/oneSided`]=="left"?t.metadata[`${H.EXTENSIONID}/oneSided`]="right":t.metadata[`${H.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${H.EXTENSIONID}/oneSided`]="left")})}})}async function Os(){await ee.tool.create({id:`${H.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await ee.tool.activateTool(`${H.EXTENSIONID}/vision-tool`)}})}async function ws(){await ee.tool.createMode({id:`${H.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${H.EXTENSIONID}/vision-tool`]}}],onToolClick:Dn.onToolClick,onToolMove:Dn.onToolMove,onKeyDown:Dn.onKeyDown}),await ee.tool.createMode({id:`${H.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${H.EXTENSIONID}/vision-tool`]}}],onToolClick:Mn.onToolClick,onToolMove:Mn.onToolMove,onKeyDown:Mn.onKeyDown})}function As(n){for(const[e,t]of Object.entries(n)){const i=document.getElementById(e);i&&(i.innerText=t)}}var Ge,ot=!1;const pt=new Es(!1);async function Is(n){if(ot=!0,Ge||(Ge=await fs({locateFile:()=>ds})),!await ee.scene.isReady()){pt.invalidate((N,Y)=>Y.shadowPath.delete()),ot=!1;return}const e=await ee.scene.local.getItems(),{awaitTimer:t,computeTimer:i,metadata:a,size:s,offset:f,scale:T,visionShapes:b,tokensWithVision:v,invalidateCache:y}=n.detail,[w,K]=s;let Q=0,R=0;if(y&&pt.invalidate((N,Y)=>Y.shadowPath.delete()),i.resume(),!(a[`${H.EXTENSIONID}/visionEnabled`]===!0)||v.length==0){await ee.scene.local.deleteItems(e.filter(Yn).map(N=>N.id)),ot=!1;return}const I=[];for(const N of b)for(let Y=0;Y<N.points.length-1;Y++)I.push({startPosition:{x:N.points[Y].x*N.scale.x+N.position.x,y:N.points[Y].y*N.scale.y+N.position.y},endPosition:{x:N.points[Y+1].x*N.scale.x+N.position.x,y:N.points[Y+1].y*N.scale.y+N.position.y},originalShape:N,oneSided:N.metadata[`${H.EXTENSIONID}/oneSided`]});const P=[],U=[];for(const N of v){if(!(te.userId===N.createdUserId)&&te.role!=="GM")continue;const X=pt.getValue(N.id);if(P.push([]),!(X!==void 0&&ji(X.player.position,N.position)))for(const q of I){const se=(N.position.x-q.startPosition.x)*(q.endPosition.y-q.startPosition.y)-(N.position.y-q.startPosition.y)*(q.endPosition.x-q.startPosition.x);if(q.oneSided!==void 0&&(q.oneSided=="right"&&se>0||q.oneSided=="left"&&se<0))continue;const ie={x:q.startPosition.x-N.position.x,y:q.startPosition.y-N.position.y},J={x:q.endPosition.x-N.position.x,y:q.endPosition.y-N.position.y};var $={x:0,y:0},D={x:0,y:0},Z=0,E=0,S=0,h=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ie.x<0?Z=f[0]*T[0]:Z=(w+f[0])*T[0],ie.y<0?E=f[1]*T[1]:E=(K+f[1])*T[1],J.x<0?S=f[0]*T[0]:S=(w+f[0])*T[0],J.y<0?h=f[1]*T[1]:h=(K+f[1])*T[1];const oe=[],ue=[];if(ie.x!=0){const c=ie.y/ie.x,p=q.startPosition.y-c*q.startPosition.x;oe.push({x:Z,y:c*Z+p})}if(ie.y!=0){const c=ie.x/ie.y,p=c*q.startPosition.y-q.startPosition.x;oe.push({x:c*E-p,y:E})}if(J.x!=0){const c=J.y/J.x,p=q.endPosition.y-c*q.endPosition.x;ue.push({x:S,y:c*S+p})}if(J.y!=0){const c=J.x/J.y,p=c*q.endPosition.y-q.endPosition.x;ue.push({x:c*h-p,y:h})}oe.length==1||Xt(oe[0],q.startPosition)<Xt(oe[1],q.startPosition)?$=oe[0]:$=oe[1],ue.length==1||Xt(ue[0],q.endPosition)<Xt(ue[1],q.endPosition)?D=ue[0]:D=ue[1];const de=[{x:q.startPosition.x,y:q.startPosition.y},$,D,{x:q.endPosition.x,y:q.endPosition.y}],ye=[{x:(w+f[0])*T[0],y:f[1]*T[1]},{x:(w+f[0])*T[0],y:(K+f[1])*T[1]},{x:f[0]*T[0],y:(K+f[1])*T[1]},{x:f[0]*T[0],y:f[1]*T[1]}],Te=[0,0];let De=0;for(const c of[$,D])Yt(c.y,f[1]*T[1])?Te[De]=0:Yt(c.y,(K+f[1])*T[1])?Te[De]=2:Yt(c.x,f[0]*T[0])?Te[De]=3:Yt(c.x,(w+f[0])*T[0])&&(Te[De]=1),De++;let Me=Math.sign(se);Me=Me==0?1:-Me;const V=Me==1?Te[1]:Un(Te[1]-1,4);for(let c=Te[0]+(Me==1?0:-1);Un(c,4)!=V;c+=Me)de.splice(de.length-2,0,ye[Un(c,4)]);P[P.length-1].push({pointset:de,fromShape:q.originalShape})}}if(P.length==0){ot=!1;return}const m={};for(let N=0;N<P.length;N++){const Y=v[N];let X=pt.getValue(Y.id);if(X!==void 0&&ji(X.player.position,Y.position)){m[N]=X.shadowPath.copy(),Q++;continue}R++;const q=P[N],se=new Ge.SkOpBuilder,ie=Ge.NewPath().rect(f[0],f[1],s[0],s[1]);se.add(ie,Ge.PathOp.UNION),ie.delete();for(const oe of q){const ue=oe.fromShape,de=Ge.NewPath();de.moveTo(oe.pointset[0].x,oe.pointset[0].y);for(let ye=1;ye<oe.pointset.length;ye++)de.lineTo(oe.pointset[ye].x,oe.pointset[ye].y);if(ue.style.closed!=!1){const ye=Ge.NewPath();ye.moveTo(ue.points[0].x*ue.scale.x+ue.position.x,ue.points[0].y*ue.scale.y+ue.position.y);for(let Te=1;Te<ue.points.length-1;Te++)ye.lineTo(ue.points[Te].x*ue.scale.x+ue.position.x,ue.points[Te].y*ue.scale.y+ue.position.y);de.op(ye,Ge.PathOp.DIFFERENCE),ye.delete()}se.add(de,Ge.PathOp.DIFFERENCE),de.delete()}const J=se.resolve();if(!J){console.error("Couldn't compute fog");return}if(se.delete(),J!==void 0){J.simplify(),m[N]=J;let oe=pt.getValue(Y.id);oe!==void 0&&oe.shadowPath.delete(),pt.cacheValue(Y.id,{shadowPath:J.copy(),player:Y})}}for(let N=0;N<v.length;N++){const Y=v[N],X=Y.metadata[`${H.EXTENSIONID}/visionRange`],q=te.userId===v[N].createdUserId;if(X){if(!q&&te.role!=="GM")continue;const se=te.gridDpi*(X/te.gridScale+.5),ie=Ge.NewPath().ellipse(Y.position.x,Y.position.y,se,se,0,0,2*Math.PI);m[N].op(ie,Ge.PathOp.INTERSECT),ie.delete();const J=te.players.find(oe=>oe.id===Y.createdUserId);if(J&&te.role==="GM"){const oe=gt().strokeColor(J.color).fillOpacity(0).position({x:Y.position.x,y:Y.position.y}).width(se*2).height(se*2).shapeType("CIRCLE").metadata({[`${H.EXTENSIONID}/isIndicatorRing`]:!0}).build();U.push(oe)}}}const d=[];for(const N of Object.values(m))d.push({cmds:N.toCmds(),visible:!1,zIndex:3}),N.delete();i.pause(),t.resume();const O=[ee.scene.local.deleteItems(e.filter(os).map(N=>N.id)),ee.scene.local.addItems(d.map(N=>{const Y=ns().commands(N.cmds).locked(!0).visible(N.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${H.EXTENSIONID}/isVisionFog`]:!0}).build();return Y.zIndex=N.zIndex,Y})),ee.scene.local.deleteItems(e.filter(Yn).map(N=>N.id))];U.length>0&&O.push(ee.scene.local.addItems(U)),te.fog.filled||O.push(ee.scene.fog.setFilled(!0)),await Promise.all(O);const[B,ne]=[t.stop(),i.stop()];As({compute_time:`${ne} ms`,communication_time:`${B} ms`,cache_hits:Q,cache_misses:R}),ot=!1}document.addEventListener("updateVision",Is);let $n,Fi,Ot=[],Gi,Vn;async function wt(){var R;if(ot||!await ee.scene.isReady())return;const[n,e]=[new Vi,new Vi];n.start(),n.pause(),e.start();const t=te.role=="GM"?te.items.filter(ar):te.items.filter(as),i=te.items.filter(ss),a=(R=te.items.filter(ur))==null?void 0:R[0],s=te.metadata[`${H.EXTENSIONID}/visionEnabled`]===!0;if(a===void 0)return;const f=[a.width*a.scale.x,a.height*a.scale.y],T=[a.scale.x,a.scale.y],b=[a.position.x,a.position.y];document.getElementById("map_size").innerText=`Boundary Size: ${Math.round(f[0])}x${Math.round(f[1])} px`;const v=JSON.stringify(i),y=JSON.stringify(t),w=JSON.stringify(a);if(w==Vn&&s==Gi&&$n==v&&Fi==y&&f[0]==Ot[0]&&f[1]==Ot[1])return;let K=!1;(w!=Vn||$n!=v||f[0]!=Ot[0]||f[1]!=Ot[1])&&(K=!0),Vn=w,Fi=y,$n=v,Ot=f,Gi=s,e.pause();const Q=new CustomEvent("updateVision",{detail:{awaitTimer:n,computeTimer:e,allItems:te.items,metadata:te.metadata,size:f,offset:b,scale:T,tokensWithVision:t,visionShapes:i,invalidateCache:K}});ot||document.dispatchEvent(Q)}const ri=document.getElementById("app");ri.innerHTML=`
  <div>
    <div>
      <div class="title">Smoke! x Dynamic Fog&nbsp;&nbsp;</div>
      <input type="checkbox" id="vision_checkbox" class="large">
    </div>
    <hr>
    <div style="text-align: center;">
      <p><span id="map_size"></span></p>
      <hr>
      <div class="visionTitle">Vision Radius</div>
      <p id="no_tokens_message">Enable vision on your character tokens.</p>
      <div id="token_list_div" style="display: block;">
        <table style="margin: auto; padding: 0;"><tbody id="token_list">
        </tbody></table>
      </div>
      </div>
    <div id="debug_div" style="display: none;">
      <br><hr><br>
      <h2>Debug</h2>
      <h3>Performance Info</h3>
      <ul>
        <li><p>Compute time: <span id=compute_time>N/A</span></p></li>
        <li><p>Communication time: <span id=communication_time>N/A</span></p></li>
        <li><p>Cache hits/misses: <span id=cache_hits>?</span>/<span id=cache_misses>?</span></p></li>
      </ul>
    </div>
  </div>
`;ri.style.textAlign="left";ri.parentElement.style.placeItems="start";const gr=document.getElementById("vision_checkbox"),Bs=document.getElementById("token_list"),Wi=document.getElementById("no_tokens_message");async function bs(){gr.addEventListener("click",async n=>{if(!te.ready||!n.target){n.preventDefault();return}const e=n.target;await ee.scene.setMetadata({[`${H.EXTENSIONID}/visionEnabled`]:e.checked})},!1)}function Zt(n){const e=n.filter(ar);te.metadata&&(gr.checked=te.metadata[`${H.EXTENSIONID}/visionEnabled`]==!0),e.length>0?Wi.style.display="none":Wi.style.display="block";const t=document.getElementsByClassName("token-table-entry"),i=[];for(const a of t){const s=a.id.slice(3);e.find(f=>f.id===s)===void 0&&i.push(a)}for(const a of i)a.remove();for(const a of e){const s=document.getElementById(`tr-${a.id}`);if(s){const f=s.getElementsByClassName("token-name")[0],T=s.getElementsByClassName("token-vision-range")[0],b=s.getElementsByClassName("unlimited-vision")[0];f&&(f.innerText=a.name),T&&(b.checked||(T.value=a.metadata[`${H.EXTENSIONID}/visionRange`]?a.metadata[`${H.EXTENSIONID}/visionRange`]:H.VISIONDEFAULT)),b&&(b.checked=!a.metadata[`${H.EXTENSIONID}/visionRange`]),b.checked?T.setAttribute("disabled","disabled"):T.removeAttribute("disabled")}else{const f=document.createElement("tr");f.id=`tr-${a.id}`,f.className="token-table-entry",f.innerHTML=`<td class="token-name">${a.name}</td><td><input class="token-vision-range" type="number" value=${H.VISIONDEFAULT}><span class="unit">ft</span></td><td>&nbsp;&nbsp;&infin;&nbsp<input type="checkbox" class="unlimited-vision"></td>`,Bs.appendChild(f);const T=f.getElementsByClassName("token-vision-range")[0],b=f.getElementsByClassName("unlimited-vision")[0];T.addEventListener("change",async v=>{if(!v||!v.target)return;const y=v.target,w=parseInt(y.value);w<0&&(y.value="0"),w>999&&(y.value="999"),await ee.scene.items.updateItems([a],K=>{K[0].metadata[`${H.EXTENSIONID}/visionRange`]=w})},!1),b.addEventListener("click",async v=>{if(!v||!v.target)return;let y=0;v.target.checked?T.setAttribute("disabled","disabled"):(y=parseInt(T.value),T.removeAttribute("disabled")),await ee.scene.items.updateItems([a],K=>{K[0].metadata[`${H.EXTENSIONID}/visionRange`]=y})},!1)}}}async function Hi(n){let e,t;[te.items,te.metadata,te.gridDpi,te.gridScale,e,t]=await Promise.all([ee.scene.items.getItems(),ee.scene.getMetadata(),ee.scene.grid.getDpi(),ee.scene.grid.getScale(),ee.scene.fog.getFilled(),ee.scene.fog.getColor()]),await ee.scene.items.deleteItems(te.items.filter(Yn).map(s=>s.id)),te.gridScale=te.gridScale.parsed.multiplier,te.fog={filled:e,style:{color:t,strokeWidth:5}};let i;if(te.items.filter(rs).length==0){const s=te.items.filter(T=>T.layer=="MAP"&&T.type=="IMAGE"),f=s.map(T=>T.image.width*T.image.height/Math.pow(T.grid.dpi,2));i=s[f.indexOf(Math.max(...f))]}let a;te.items.filter(ur).length==0&&(a=gt().width(5e3).height(5e3).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("green").fillOpacity(0).strokeDash([200,100]).strokeWidth(10).build(),a.metadata[`${H.EXTENSIONID}/isBackgroundImage`]=!0,te.items.push(a)),n=="GM"&&(a&&await ee.scene.items.addItems([a]),Zt(te.items),i!==void 0&&await ee.scene.items.updateItems([i],s=>{s[0].metadata[`${H.EXTENSIONID}/isBackgroundImage`]=!0}))}ee.onReady(async()=>{await ee.player.getRole().then(async n=>{n=="GM"&&(te.role="GM",bs(),Ts(),Os(),ws()),ee.scene.fog.onChange(e=>{te.fog=e}),ee.scene.items.onChange(e=>{const t=e;te.items=t,te.ready&&(n=="GM"&&Zt(t),wt())}),te.userId=await ee.player.getId(),te.players=await ee.party.getPlayers(),ee.party.onChange(e=>{te.players=e}),ee.scene.grid.onChange(e=>{te.gridDpi=e.dpi,te.gridScale=parseInt(e.scale),te.ready&&wt()}),ee.scene.onMetadataChange(e=>{te.metadata=e,te.ready&&wt()}),ee.scene.onReadyChange(e=>{te.ready=e,e?(Hi(n),wt()):n=="GM"&&Zt([])}),te.ready=await ee.scene.isReady(),te.ready?(Hi(n),wt()):n=="GM"&&Zt([])})});
